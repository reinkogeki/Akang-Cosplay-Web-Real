<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Akang Cosplay - Official App</title>

<link rel="icon" type="image/png" href="favicon.png">
<link rel="shortcut icon" href="favicon.png">
<link rel="apple-touch-icon" href="favicon.png">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <script src="https://www.gstatic.com/firebasejs/10.8.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.1/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.1/firebase-auth-compat.js"></script>

    <style>
        /* --- LOAD CUSTOM FONTS --- */
        @font-face {
            font-family: 'HardRace';
            src: url('Hard Race.otf') format('opentype');
            font-weight: normal; font-style: normal;
        }

        @font-face {
            font-family: 'LeagueSpartan';
            src: url('LeagueSpartan-VariableFont_wght.ttf') format('truetype');
            font-weight: 100 900;
            font-style: normal;
        }

        /* --- CSS VARIABLES & RESET --- */
        :root {
            --primary: #ff4757;
            --secondary: #2f3542;
            --dark: #1e272e;
            --light: #f1f2f6;
            --gold: #ffa502;
            --card-bg: #353b48;
            --accent-blue: #3498db;
            --sky-blue: #48dbfb;
            --danger: #ff6b6b;
            --purple: #9b59b6;
            --green: #2ecc71;
            /* Warna Text & Glow */
            --text-cosplay: #ff8686;
            --text-trainee: #ffd89d;
            --glow-trainee: #a6895e;
            
            /* ADDITION: Glassmorphism Variables */
            --glass-bg: rgba(53, 59, 72, 0.6);
            --glass-border: 1px solid rgba(255, 255, 255, 0.1);
            --glass-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.37);
        }

        * { box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--dark);
            /* ADDITION: Background texture for Glass effect */
            background-image: radial-gradient(circle at top right, rgba(255,71,87,0.1), transparent 40%), radial-gradient(circle at bottom left, rgba(72,219,251,0.1), transparent 40%);
            color: var(--light);
            margin: 0; padding-bottom: 80px;
            min-height: 100vh;
        }

        /* --- UPDATED LOADING OVERLAY (BREATHING LOGO) --- */
        #loadingOverlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #1e272e; z-index: 9999;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            transition: opacity 0.5s ease;
        }
        .loading-logo-anim {
            width: 100px; height: 100px; object-fit: contain;
            margin-bottom: 20px;
            animation: breathe 2s infinite ease-in-out;
        }
        @keyframes breathe { 0%, 100% { transform: scale(1); opacity: 0.8; } 50% { transform: scale(1.1); opacity: 1; } }

        /* --- ADDITION: TUTORIAL OVERLAY --- */
        .tutorial-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.85); z-index: 2000;
            display: none; flex-direction: column; justify-content: center; align-items: center;
            text-align: center; padding: 20px;
        }
        .tutorial-box {
            background: var(--card-bg); border: 2px solid var(--primary);
            padding: 20px; border-radius: 15px; max-width: 400px;
            box-shadow: 0 0 20px var(--primary);
            animation: popUp 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        @keyframes popUp { from { transform: scale(0.8); opacity: 0; } to { transform: scale(1); opacity: 1; } }

        /* --- HEADER --- */
        header {
            background: linear-gradient(135deg, rgba(25, 42, 86, 0.9), rgba(39, 60, 117, 0.9)); /* Semi-transparent */
            backdrop-filter: blur(5px);
            padding: 15px 20px; text-align: center;
            border-bottom: 4px solid var(--primary);
            position: sticky; top: 0; z-index: 100;
            box-shadow: 0 4px 10px rgba(0,0,0,0.3);
            display: flex; flex-direction: column; align-items: center;
            transition: all 0.5s ease;
        }
        
        /* ADDITION: Lang Switcher */
        .lang-switch-container {
            position: absolute; top: 15px; left: 15px;
            display: flex; gap: 5px;
        }
        .lang-btn {
            background: rgba(0,0,0,0.3); border: 1px solid #777; color: #aaa;
            border-radius: 5px; padding: 2px 6px; font-size: 0.75rem; cursor: pointer;
        }
        .lang-btn.active { background: var(--primary); color: white; border-color: var(--primary); }
        
        /* MODE STYLES */
        header.gamers-mode {
            background: linear-gradient(135deg, #000000, #1e272e);
            border-bottom-color: var(--gold);
        }
        
        header.trainee-mode {
            background: #2154a1;
            border-bottom-color: var(--sky-blue);
        }

        /* --- NEW: EVENT MODE STYLE (v18 FIX) --- */
        header.event-mode {
            background: linear-gradient(135deg, #2c1a3d, #4b2c68); /* Dark Purple Gradient */
            border-bottom-color: var(--purple);
        }

        .team-logo {
            width: 80px; height: 80px; object-fit: contain;
            background: rgba(255,255,255,0.1); border-radius: 50%;
            margin-bottom: 10px; border: 2px solid var(--light);
            display: none; transition: transform 0.3s;
        }

        header h1 { 
            margin: 0; 
            font-family: 'LeagueSpartan', sans-serif; 
            font-variation-settings: 'wght' 750; 
            font-weight: 750; 
            font-size: 2.2rem; 
            text-transform: uppercase; 
            letter-spacing: 2px; 
            line-height: 1.4;
            transition: all 0.3s ease;
            color: var(--text-cosplay);
            text-shadow: 0 0 15px rgba(255, 56, 56, 0.8);
        }

        header.trainee-mode h1 {
            color: var(--text-trainee) !important;
            text-shadow: 0 0 20px var(--glow-trainee) !important;
        }

        /* --- NEW: EVENT MODE TEXT STYLE (v18 FIX) --- */
        header.event-mode h1 {
            color: var(--purple) !important;
            text-shadow: 0 0 15px rgba(155, 89, 182, 0.8) !important;
            font-family: 'LeagueSpartan', sans-serif !important; /* Matches Akang Cosplay */
        }

        .title-gamers {
            font-family: 'HardRace', sans-serif !important;
            font-size: 2rem !important; 
            color: var(--gold) !important; 
            text-shadow: 0 0 10px rgba(255, 165, 2, 0.8), 2px 2px 0px #000 !important;
            letter-spacing: 3px;
            line-height: normal; 
        }

        header p { margin: 5px 0 0; opacity: 0.8; font-size: 0.8rem; transition: all 0.3s; }

        /* AUTH BUTTONS & DROPDOWN */
        .auth-container { position: absolute; top: 15px; right: 15px; }
        
        .auth-toggle {
            background: rgba(0,0,0,0.3); border: 1px solid #777; 
            color: white; cursor: pointer; font-size: 0.8rem;
            padding: 5px 12px; border-radius: 20px;
            display: flex; align-items: center; gap: 8px;
            transition: 0.3s;
        }
        .auth-toggle:hover { background: rgba(255,255,255,0.1); border-color: var(--primary); }
        
        .user-avatar-mini {
            width: 24px; height: 24px; border-radius: 50%; background: #ccc; object-fit: cover; border: 1px solid white;
        }

        .dropdown-menu {
            display: none; position: absolute; top: 40px; right: 0;
            background: var(--card-bg); border: 1px solid #555; border-radius: 8px;
            width: 240px; box-shadow: 0 5px 15px rgba(0,0,0,0.5);
            z-index: 200; overflow: hidden; animation: fadeIn 0.2s;
        }
        .dropdown-menu.show { display: block; }
        .dropdown-item {
            display: block; width: 100%; padding: 12px 15px;
            text-align: left; background: none; border: none;
            color: #ddd; cursor: pointer; font-size: 0.9rem;
            border-bottom: 1px solid #444; transition: 0.2s;
            display: flex; align-items: center; gap: 10px;
        }
        .dropdown-item:last-child { border-bottom: none; }
        .dropdown-item:hover { background: rgba(255,255,255,0.05); color: white; padding-left: 20px; }
        .dropdown-item.danger { color: var(--danger); }
        .dropdown-item.danger:hover { background: rgba(255, 0, 0, 0.1); }
        .dropdown-item.gold { color: var(--gold); }
        .dropdown-item.active-admin { background: rgba(255, 165, 2, 0.1); color: var(--gold); }

        .container { max-width: 1100px; margin: 0 auto; padding: 20px; }

        /* --- NAVIGATION --- */
        .nav-tabs {
            display: flex; gap: 10px; margin-bottom: 20px;
            background: var(--card-bg); border-radius: 50px; padding: 5px;
            overflow-x: auto; 
        }
        .nav-btn {
            flex: 1; border: none; background: none; color: #aaa;
            padding: 12px 5px; cursor: pointer; font-weight: bold;
            border-radius: 50px; transition: 0.3s; font-size: 0.8rem;
            white-space: nowrap;
        }
        .nav-btn.active { background: var(--primary); color: white; box-shadow: 0 2px 5px rgba(0,0,0,0.2); }
        .nav-btn-gamers.active { background: var(--accent-blue); }
        .nav-btn-trainee.active { background: var(--sky-blue); color: #1e272e; } 
        .nav-btn-events.active { background: var(--purple); color: white; }

        /* --- SKELETON LOADING --- */
        .skeleton {
            background-color: #3d4655;
            background-image: linear-gradient(90deg, #3d4655 0px, #4b5666 40px, #3d4655 80px);
            background-size: 600px;
            animation: shine-lines 2s infinite ease-out;
            border-radius: 5px;
        }
        .skeleton-text { height: 12px; margin-bottom: 5px; width: 100%; }
        .skeleton-avatar { width: 50px; height: 50px; border-radius: 50%; }
        .skeleton-card { height: 80px; width: 100%; border-radius: 12px; margin-bottom: 15px; }

        @keyframes shine-lines {
            0% { background-position: -100px; }
            40%, 100% { background-position: 140px; }
        }

        /* --- VIEWS --- */
        .view-section { display: none; animation: fadeIn 0.4s; }
        .view-section.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* --- CARDS (UPDATED WITH GLASSMORPHISM) --- */
        .leaderboard-card, .feed-card, .event-card, .about-team-card, .stage-section {
            background: var(--glass-bg); /* Glass Effect */
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: var(--glass-border);
            border-radius: 12px; position: relative;
            margin-bottom: 15px; padding: 15px;
            box-shadow: var(--glass-shadow);
            contain: layout; 
        }
        .leaderboard-card { display: flex; align-items: center; cursor: pointer; transition: transform 0.2s; }
        .leaderboard-card:active { transform: scale(0.98); }
        
        .rank-badge { font-size: 1.5rem; font-weight: bold; width: 40px; text-align: center; margin-right: 15px; color: var(--gold); }
        .avatar-small { width: 50px; height: 50px; border-radius: 50%; object-fit: cover; margin-right: 15px; border: 2px solid var(--primary); background: #aaa; }
        .trainee-style .rank-badge { color: var(--sky-blue); }
        .trainee-style .avatar-small { border-color: var(--sky-blue); }
        
        .lb-info { flex: 1; }
        .lb-info h3 { margin: 0; font-size: 1.1rem; }
        .lb-stats div { font-weight: bold; color: var(--primary); font-size: 1.2rem; text-align: right; }

        .feed-card { border-left: 5px solid var(--accent-blue); min-height: 150px; }
        .feed-card.feed-comp { border-left-color: var(--gold); }
        .feed-card.feed-trainee { border-left-color: var(--sky-blue); }
        
        /* ADDITION: STACKED AVATARS FOR HISTORY */
        .avatar-group { display: flex; align-items: center; margin-right: 15px; }
        .avatar-group img {
            width: 45px; height: 45px; border-radius: 50%;
            border: 2px solid var(--card-bg); object-fit: cover;
            margin-left: -15px; /* Effect tumpuk */
            position: relative; transition: transform 0.2s, z-index 0.2s;
            background: #333;
        }
        .avatar-group img:first-child { margin-left: 0; z-index: 10; }
        .avatar-group img:nth-child(2) { z-index: 9; }
        .avatar-group img:nth-child(3) { z-index: 8; }
        .avatar-group img:hover { transform: translateY(-5px) scale(1.1); z-index: 20; border-color: var(--primary); }

        .feed-header { display: flex; align-items: center; margin-bottom: 10px; }
        .feed-avatar { width: 40px; height: 40px; border-radius: 50%; object-fit: cover; margin-right: 10px; }
        .feed-rank { 
            position: absolute; top: 15px; right: 15px; 
            background: rgba(0,0,0,0.5); padding: 5px 10px; border-radius: 5px;
            color: var(--gold); font-weight: bold; font-size: 0.9rem;
        }
        .feed-img-proof { 
            width: 100%; aspect-ratio: 1 / 1; object-fit: cover; 
            border-radius: 5px; margin-top: 10px; border: 1px solid #555; display: block; cursor: zoom-in; 
        }

        /* --- STYLES UNTUK TEAM/SQUAD INPUT --- */
        .teammate-row { display: flex; gap: 5px; margin-bottom: 5px; align-items: center; }
        .teammate-row select, .teammate-row input { margin: 0; flex: 1; }
        .team-list-names { font-size: 0.85rem; color: #ccc; line-height: 1.4; }
        .team-member-link { color: var(--primary); font-weight: bold; text-decoration: none; }
        .team-member-link:hover { text-decoration: underline; }
        .team-non-member { color: #aaa; }
        .btn-see-more { background: none; border: none; color: var(--accent-blue); cursor: pointer; font-size: 0.8rem; padding: 0; margin-left: 5px;}
        .btn-see-more:hover { text-decoration: underline; }
        .hidden-names { display: none; }

        /* --- EVENT CARDS --- */
        .event-card {
            overflow: hidden; transition: transform 0.2s;
        }
        .event-card:hover { border-color: var(--purple); transform: translateY(-3px); }
        .event-poster { width: 100%; aspect-ratio: 16/9; object-fit: cover; display: block; border-radius: 8px; margin-bottom: 10px;}
        .event-body { padding: 5px; }
        .event-date-badge { 
            background: var(--purple); color: white; display: inline-block; 
            padding: 3px 10px; border-radius: 5px; font-weight: bold; font-size: 0.8rem; margin-bottom: 10px;
        }
        .event-type { float: right; color: #aaa; font-size: 0.8rem; border: 1px solid #555; padding: 2px 8px; border-radius: 10px; }
        .event-title { margin: 0 0 10px 0; color: white; font-size: 1.2rem; }
        .event-detail-row { display: flex; gap: 10px; color: #ccc; font-size: 0.9rem; margin-bottom: 5px; }
        .event-detail-row i { color: var(--sky-blue); width: 20px; text-align: center; }
        
        .event-prizes { background: rgba(0,0,0,0.2); padding: 10px; border-radius: 8px; margin-top: 15px; }
        .prize-item { display: flex; justify-content: space-between; font-size: 0.85rem; padding: 3px 0; border-bottom: 1px solid #444; }
        .prize-item:last-child { border: none; }
        .prize-amount { color: var(--gold); font-weight: bold; }

        /* --- ABOUT US CARD --- */
        .about-team-card { text-align: center; }
        .team-grid {
            display: flex; gap: 15px; flex-wrap: wrap; margin-top: 20px;
            justify-content: center;
        }
        .member-card {
            flex: 1; min-width: 140px; max-width: 200px;
            background: var(--dark); border-radius: 10px; padding: 15px;
            border: 2px solid #555; transition: 0.3s;
        }
        .member-card:hover { transform: translateY(-5px); border-color: var(--primary); }
        .member-card img { width: 80px; height: 80px; border-radius: 50%; object-fit: cover; border: 2px solid white; margin-bottom: 10px; }
        .member-card h4 { margin: 0; color: var(--gold); }
        .member-card p { margin: 5px 0 0 0; font-size: 0.8rem; color: #ccc; }

        /* --- STAGE SECTION (VIDEO HYBRID & PLAYLIST) --- */
        .stage-title { text-align: center; font-family: 'LeagueSpartan', sans-serif; font-weight: 800; font-size: 1.8rem; color: var(--primary); margin: 0 0 20px 0; text-transform: uppercase; letter-spacing: 2px; text-shadow: 0 0 10px rgba(255, 71, 87, 0.5); display: flex; align-items: center; justify-content: center; gap: 10px; }
        .stage-grid { display: flex; flex-wrap: wrap; gap: 20px; justify-content: center; }
        .stage-card { flex: 1; min-width: 280px; background: rgba(0,0,0,0.3); border-radius: 12px; padding: 15px; border: 1px solid #444; display: flex; flex-direction: column; }
        .stage-card h3 { margin: 0 0 15px 0; font-size: 1rem; color: #ddd; letter-spacing: 1px; border-bottom: 2px solid #555; padding-bottom: 5px; width: 100%; text-align: center; }
        .shorts-card h3 { color: var(--accent-blue); border-color: var(--accent-blue); }
        .video-card h3 { color: var(--gold); border-color: var(--gold); }
        
        .phone-frame { width: 100%; max-width: 220px; aspect-ratio: 9 / 16; background: black; border-radius: 15px; border: 4px solid #333; overflow: hidden; box-shadow: 0 0 15px rgba(52, 152, 219, 0.3); margin: 0 auto; }
        .cinema-frame { width: 100%; aspect-ratio: 16 / 9; background: black; border-radius: 8px; border: 2px solid #333; overflow: hidden; box-shadow: 0 0 15px rgba(255, 165, 2, 0.3); margin: 0 auto; }
        .video-iframe { width: 100%; height: 100%; border: none; }

        /* PLAYLIST UI */
        .playlist-container { margin-top: 15px; max-height: 200px; overflow-y: auto; background: rgba(0,0,0,0.2); border-radius: 8px; border: 1px solid #555; }
        .playlist-item { display: flex; align-items: center; gap: 10px; padding: 8px; border-bottom: 1px solid #444; cursor: pointer; transition: 0.2s; }
        .playlist-item:hover { background: rgba(255,255,255,0.1); }
        .playlist-item.active { background: rgba(255, 71, 87, 0.2); border-left: 3px solid var(--primary); }
        .playlist-thumb { width: 50px; height: 50px; object-fit: cover; border-radius: 4px; flex-shrink: 0; }
        .playlist-info { font-size: 0.8rem; line-height: 1.2; color: #ccc; }
        .playlist-info strong { color: white; display: block; margin-bottom: 2px; }

        /* --- VISITOR COUNTER & GEO MAP --- */
        .visitor-stats-container {
            margin-top: 30px;
            padding: 20px;
            background: rgba(0,0,0,0.3);
            border-radius: 15px;
            border: 1px solid #485460;
            text-align: center;
        }

        .big-counter {
            font-family: 'LeagueSpartan', sans-serif;
            font-weight: 800;
            font-size: 3.5rem;
            color: var(--gold);
            text-shadow: 0 0 20px rgba(255, 165, 2, 0.5);
            margin: 0;
            line-height: 1;
        }
        
        .counter-label {
            font-size: 0.8rem;
            color: #aaa;
            letter-spacing: 2px;
            text-transform: uppercase;
            margin-top: 5px;
            margin-bottom: 25px;
        }

        /* Geo Cards */
        .geo-list { display: flex; flex-direction: column; gap: 10px; text-align: left; }

        .geo-card {
            background: var(--dark);
            border: 1px solid #555;
            border-radius: 8px;
            overflow: hidden;
            transition: all 0.3s ease;
        }
        
        .geo-header {
            padding: 12px 15px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: rgba(255,255,255,0.05);
        }
        .geo-header:hover { background: rgba(255,255,255,0.1); }
        
        .geo-info { flex: 1; display: flex; align-items: center; gap: 10px; }
        .geo-flag { font-size: 1.5rem; }
        .geo-name { font-weight: bold; color: #ddd; font-size: 0.95rem; }
        .geo-count { font-weight: bold; color: var(--gold); font-size: 1rem; }
        
        .geo-bar-bg { height: 4px; width: 100%; background: #333; margin-top: 8px; border-radius: 2px; }
        .geo-bar-fill { height: 100%; background: var(--primary); border-radius: 2px; width: 0%; transition: width 1s ease; }

        /* Detail Provinsi (Hidden by Default) */
        .geo-details {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease-out;
            background: #252d36;
        }
        .geo-details.open { max-height: 500px; }
        
        .province-item {
            padding: 8px 15px 8px 45px;
            border-bottom: 1px solid #444;
            font-size: 0.85rem;
            color: #ccc;
            display: flex; justify-content: space-between;
        }
        .province-item:last-child { border-bottom: none; }
        .province-count { color: var(--sky-blue); font-weight: bold; }

        /* --- FILTER TABS --- */
        .filter-tabs {
            display: flex; gap: 10px; margin-bottom: 15px; margin-top: 5px;
            background: var(--card-bg); border-radius: 50px; padding: 5px;
            border: 1px solid #485460;
        }
        .filter-btn {
            flex: 1; border: none; background: none; color: #aaa; padding: 10px;
            cursor: pointer; font-weight: bold; border-radius: 50px; transition: 0.3s;
            font-size: 0.85rem; text-transform: uppercase;
        }
        .filter-btn.active { background: var(--primary); color: white; box-shadow: 0 2px 5px rgba(0,0,0,0.2); }
        .trainee-mode .filter-btn.active { background: var(--sky-blue); color: #1e272e; }

        /* Admin Buttons */
        .admin-controls { display: none; position: absolute; bottom: 10px; right: 10px; z-index: 10; }
        .show-admin { display: block !important; }
        .btn-mini-action { width: 30px; height: 30px; border-radius: 5px; border:none; color:white; cursor: pointer; margin-left: 5px; }

        /* --- PROFILE --- */
        .profile-header { text-align: center; background: var(--glass-bg); padding: 30px; border-radius: 15px; margin-bottom: 20px; position: relative; border: var(--glass-border); box-shadow: var(--glass-shadow); backdrop-filter: blur(10px); }
        
        /* ACTION MENU (PENCIL) */
        .action-menu-container { position: absolute; top: 15px; right: 15px; z-index: 50; }
        .btn-action-trigger { background: transparent; border: 1px solid #777; color: #ddd; padding: 8px 12px; border-radius: 50%; cursor: pointer; transition: 0.2s; font-size: 1.1rem;}
        .btn-action-trigger:hover { background: rgba(255,255,255,0.1); color: white; border-color: white; }
        .btn-action-trigger.saving { background: var(--green); border-color: var(--green); color: white; animation: pulse 1s infinite; }
        
        .action-dropdown {
            display: none; position: absolute; top: 40px; right: 0;
            background: var(--card-bg); border: 1px solid #555; border-radius: 8px;
            width: 200px; box-shadow: 0 5px 15px rgba(0,0,0,0.5); overflow: hidden;
        }
        .action-dropdown.show { display: block; }

        .profile-pic { width: 120px; height: 120px; border-radius: 50%; object-fit: cover; border: 4px solid var(--primary); margin-bottom: 15px; background: #555; }
        .tag { background: #485460; padding: 5px 12px; border-radius: 15px; font-size: 0.85rem; color: white; display: inline-block; margin: 3px; }
        .social-badge { background: linear-gradient(45deg, #f09433 0%, #e6683c 25%, #dc2743 50%, #cc2366 75%, #bc1888 100%); color: white; padding: 6px 15px; border-radius: 20px; text-decoration: none; display: inline-flex; align-items: center; gap: 5px; font-size: 0.85rem; font-weight: bold; margin-bottom: 10px; transition: transform 0.2s; }
        .social-badge:hover { transform: scale(1.05); color: white; }
        .social-badge.whatsapp { background: #25D366; }

        /* --- GALLERY --- */
        .gallery-section { margin-bottom: 25px; }
        .gallery-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; margin-top: 15px; }
        .gallery-item { position: relative; aspect-ratio: 1 / 1; width: 100%; border-radius: 8px; overflow: hidden; border: 1px solid #485460; }
        .gallery-img { width: 100%; height: 100%; object-fit: cover; cursor: pointer; transition: transform 0.2s; }
        .gallery-img:hover { transform: scale(1.1); }
        .btn-del-photo { position: absolute; top: 0; right: 0; background: rgba(255,0,0,0.8); color: white; border: none; width: 30px; height: 30px; cursor: pointer; z-index: 10; display: none; }
        .btn-add-photo { width: 100%; background: #3d4655; color: #aaa; border: 2px dashed #57606f; padding: 10px; border-radius: 8px; cursor: pointer; font-size: 0.9rem; display: none; align-items: center; justify-content: center; gap: 8px; transition: 0.3s; }
        .btn-add-photo:hover { background: #485460; color: white; border-color: var(--accent-blue); }

        /* DELETE MODE STYLES */
        .delete-mode-active .btn-del-photo { display: flex; justify-content: center; align-items: center; animation: shake 0.5s; }
        .delete-mode-active .btn-del-history { display: block !important; }
        .btn-del-history { display: none; background: none; border: none; color: var(--danger); cursor: pointer; font-size: 1.1rem; }
        
        /* EDIT HISTORY BTN STYLE */
        .delete-mode-active .btn-edit-history { display: block !important; }
        .btn-edit-history { display: none; background: none; border: none; color: var(--accent-blue); cursor: pointer; font-size: 1.1rem; margin-right: 15px;}
        
        @keyframes shake { 0% { transform: rotate(0deg); } 25% { transform: rotate(5deg); } 75% { transform: rotate(-5deg); } 100% { transform: rotate(0deg); } }
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.1); } 100% { transform: scale(1); } }

        /* --- LIGHTBOX (MODAL GAMBAR) --- */
        .lightbox-modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.95); z-index: 500; justify-content: center; align-items: center; flex-direction: column; }
        .lightbox-img { max-width: 90%; max-height: 80vh; border-radius: 5px; box-shadow: 0 0 20px rgba(255,255,255,0.1); }
        .lightbox-close { position: absolute; top: 20px; right: 20px; background: rgba(255,255,255,0.2); color: white; border: none; width: 40px; height: 40px; border-radius: 50%; font-size: 1.5rem; cursor: pointer; display: flex; justify-content: center; align-items: center; }
        .lightbox-close:hover { background: var(--primary); }

        /* --- SEARCH BAR --- */
        .search-container { position: relative; margin-bottom: 5px; }
        .search-icon { position: absolute; left: 15px; top: 50%; transform: translateY(-50%); color: #aaa; font-size: 1.1rem; }
        .search-bar { width: 100%; padding: 12px 12px 12px 42px; background: var(--card-bg); border: 1px solid #555; color: white; border-radius: 25px; font-size: 0.95rem; outline: none; transition: 0.3s; margin: 0; }
        .search-bar:focus { border-color: var(--primary); box-shadow: 0 0 8px rgba(255, 71, 87, 0.4); }

        /* --- MODAL --- */
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.85); z-index: 300; justify-content: center; align-items: center; backdrop-filter: blur(5px); }
        .modal-content { background: var(--secondary); padding: 25px; border-radius: 15px; width: 90%; max-width: 500px; max-height: 90vh; overflow-y: auto; position: relative; border: 1px solid #444; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
        
        /* AUTH TABS (LOGIN/REGISTER) */
        .auth-tabs { display: flex; margin-bottom: 15px; border-bottom: 1px solid #555; }
        .auth-tab-btn { flex: 1; padding: 10px; background: none; border: none; color: #aaa; cursor: pointer; font-weight: bold; border-bottom: 2px solid transparent; }
        .auth-tab-btn.active { color: var(--primary); border-bottom-color: var(--primary); }

        /* --- CHAT BOT UI --- */
        #modalBot .modal-content { max-width: 1100px; }
        .bot-layout { display: flex; gap: 15px; height: 60vh; min-height: 400px; max-height: 600px; margin-top: 10px; }
        .bot-chat-section { flex: 2; display: flex; flex-direction: column; min-width: 0; border: 1px solid #485460; border-radius: 10px; background: var(--dark); overflow: hidden;}
        .bot-menu-section { flex: 1; display: flex; flex-direction: column; overflow-y: auto; gap: 8px; padding-right: 5px;}
        .bot-menu-title { font-size: 0.9rem; color: var(--gold); margin: 0 0 10px 0; font-weight: bold; border-bottom: 1px solid #555; padding-bottom: 5px;}
        .chat-box { flex-grow: 1; overflow-y: auto; padding: 15px; display: flex; flex-direction: column; gap: 10px; }
        .chat-msg { display: flex; flex-direction: column; width: 100%; }
        .chat-msg.bot { align-items: flex-start; }
        .chat-msg.user { align-items: flex-end; }
        .bubble { max-width: 85%; padding: 10px 15px; border-radius: 15px; font-size: 0.9rem; line-height: 1.5; word-wrap: break-word; }
        .bubble.bot { background: var(--card-bg); color: white; border-bottom-left-radius: 2px; border: 1px solid #555; }
        .bubble.user { background: var(--accent-blue); color: white; border-bottom-right-radius: 2px; }
        .bot-opt-btn { background: var(--dark); border: 1px solid var(--accent-blue); color: #ddd; padding: 10px; border-radius: 10px; cursor: pointer; text-align: left; transition: 0.2s; font-size: 0.85rem; line-height: 1.3; }
        .bot-opt-btn:hover { background: var(--accent-blue); color: white; }
        .chat-input-area { display: flex; gap: 8px; padding: 10px; background: var(--card-bg); border-top: 1px solid #485460; }
        .chat-input-area input { flex-grow: 1; background: var(--dark); border: 1px solid #555; border-radius: 20px; color: white; outline: none; padding: 10px 15px; margin: 0; }
        .chat-input-area button { background: var(--accent-blue); border: none; color: white; width: 42px; height: 42px; border-radius: 50%; cursor: pointer; display: flex; justify-content: center; align-items: center; transition: 0.2s; }
        .chat-input-area button:hover { background: var(--primary); }

        /* FAB MENU */
        .fab-container { position: fixed; bottom: 25px; right: 25px; z-index: 200; display: flex; flex-direction: column; align-items: flex-end; gap: 10px; }
        .fab-menu { display: none; flex-direction: column; gap: 10px; margin-bottom: 5px; }
        .fab-menu.show { display: flex; animation: slideUp 0.3s; }
        .fab-menu button { background: var(--card-bg); color: white; border: 1px solid var(--primary); padding: 10px 15px; border-radius: 8px; cursor: pointer; box-shadow: 0 4px 10px rgba(0,0,0,0.3); font-weight: bold; text-align: right; }
        @keyframes slideUp { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .btn-fab { background: var(--primary); color: white; width: 60px; height: 60px; border-radius: 50%; border: none; font-size: 28px; box-shadow: 0 5px 15px rgba(255, 71, 87, 0.6); cursor: pointer; display: flex; justify-content: center; align-items: center; }
        
        input:not(.search-bar):not(#chatInput), select, textarea { width: 100%; padding: 12px; background: var(--dark); border: 1px solid #57606f; color: white; border-radius: 5px; margin-top: 5px; margin-bottom: 10px; }
        label { color: #ccc; font-weight: bold; }
        .btn-submit { width: 100%; background: var(--primary); color: white; padding: 12px; border: none; border-radius: 5px; font-weight: bold; cursor: pointer; margin-top: 15px; }
        .btn-submit:disabled { background: #555; cursor: not-allowed; opacity: 0.7; }
        .hidden { display: none !important; }

        /* Settings */
        .btn-settings { display: none; width: 100%; margin-top: 20px; background: #333; color: #ddd; padding: 10px; border: 1px dashed #777; cursor: pointer; }
        .btn-restore { background: #e67e22; color: white; border:none; padding: 12px; width: 100%; cursor: pointer; border-radius: 5px; font-weight: bold; margin-bottom: 10px;}
        .btn-backup { background: #3498db; color: white; border:none; padding: 12px; width: 100%; cursor: pointer; border-radius: 5px; font-weight: bold; margin-bottom: 20px; }
        .btn-inject { background: #2ecc71; color: white; border:none; padding: 15px; width: 100%; cursor: pointer; border-radius: 8px; font-weight: bold; margin-top: 10px; font-size: 1rem; }

        .bot-link { color: var(--gold); text-decoration: underline; font-weight: bold; }
        .bot-link:hover { color: var(--primary); }

        /* --- GAME CATALOG --- */
        .game-catalog-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(110px, 1fr)); gap: 15px; margin-top: 15px; }
        .game-card { position: relative; border-radius: 10px; overflow: hidden; border: 2px solid #485460; box-shadow: 0 4px 8px rgba(0,0,0,0.3); background: var(--dark); transition: transform 0.2s;}
        .game-card:hover { transform: scale(1.05); border-color: var(--accent-blue); }
        .game-img { width: 100%; aspect-ratio: 9 / 16; object-fit: cover; display: block; }
        .game-title { position: absolute; bottom: 0; left: 0; width: 100%; background: linear-gradient(transparent, rgba(0,0,0,0.95)); padding: 25px 8px 10px; text-align: center; font-size: 0.85rem; font-weight: bold; color: var(--gold); line-height: 1.2; word-wrap: break-word;}
        .btn-delete-game { position: absolute; top: 5px; right: 5px; background: rgba(255, 71, 87, 0.9); color: white; border: none; width: 25px; height: 25px; border-radius: 5px; cursor: pointer; display: none; z-index: 10; font-size: 0.8rem; }
        
        /* ADDITION: INPUT CHAR GROUP */
        .char-select-group { display: flex; gap: 5px; }
        .char-select-group select { flex: 1; }
        .char-select-group button { width: 45px; background: #333; border: 1px solid #555; color: white; border-radius: 5px; cursor: pointer; margin-top: 5px; margin-bottom: 10px;}
        .char-select-group button.active { background: var(--accent-blue); border-color: var(--accent-blue); }

    
/* === Visual Upgrade Stage 1 (Clean Modern + Gamer Accent) === */
:root {
    --radius-main: 12px;
}

/* unified buttons */
.btn {
    padding: 10px 14px;
    border-radius: var(--radius-main);
    border: none;
    cursor: pointer;
    font-weight: 700;
    transition: transform .2s ease, box-shadow .2s ease;
}
.btn:hover {
    transform: translateY(-2px);
}

/* cleaner cards */
.glass-card {
    border-radius: var(--radius-main);
    box-shadow: 0 6px 18px rgba(0,0,0,0.25);
}

/* better spacing */
.section {
    margin-top: 24px;
}

/* responsive gallery */
.gallery-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
    gap: 12px;
}

/* smoother hover */
button, a {
    transition: all .2s ease;
}

/* accessibility focus */
button:focus, a:focus {
    outline: 3px solid rgba(255,71,87,0.3);
    outline-offset: 2px;
}

/* reduce visual noise */
.glass, .glass-card {
    backdrop-filter: blur(8px);
}


/* === Visual Upgrade Stage 2 (Structure & Identity Polish) === */

/* Typography hierarchy */
body {
    font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
    line-height: 1.6;
    letter-spacing: 0.2px;
}

h1, h2, h3 {
    font-weight: 800;
    letter-spacing: 0.5px;
}

/* Header refinement */
header {
    backdrop-filter: blur(10px);
    border-bottom: 1px solid rgba(255,255,255,0.06);
}

header h1 {
    font-size: 1.4rem;
}

/* Navigation spacing */
nav {
    display: flex;
    gap: 10px;
    flex-wrap: wrap;
    justify-content: center;
}

/* Unified card spacing */
.glass-card {
    padding: 18px;
    transition: transform .25s ease, box-shadow .25s ease;
}

.glass-card:hover {
    transform: translateY(-4px);
    box-shadow: 0 10px 28px rgba(0,0,0,0.35);
}

/* Section rhythm (visual breathing space) */
.section + .section {
    margin-top: 32px;
}

/* Cleaner links */
a {
    text-decoration: none;
}

/* Subtle gamer accent glow only on interaction */
.btn-primary:hover {
    box-shadow: 0 0 18px rgba(255,71,87,0.35);
}

/* Better mobile spacing */
@media (max-width: 600px) {
    .container {
        padding: 14px;
    }
    header h1 {
        font-size: 1.2rem;
    }
}


/* ===== MODE ATMOSPHERE (Launcher Feel) ===== */

body.mode-official {
    background-image: 
        radial-gradient(circle at top right, rgba(255,71,87,0.15), transparent 50%);
}

body.mode-trainee {
    background-image: 
        radial-gradient(circle at top right, rgba(72,219,251,0.18), transparent 50%);
}

body.mode-gamers {
    background-image: 
        radial-gradient(circle at top right, rgba(255,165,2,0.18), transparent 50%);
}

body, header {
    transition: background 0.6s ease, 
                background-image 0.6s ease, 
                border-color 0.4s ease;
}


/* ===== PROFILE HOVER GLOW (Leaderboard Highlight) ===== */

.leaderboard-card {
    transition: transform 0.25s ease, 
                box-shadow 0.25s ease, 
                border-color 0.25s ease,
                background 0.25s ease;
    position: relative;
    overflow: hidden;
}

/* subtle base border */
.leaderboard-card::before {
    content: "";
    position: absolute;
    inset: 0;
    border-radius: inherit;
    opacity: 0;
    background: radial-gradient(circle at var(--x,50%) var(--y,50%), 
        rgba(255,71,87,0.25), 
        transparent 60%);
    transition: opacity 0.25s ease;
    pointer-events: none;
}

/* hover effect */
.leaderboard-card:hover {
    transform: translateY(-6px) scale(1.01);
    box-shadow: 
        0 10px 25px rgba(0,0,0,0.5),
        0 0 18px rgba(255,71,87,0.45);
    border-color: var(--primary);
}

.leaderboard-card:hover::before {
    opacity: 1;
}

/* mouse position glow tracking */
.leaderboard-card:hover {
    cursor: pointer;
}

/* --- CUSTOM HOVER COLORS PER DIVISION (User Request) --- */

/* 1. Trainee Section: Cyan/Neon Blue (#00e5ff) - Opsi A */
#view-trainee .leaderboard-card:hover {
    border-color: #00e5ff !important;
    box-shadow: 0 0 15px rgba(0, 229, 255, 0.6), 0 10px 25px rgba(0,0,0,0.5) !important;
}

#view-trainee .leaderboard-card:hover h3,
#view-trainee .leaderboard-card:hover .rank-badge {
    color: #00e5ff !important;
    text-shadow: 0 0 10px rgba(0, 229, 255, 0.8);
}

/* 2. Gamers Section: Gold (#ffd700) - Opsi A */
#view-gamers .leaderboard-card:hover {
    border-color: #ffd700 !important;
    box-shadow: 0 0 15px rgba(255, 215, 0, 0.6), 0 10px 25px rgba(0,0,0,0.5) !important;
}

#view-gamers .leaderboard-card:hover h3,
#view-gamers .leaderboard-card:hover .rank-badge {
    color: #ffd700 !important;
    text-shadow: 0 0 10px rgba(255, 215, 0, 0.8);
}

</style>
</head>
<body>

    <div id="loadingOverlay">
        <img src="" id="loadingLogo" class="loading-logo-anim" onerror="this.src='https://cdn-icons-png.flaticon.com/512/847/847969.png'">
        <h3 style="color:var(--primary); font-family:'LeagueSpartan'; letter-spacing:2px; margin: 0;">AKANG COSPLAY</h3>
        <p id="loadingText" style="color:#aaa; font-size: 0.9rem; margin-top: 10px;">Selamat datang di akang cosplay, mohon menunggu sebentar...</p>
    </div>
    
    <div id="tutorialOverlay" class="tutorial-overlay">
        <div class="tutorial-box">
            <img src="https://cdn-icons-png.flaticon.com/512/4712/4712035.png" style="width: 80px; margin-bottom: 15px;">
            <h3 style="color: var(--primary);">Halo, Selamat Datang!</h3>
            <p id="tutorialText" style="color: #ddd; line-height: 1.5;">Saya <b>Akang Bot</b> ü§ñ. Saya akan memandu Anda berkeliling aplikasi ini sebentar.</p>
            <div style="display: flex; gap: 10px; margin-top: 20px; justify-content: center;">
                <button class="btn-submit" onclick="nextTutorial()" style="background: var(--accent-blue); width: auto; padding: 8px 20px;">Lanjut</button>
                <button class="btn-submit" onclick="skipTutorial()" style="background: #333; border: 1px solid #555; width: auto; padding: 8px 20px;">Skip</button>
            </div>
        </div>
    </div>

    <header id="mainHeader">
        <div class="lang-switch-container">
            <button class="lang-btn active" onclick="setLang('id')">üáÆüá© ID</button>
            <button class="lang-btn" onclick="setLang('en')">üá¨üáß EN</button>
        </div>

        <div class="auth-container">
            <button id="authBtn" class="auth-toggle" onclick="toggleUserMenu()">
                <i class="fas fa-sign-in-alt"></i> Login
            </button>
            <div id="userDropdown" class="dropdown-menu">
                </div>
        </div>
        
        <img src="" id="teamLogo" class="team-logo">
        
        <h1 id="headerTitle">Akang Cosplay</h1>
        <p id="headerEst">EST. 2024</p>
        
        <div id="adminBadge" class="admin-badge" style="display:none; margin-top:5px; background:var(--gold); color:black; font-weight:bold; padding:2px 8px; border-radius:10px;">SUPER ADMIN ACTIVE</div>
    </header>

    <div class="container">
        <div class="nav-tabs">
            <button class="nav-btn active" onclick="switchView('about'); applyMode('official')"><i class="fas fa-home"></i> Home</button>
            <button class="nav-btn" onclick="switchView('official'); applyMode('official')"><i class="fas fa-crown"></i> Official</button>
            <button class="nav-btn nav-btn-trainee" onclick="switchView('trainee'); applyMode('trainee')"><i class="fas fa-user-graduate"></i> Trainee</button>
            <button class="nav-btn nav-btn-gamers" onclick="switchView('gamers'); applyMode('gamers')"><i class="fas fa-gamepad"></i> Gamers</button>
            <button class="nav-btn nav-btn-events" onclick="switchView('events')"><i class="fas fa-calendar-alt"></i> Events</button>
        </div>

        <div id="view-about" class="view-section active">
            <div class="about-team-card glass-card">
                <img src="https://cdn-icons-png.flaticon.com/512/847/847969.png" id="about-logo" style="width:100px; height:100px; border-radius:50%; margin-bottom:15px; border:2px solid var(--primary);">
                <h2 style="color:var(--gold); margin:0;">AKANG COSPLAY</h2>
                <p style="color:#aaa; font-style:italic;">"Berkarya dengan Hati, Berprestasi dengan Aksi"</p>
                <p style="margin-top:15px; font-size:0.95rem; line-height:1.6;">
                    <b>Akang Cosplay</b> adalah tim cosplay yang didirikan pada 14 Juni 2024. 
                    Berawal dari hobi, kami tumbuh menjadi komunitas yang saling mendukung dalam kompetisi, 
                    pembuatan properti, hingga event jejepangan.
                </p>
                
                <h3 style="border-top:1px solid #555; padding-top:15px; margin-top:20px; color:var(--accent-blue);">OUR FOUNDERS</h3>
                <div class="team-grid">
                    <div class="member-card" onclick="findAndOpenProfile('rein')">
                        <img src="https://cdn-icons-png.flaticon.com/512/847/847969.png" id="img-team-rein">
                        <h4>Rein</h4>
                        <p id="role-team-rein">Founder / Cosplayer</p>
                        <div id="ach-team-rein" style="color:var(--gold); font-size:0.8rem; margin-top:5px; font-weight:bold; display:none;"></div>
                    </div>
                    <div class="member-card" onclick="findAndOpenProfile('nabilla')">
                        <img src="https://cdn-icons-png.flaticon.com/512/847/847969.png" id="img-team-nabilla">
                        <h4>Nabilla</h4>
                        <p id="role-team-nabilla">Cosplayer / Talent</p>
                        <div id="ach-team-nabilla" style="color:var(--gold); font-size:0.8rem; margin-top:5px; font-weight:bold; display:none;"></div>
                    </div>
                    <div class="member-card" onclick="findAndOpenProfile('ian')">
                        <img src="https://cdn-icons-png.flaticon.com/512/847/847969.png" id="img-team-ian">
                        <h4>Ian</h4>
                        <p id="role-team-ian">Cosplayer / Maker</p>
                        <div id="ach-team-ian" style="color:var(--gold); font-size:0.8rem; margin-top:5px; font-weight:bold; display:none;"></div>
                    </div>
                </div>

                <div class="stage-section">
                    <h2 class="stage-title"><i class="fas fa-fire"></i> ON STAGE</h2>
                    <div class="stage-grid">
                        <div class="stage-card shorts-card">
                            <h3>üíÉ COSWALK COMP</h3>
                            <div class="phone-frame">
                                <iframe id="iframe-coswalk" class="video-iframe" src="" allowfullscreen></iframe>
                            </div>
                            <div id="playlist-coswalk" class="playlist-container"></div>
                        </div>

                        <div class="stage-card video-card">
                            <h3>üé≠ COSPLAY COMP</h3>
                            <div class="cinema-frame">
                                <iframe id="iframe-coscom" class="video-iframe" src="" allowfullscreen></iframe>
                            </div>
                            <div id="playlist-coscom" class="playlist-container"></div>
                        </div>
                    </div>
                </div>
                <div class="visitor-stats-container">
                    <div id="totalVisitorCount" class="big-counter">0</div>
                    <div class="counter-label"><i class="fas fa-eye"></i> Total Visitors</div>
                    
                    <div id="geoList" class="geo-list">
                        <div class="skeleton" style="height:50px; width:100%; margin-bottom:10px;"></div>
                        <div class="skeleton" style="height:50px; width:100%;"></div>
                    </div>
                </div>

            </div>
        </div>

        <div id="view-official" class="view-section">
            <h3 style="color:var(--primary); text-align:center; border-bottom:2px solid var(--primary); padding-bottom:10px;">üèÜ KLASEMEN OFFICIAL</h3>
            <div id="leaderboard-official">
                <div class="skeleton skeleton-card"></div>
                <div class="skeleton skeleton-card"></div>
            </div>
            <div id="empty-lb-official" style="text-align: center; color: #777; margin-top: 20px; display: none;">Belum ada Official Member.</div>
            
            <h3 style="color:var(--gold); margin-top:40px; border-left: 4px solid var(--gold); padding-left: 10px;">üìú Riwayat Juara (Official)</h3>
            
            <div class="search-container">
                <i class="fas fa-search search-icon"></i>
                <input type="text" id="searchOfficial" class="search-bar" placeholder="Cari data official..." onkeyup="prepareHistoryData('official')">
            </div>

            <div class="filter-tabs">
                <button class="filter-btn filter-btn-overall active" onclick="setHistoryFilter('all', this)">Overall</button>
                <button class="filter-btn" onclick="setHistoryFilter('Coswalk', this)">Coswalk</button>
                <button class="filter-btn" onclick="setHistoryFilter('Coscom', this)">Coscom</button>
            </div>

            <div id="history-official-list"></div>
            <div id="scroll-trigger-official" style="height: 30px; margin-top: 10px;"></div>
        </div>

        <div id="view-trainee" class="view-section">
            <h3 style="color:var(--sky-blue); text-align:center; border-bottom:2px solid var(--sky-blue); padding-bottom:10px;"><i class="fas fa-user-graduate"></i> KLASEMEN TRAINEE</h3>
            
            <div class="feed-card feed-trainee" style="margin-bottom: 20px;">
                <h3 style="margin-top:0; color:var(--sky-blue);">Apa itu Akang Trainee?</h3>
                <p style="font-size: 0.9rem; line-height: 1.5; color: #ddd; margin-bottom: 0;">
                    Akang Trainee adalah ruang pengembangan bagi cosplayer yang ingin terus berkembang dan meningkatkan kualitas diri dalam dunia performa dan kompetisi. Di sini, kita berlatih bersama, saling memberi evaluasi, dan belajar melalui pengalaman secara bertahap.
                </p>
            </div>

            <div id="leaderboard-trainee">
                 <div class="skeleton skeleton-card"></div>
                <div class="skeleton skeleton-card"></div>
            </div>
            <div id="empty-lb-trainee" style="text-align: center; color: #777; margin-top: 20px; display: none;">Belum ada Trainee.</div>

            <h3 style="color:var(--sky-blue); margin-top:40px; border-left: 4px solid var(--sky-blue); padding-left: 10px;">üìú Riwayat Juara (Trainee)</h3>
              
            <div class="search-container">
                <i class="fas fa-search search-icon"></i>
                <input type="text" id="searchTrainee" class="search-bar" placeholder="Cari data trainee..." onkeyup="prepareHistoryData('trainee')">
            </div>

            <div class="filter-tabs">
                <button class="filter-btn filter-btn-overall active" onclick="setHistoryFilter('all', this)">Overall</button>
                <button class="filter-btn" onclick="setHistoryFilter('Coswalk', this)">Coswalk</button>
                <button class="filter-btn" onclick="setHistoryFilter('Coscom', this)">Coscom</button>
            </div>

            <div id="history-trainee-list"></div>
            <div id="scroll-trigger-trainee" style="height: 30px; margin-top: 10px;"></div>
        </div>

        <div id="view-gamers" class="view-section">
            <div style="text-align: center; margin-bottom: 20px;">
                <h2 style="color: var(--accent-blue); margin-bottom: 5px;"><i class="fas fa-gamepad"></i> AKANG GAMERS</h2>
                <p style="color: #ccc; font-size: 0.9rem; margin-top: 0;">Divisi Livestream & Mabar Santai bareng Rein dan Nabilla! üéÆ‚ú®</p>
            </div>
            
            <div class="feed-card" style="border-left-color: var(--accent-blue);">
                <h3 style="margin-top:0;">Apa itu Akang Gamers?</h3>
                <p style="font-size: 0.9rem; line-height: 1.5; color: #ddd; margin-bottom: 0;">Akang Gamers adalah wadah seru-seruan dimana <b>Rein</b> dan <b>Nabilla</b> melakukan live streaming sambil main game dan ngobrol santai bareng para viewers. Walaupun kami cosplayer, kami juga suka mabar! Yuk gabung ke stream kami, jangan lupa bawa cemilan ya!</p>
            </div>

            <div style="display: flex; gap: 15px; margin-top: 20px; flex-wrap: wrap;">
                <div class="leaderboard-card glass-card" style="flex: 1; min-width: 250px; flex-direction: column; align-items: center; text-align: center; padding: 25px 15px;">
                    <img src="https://cdn-icons-png.flaticon.com/512/847/847969.png" id="img-gamer-rein" class="profile-pic" style="width: 90px; height: 90px; margin-bottom: 10px; border-color: var(--accent-blue);">
                    <h3 style="margin: 0; color: var(--gold);">Rein</h3>
                    <p style="font-size: 0.8rem; color: #aaa; margin: 5px 0 0 0;"><i class="fas fa-headset"></i> Streamer / Player</p>
                </div>

                <div class="leaderboard-card glass-card" style="flex: 1; min-width: 250px; flex-direction: column; align-items: center; text-align: center; padding: 25px 15px;">
                    <img src="https://cdn-icons-png.flaticon.com/512/847/847969.png" id="img-gamer-nabilla" class="profile-pic" style="width: 90px; height: 90px; margin-bottom: 10px; border-color: var(--purple);">
                    <h3 style="margin: 0; color: var(--gold);">Nabilla</h3>
                    <p style="font-size: 0.8rem; color: #aaa; margin: 5px 0 0 0;"><i class="fas fa-headset"></i> Streamer / Player</p>
                </div>
            </div>

            <div style="margin-top: 30px; background: rgba(0,0,0,0.2); border-radius: 15px; padding: 20px;">
                <h3 style="color: var(--accent-blue); text-align: center; margin-top: 0; margin-bottom: 15px; display: flex; align-items: center; justify-content: center; gap: 10px;">
                    <i class="fas fa-layer-group"></i> List Game Mabar
                </h3>
                <button id="btnAddGameBtn" class="admin-only" style="display: none; background: var(--green); color: white; border: none; padding: 10px 15px; border-radius: 8px; cursor: pointer; margin-bottom: 10px; width: 100%; font-weight: bold;" onclick="openModal('modalAddGame')"><i class="fas fa-plus"></i> Tambah Katalog Game</button>
                
                <div id="game-catalog-list" class="game-catalog-grid"></div>
            </div>
            
            <div style="text-align: center; margin-top: 25px; padding: 15px; background: rgba(0,0,0,0.2); border-radius: 15px;">
                <p style="color: var(--gold); font-weight: bold; margin-top: 0; margin-bottom: 15px;">Follow Sosmed Akang Gamers:</p>
                <div style="display: flex; gap: 10px; flex-wrap: wrap; justify-content: center;">
                    <button onclick="window.open('https://youtube.com/@akanggamers1372?si=_CfkHg0suu_eJqdq', '_blank')" style="background: #c4302b; color:white; border:none; width: auto; padding: 10px 20px; border-radius: 30px; cursor:pointer; font-weight:bold;">
                        <i class="fab fa-youtube"></i> YouTube
                    </button>
                    <button onclick="window.open('https://www.tiktok.com/@realaffiliate1372?_r=1&_t=ZS-93phwZphl7Y', '_blank')" style="background: #000000; color:white; border: 1px solid #444; width: auto; padding: 10px 20px; border-radius: 30px; cursor:pointer; font-weight:bold;">
                        <i class="fab fa-tiktok"></i> TikTok
                    </button>
                    <button onclick="window.open('https://www.instagram.com/akanggamersofc?igsh=OHBtMnBsdGh3N29z', '_blank')" style="background: linear-gradient(45deg, #f09433 0%, #e6683c 25%, #dc2743 50%, #cc2366 75%, #bc1888 100%); color:white; border:none; width: auto; padding: 10px 20px; border-radius: 30px; cursor:pointer; font-weight:bold;">
                        <i class="fab fa-instagram"></i> Instagram
                    </button>
                </div>
            </div>
        </div>

        <div id="view-events" class="view-section">
             <div style="text-align: center; margin-bottom: 20px;">
                <h2 style="color: var(--purple); margin-bottom: 5px;"><i class="fas fa-calendar-alt"></i> JADWAL EVENT</h2>
                <p style="color: #ccc; font-size: 0.9rem; margin-top: 0;">Agenda Deployment Pasukan Akang Cosplay</p>
            </div>

            <button class="admin-only" style="width: 100%; background: var(--green); color: white; padding: 12px; border: none; border-radius: 10px; font-weight: bold; margin-bottom: 20px; display: none;" onclick="openModal('modalAddEvent')">
                <i class="fas fa-plus-circle"></i> Tambah Jadwal Event
            </button>

            <div id="events-list">
                <div class="skeleton skeleton-card" style="height: 200px;"></div>
                <div class="skeleton skeleton-card" style="height: 200px;"></div>
            </div>
        </div>

        <div id="view-profile" class="view-section">
            <button style="background:none; border:none; color:#aaa; cursor:pointer; margin-bottom:10px;" onclick="switchView('official'); applyMode('official')">
                <i class="fas fa-arrow-left"></i> Kembali
            </button>
            
            <div class="profile-header glass-card">
                <div id="profileActionMenu" class="action-menu-container" style="display:none;">
                    <button class="btn-action-trigger" onclick="toggleActionDropdown()" id="btnPencil"><i class="fas fa-pen"></i></button>
                    <div id="actionDropdown" class="action-dropdown">
                        <button class="dropdown-item" onclick="openEditModal()"><i class="fas fa-user-edit"></i> Edit Biodata</button>
                        <button class="dropdown-item" onclick="toggleManagePostsMode()"><i class="fas fa-images"></i> Atur Postingan</button>
                        <button class="dropdown-item danger admin-only" id="btnDelMemberMenu" onclick="deleteCurrentMember()"><i class="fas fa-trash"></i> Hapus Member</button>
                    </div>
                </div>

                <div id="savePostModeBtn" class="action-menu-container" style="display:none;">
                      <button class="btn-action-trigger saving" onclick="toggleManagePostsMode()"><i class="fas fa-check"></i></button>
                </div>
                
                <img src="" id="p-photo" class="profile-pic">
                <h2 id="p-name" style="color:var(--primary); margin: 10px 0 5px 0;">Nama</h2>
                
                <div id="p-status-badge" style="display:inline-block; padding:3px 10px; border-radius:10px; font-size:0.75rem; margin-bottom:10px; font-weight:bold; border:1px solid #777;">STATUS</div>
                <br>

                <a id="p-ig" href="#" target="_blank" class="social-badge" style="display:none;"><i class="fab fa-instagram"></i> Instagram</a>
                <a id="p-wa" href="#" target="_blank" class="social-badge whatsapp" style="display:none;"><i class="fab fa-whatsapp"></i> WhatsApp</a>
                
                <p id="p-bio" style="font-style:italic; color:#ccc; margin-top: 5px;">Bio...</p>
                <div style="display: flex; justify-content: center; gap: 20px; margin-top: 15px;">
                    <div><span id="p-stat-coswalk" style="font-size: 1.5rem; font-weight:bold; color:var(--accent-blue);">0</span><br><small>Coswalk</small></div>
                    <div><span id="p-stat-comp" style="font-size: 1.5rem; font-weight:bold; color:var(--gold);">0</span><br><small>Comp</small></div>
                </div>
            </div>

            <div class="gallery-section">
                <h3 style="display:flex; justify-content:space-between; align-items:center;">
                    <span>üì∏ Galeri Kostum</span>
                    <small style="font-size:0.7em; font-weight:normal; color:#777;">(Grid 1:1)</small>
                </h3>
                
                <button class="btn-add-photo" onclick="document.getElementById('galleryInput').click()">
                    <i class="fas fa-camera"></i> Tambah Foto ke Galeri
                </button>
                <input type="file" id="galleryInput" hidden accept="image/*" onchange="uploadGalleryPhoto(this)">

                <div id="p-gallery-grid" class="gallery-grid"></div>
            </div>

            <h3>üé≠ Repertoire</h3>
            <div id="p-repertoire" style="margin-bottom: 20px;"></div>

            <h3>üìú Riwayat Juara</h3>
            <div id="p-history-list"></div>
        </div>
    </div>

    <div class="fab-container">
        <div id="fabMenu" class="fab-menu">
            <button onclick="toggleFabMenu(); openBotModal()" style="border-color: var(--accent-blue);">üí¨ Tanya Akang</button>
            <button id="fabBtnWin" class="admin-only" style="display: none;" onclick="toggleFabMenu(); openModalWin()">üèÜ Input Menang</button>
        </div>
        <button class="btn-fab" onclick="toggleFabMenu()" title="Menu"><i class="fas fa-plus"></i></button>
    </div>

    <div id="lightbox" class="lightbox-modal">
        <button class="lightbox-close" onclick="closeLightbox()">&times;</button>
        <img id="lightboxImg" class="lightbox-img" src="">
    </div>

    <div id="modalAuth" class="modal">
        <div class="modal-content">
            <div class="auth-tabs">
                <button class="auth-tab-btn active" onclick="switchAuthTab('login')">Login</button>
                <button class="auth-tab-btn" onclick="switchAuthTab('register')">Daftar Member</button>
            </div>
            <div id="formLogin">
                <label>Email</label><input type="email" id="loginEmail">
                <label>Password</label><input type="password" id="loginPass">
                <button class="btn-submit" id="btnLogin" onclick="login()">Masuk</button>
                <p id="loginError" style="color:var(--danger); font-size:0.9rem; margin-top:10px;"></p>
            </div>
            <div id="formRegister" class="hidden">
                <p style="color:#aaa; font-size:0.9rem; margin-bottom:15px;">Buat akun member baru untuk mulai mengisi portofolio coslpay-mu!</p>
                <label>Email</label><input type="email" id="regEmail">
                <label>Password (Min 6 Karakter)</label><input type="password" id="regPass">
                <hr style="border-color:#444; margin: 15px 0;">
                <label>Nama Panggung / Cosplayer</label><input type="text" id="regName">
                
                <label>No. WhatsApp (Wajib)</label>
                <input type="number" id="regWa" placeholder="08xxxxxxxx">
                <small style="color:#777; display:block; margin-bottom:10px;">Untuk koordinasi admin. Privasi bisa diatur nanti.</small>

                <label>Bio Singkat</label><textarea id="regBio" rows="2"></textarea>
                <label>Link Instagram</label><input type="text" id="regIg" placeholder="@username">
                <button class="btn-submit" id="btnRegister" style="background:var(--green);" onclick="registerUser()">Daftar & Buat Profil</button>
                <p id="regError" style="color:var(--danger); font-size:0.9rem; margin-top:10px;"></p>
            </div>
            <button style="margin-top:10px; width:100%; background:none; border:none; color:#aaa;" onclick="closeModal('modalAuth')">Batal</button>
        </div>
    </div>

    <div id="modalAddGame" class="modal">
        <div class="modal-content">
            <h3 style="color: var(--accent-blue);"><i class="fas fa-gamepad"></i> Tambah Katalog Game</h3>
            <label>Nama Game</label><input type="text" id="addGameName" placeholder="Contoh: Valorant">
            <label>Gambar Cover Game</label><input type="file" id="addGameImage" accept="image/*">
            <button class="btn-submit" id="btnSaveGame" onclick="submitAddGame()">Simpan Game</button>
            <button style="margin-top:10px; width:100%; background:none; border:none; color:#aaa;" onclick="closeModal('modalAddGame')">Batal</button>
        </div>
    </div>

    <div id="modalAddEvent" class="modal">
        <div class="modal-content">
            <h3 style="color: var(--purple);"><i class="fas fa-calendar-plus"></i> Tambah Event Baru</h3>
            
            <label>Nama Event</label><input type="text" id="evtName">
            <label>Tipe Event</label>
            <select id="evtType">
                <option value="Coswalk Competition">Coswalk Competition</option>
                <option value="Cosplay Competition">Cosplay Competition</option>
            </select>
            
            <label>Tanggal & Waktu</label><input type="datetime-local" id="evtDate">
            <label>Lokasi</label><input type="text" id="evtLoc">
            <label>Juri (Pisahkan koma)</label><input type="text" id="evtJudges" placeholder="Rein, Nabilla, dll">
            
            <label>Poster Event</label><input type="file" id="evtPoster" accept="image/*">

            <hr style="border-color:#444; margin:15px 0;">
            <label style="color:var(--gold);">Kategori Juara & Hadiah</label>
            <div id="evtPrizesContainer"></div>
            <button onclick="addEventCategoryInput()" style="background:var(--dark); border:1px dashed #777; color:#aaa; width:100%; padding:8px; margin-bottom:15px;">+ Tambah Kategori</button>

            <label>Rundown (Opsional)</label>
            <textarea id="evtRundown" rows="4" placeholder="10:00 - Open Gate..."></textarea>

            <button class="btn-submit" id="btnSaveEvent" onclick="submitEvent()">Publish Event</button>
            <button style="margin-top:10px; width:100%; background:none; border:none; color:#aaa;" onclick="closeModal('modalAddEvent')">Batal</button>
        </div>
    </div>

    <div id="modalEdit" class="modal">
        <div class="modal-content">
            <h3>‚úèÔ∏è Edit Profil Saya</h3>
            <input type="hidden" id="editId">
            <label>Nama</label><input type="text" id="editName">
            <label>Jabatan / Role</label><input type="text" id="editRole" placeholder="Contoh: Founder / Cosplayer">
            
            <div style="background:rgba(37, 211, 102, 0.1); padding:10px; border-radius:8px; border:1px solid #25D366; margin-bottom:10px;">
                <label style="color:#25D366;"><i class="fab fa-whatsapp"></i> Pengaturan WhatsApp</label>
                <input type="number" id="editWa" placeholder="08xxxxxxxx">
                <label style="font-size:0.8rem; color:#aaa;">Privasi Nomor:</label>
                <select id="editWaPrivacy">
                    <option value="hidden">üîí Sembunyikan (Hanya Admin)</option>
                    <option value="public">üåç Tampilkan di Profil (Publik)</option>
                </select>
            </div>

            <div id="adminStatusControl" class="admin-only" style="background: rgba(255, 165, 2, 0.1); padding: 10px; border-radius: 8px; margin-bottom: 10px; border: 1px solid var(--gold);">
                <label style="color: var(--gold);"><i class="fas fa-crown"></i> Status (Admin Only)</label>
                <select id="editStatus"><option value="official">Official Member</option><option value="trainee">Akang Trainee</option></select>
            </div>

            <div id="adminAchievementControl" class="admin-only" style="background: rgba(255, 215, 0, 0.1); padding: 10px; border-radius: 8px; margin-bottom: 10px; border: 1px solid var(--gold);">
                 <label style="color: var(--gold);"><i class="fas fa-trophy"></i> Highlight Achievement (Admin Only)</label>
                 <input type="text" id="editTopAchievement" placeholder="Cth: Juara 1 CLAS:H 2024" style="margin-bottom:0;">
                 <small style="color:#aaa; font-size:0.75rem;">Akan muncul di halaman depan (About Us).</small>
            </div>

            <label>Bio</label><textarea id="editBio" rows="2"></textarea>
            <label>Instagram</label><input type="text" id="editIg">
            <label>Foto Baru</label><input type="file" id="editPhoto" accept="image/*">
            <label>Tambah Kostum</label>
            <div style="display:flex; gap:5px;">
                <input type="text" id="repInput" placeholder="Nama Karakter...">
                <button onclick="addRepertoireTag()" style="width:50px; background:var(--accent-blue); border:none; color:white; border-radius:5px;">+</button>
            </div>
            <div id="editRepList" style="margin-top:10px;"></div>
            <button class="btn-submit" id="btnSaveProfile" onclick="saveEditProfile()">Update Profil</button>
            <button style="margin-top:10px; width:100%; background:none; border:none; color:#aaa;" onclick="closeModal('modalEdit')">Batal</button>
        </div>
    </div>

    <div id="modalSettings" class="modal">
        <div class="modal-content">
            <h3>‚öôÔ∏è Settings</h3>
            <div style="background: #2c3e50; padding: 15px; border-radius: 8px; margin-bottom: 20px; border: 1px solid #3498db;">
                <h4 style="margin-top:0; color:#3498db;">üõ†Ô∏è Migrasi Data (Darurat)</h4>
                <div id="migrationList"></div>
            </div>
            <button style="margin-top:10px; width:100%; background:none; border:none; color:#aaa;" onclick="closeModal('modalSettings')">Tutup</button>
        </div>
    </div>

    <div id="modalSuperAdmin" class="modal">
        <div class="modal-content">
            <h3 style="color:var(--gold);"><i class="fas fa-lock"></i> Mode Dewa</h3>
            
            <div style="margin-bottom:20px; border-bottom:1px solid #555; padding-bottom:15px;">
                 <label style="color:var(--accent-blue);">Backup Data</label>
                 <button class="btn-backup" onclick="downloadBackupData()">‚¨áÔ∏è Download Backup</button>
            </div>

            <label>Logo Default (Cosplay)</label>
            <input type="file" id="settingLogo" accept="image/*">
            <button onclick="saveLogo()" style="background:#555; color:white; border:none; padding:8px; width:100%; margin-bottom:15px; border-radius: 5px;">Simpan Default</button>
            
            <label style="color: var(--accent-blue)">Logo "Akang Gamers"</label>
            <input type="file" id="settingGamersLogo" accept="image/*">
            <button onclick="saveGamersLogo()" style="background:#555; color:white; border:none; padding:8px; width:100%; margin-bottom:15px; border-radius: 5px;">Simpan Gamers</button>

             <label style="color: var(--sky-blue)">Logo "Akang Trainee"</label>
            <input type="file" id="settingTraineeLogo" accept="image/*">
            <button onclick="saveTraineeLogo()" style="background:#555; color:white; border:none; padding:8px; width:100%; margin-bottom:15px; border-radius: 5px;">Simpan Trainee</button>

            <div style="background: rgba(230, 126, 34, 0.1); border: 1px solid #e67e22; padding: 15px; border-radius: 8px; margin-top: 20px;">
                <label style="color:var(--gold);">üî• Restore Data</label>
                <input type="file" id="restoreFile" accept=".json" style="margin-bottom: 10px;">
                <button class="btn-restore" onclick="restoreToFirebase()">‚¨ÜÔ∏è Upload JSON</button>
            </div>
            
            <button style="margin-top:10px; width:100%; background:none; border:none; color:#aaa;" onclick="closeModal('modalSuperAdmin')">Tutup</button>
        </div>
    </div>

    <div id="modalWin" class="modal">
        <div class="modal-content">
            <h3>üèÜ Input Kemenangan</h3>
            <input type="hidden" id="winEditId">
            
            <label>Siapa yang menang? (Utama)</label><select id="winMember"></select>
            
            <label>Format</label>
            <select id="winFormat" onchange="toggleTeammateInput()">
                <option value="Single">Single (Solo)</option>
                <option value="Duo">Duo (2 Orang)</option>
                <option value="Squad">Squad / Cabaret (Tim)</option>
            </select>

            <div id="teammatesSection" class="hidden" style="background:rgba(255,255,255,0.05); padding:10px; margin-bottom:10px; border-radius:5px;">
                <label style="color:var(--sky-blue);">Partner / Tim</label>
                <div id="teammatesContainer"></div>
                <button onclick="addTeammateInput()" style="background:var(--dark); border:1px dashed #777; color:#aaa; width:100%; padding:8px; margin-top:5px;">+ Tambah Partner</button>
            </div>

            <label>Nama Event</label><input type="text" id="winEvent">
            <label>Kategori</label>
            <select id="winCat"><option value="Coswalk">Coswalk</option><option value="Cosplay Competition">Cosplay Competition</option></select>
            
            <label>Karakter</label>
            <div class="char-select-group">
                <select id="winCharSelect" onchange="checkCharSelect(this)">
                    <option value="">-- Pilih Kostum --</option>
                </select>
                <button onclick="toggleManualCharInput()" id="btnToggleManualChar" title="Input Manual"><i class="fas fa-keyboard"></i></button>
            </div>
            <input type="text" id="winCharManual" class="hidden" placeholder="Nama Karakter (Manual)..." style="border:1px solid var(--gold);">
            <small id="winCharManualHint" class="hidden" style="color:var(--gold); display:block; margin-bottom:10px;">*Hanya disimpan di riwayat, tidak masuk Repertoire.</small>
            
            <label>Tanggal Event</label><input type="date" id="winDate">
            <label>Juara Ke-</label>
            <select id="winRank" onchange="toggleBestInput()"><option value="1">Juara 1</option><option value="2">Juara 2</option><option value="3">Juara 3</option><option value="Best">Best / Fav</option></select>
            <div id="divBestTitle" class="hidden"><label style="color:var(--gold);">Detail Best</label><input type="text" id="winBestTitle"></div>
            <label>Nama Juri</label><input type="text" id="winJudges">
            <label>Bukti Foto</label><input type="file" id="winProof" accept="image/*">
            <button id="btnSaveWin" class="btn-submit" onclick="submitWin()">Simpan Data</button>
            <button style="margin-top:10px; width:100%; background:none; border:none; color:#aaa;" onclick="closeModal('modalWin')">Batal</button>
        </div>
    </div>

    <div id="modalBot" class="modal">
        <div class="modal-content" style="padding: 15px; display: flex; flex-direction: column;">
            <h3 style="margin-top:0; margin-bottom: 5px; color:var(--accent-blue); display:flex; justify-content:space-between; flex-shrink: 0;">
                <span>ü§ñ Akang Bot</span>
                <i class="fas fa-times" style="cursor:pointer; color:#777;" onclick="closeModal('modalBot')"></i>
            </h3>
            <div class="bot-layout">
                <div class="bot-menu-section" id="chatOptions"></div>
                <div class="bot-chat-section">
                    <div id="chatArea" class="chat-box"></div>
                    <div class="chat-input-area">
                        <input type="text" id="chatInput" placeholder="Ketik pertanyaan (cth: 'cara join?')..." onkeypress="handleChatEnter(event)">
                        <button onclick="sendCustomMessage()"><i class="fas fa-paper-plane"></i></button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let defaultLogoUrl = ""; let gamersLogoUrl = ""; let traineeLogoUrl = "";
        let isInitialLoad = true; 

        // --- 1. CONFIG PLAYLIST VIDEO ---
        const playlistCoswalk = [
            { id: "4acprM6vacI", title: "Rein as Deathstroke (Coswalk)" },
            { id: "o3_dOYsWwP4", title: "Nabilla as Azula (Coswalk)" },
            { id: "gz_C3uKMpEQ", title: "Nabilla as Corin Wickes" },
            { id: "agl3CnrIX44", title: "Rein as Scorpion" },
            { id: "a6ae4ACV5d0", title: "Rein as Batman Who Laughs" }
        ];

        const playlistCoscom = [
            { id: "jRj79denqgY", title: "Kanekian as Date Masamune (ANICO)" },
            { id: "8Z5NjhLztSk", title: "Nabilla as Corin Wickes (ANICO)" },
            { id: "6rS19hpDyhQ", title: "Rein as Deathstroke (ANICO)" },
            { id: "LjM-i9pWJLE", title: "Dante & Vergil (CJA Entertainment)" },
            { id: "oz8lNgJS8Rg", title: "Rein as Deathstroke (Midori 4)" }
        ];
        
        const firebaseConfig = {
            apiKey: "AIzaSyDTzkh9BbSf1qpCiCDru3JibPi-G8nokfQ", 
            authDomain: "website-akang-cosplay.firebaseapp.com",
            projectId: "website-akang-cosplay",
            storageBucket: "website-akang-cosplay.firebasestorage.app",
            messagingSenderId: "557981115525",
            appId: "1:557981115525:web:114b2422264d816a71f5ec",
            measurementId: "G-NFGQPP01VE"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const auth = firebase.auth();

        let members = []; let games = []; let events = []; let currentTempRepertoire = [];
        let isRein = false; let isAdmin = false; let currentUser = null; 
        let isManagePostMode = false;
        const ADMIN_HASH = "240be518fabd2724ddb6f04eeb1da5967448d7e831c08c8fa822809f74c720a9"; 
        
        let currentHistoryData = []; let currentHistoryDisplayCount = 0; const HISTORY_BATCH_SIZE = 5; 
        let activeHistoryType = ''; let activeFilterCategory = 'all';
        let currentLang = 'id';

        function escapeHtml(text) { if (!text) return ""; if (typeof text !== "string") return text; return text.replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;").replace(/"/g, "&quot;").replace(/'/g, "&#039;"); }

        function compressImage(file, maxWidth = 1000, quality = 0.8) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.readAsDataURL(file);
                reader.onload = (event) => {
                    const img = new Image();
                    img.src = event.target.result;
                    img.onload = () => {
                        const canvas = document.createElement('canvas');
                        let width = img.width;
                        let height = img.height;
                        if (width > height) { if (width > maxWidth) { height *= maxWidth / width; width = maxWidth; } } 
                        else { if (height > maxWidth) { width *= maxWidth / height; height = maxWidth; } }
                        canvas.width = width; canvas.height = height;
                        const ctx = canvas.getContext('2d');
                        ctx.drawImage(img, 0, 0, width, height);
                        resolve(canvas.toDataURL('image/webp', quality));
                    };
                    img.onerror = (err) => reject(err);
                };
                reader.onerror = (err) => reject(err);
            });
        }

        auth.onAuthStateChanged((user) => {
            currentUser = user;
            if(currentUser && currentUser.email === "reinkogeki@gmail.com") { isRein = true; } else { isRein = false; isAdmin = false; }
            updateAuthUI();
        });

        let debounceTimer;
        db.collection("members").onSnapshot((snapshot) => {
            clearTimeout(debounceTimer);
            debounceTimer = setTimeout(() => { 
                members = []; 
                snapshot.forEach((doc) => { 
                    const data = doc.data();
                    data.id = doc.id; 
                    members.push(data); 
                }); 
                renderAll();
                
                // Hide splash screen logic
                if(isInitialLoad) {
                    const overlay = document.getElementById('loadingOverlay');
                    overlay.style.opacity = '0';
                    setTimeout(() => overlay.style.display = 'none', 500);
                    isInitialLoad = false;
                    checkTutorial(); // NEW: Trigger Tutorial
                }
            }, 500);
        });

        db.collection("games").onSnapshot((snapshot) => { games = []; snapshot.forEach((doc) => { const d = doc.data(); d.id = doc.id; games.push(d); }); if(document.getElementById('view-gamers').classList.contains('active')) renderGames(); });
        
        db.collection("events").orderBy('date', 'asc').onSnapshot((snapshot) => { 
            events = []; 
            snapshot.forEach((doc) => { 
                const d = doc.data(); d.id = doc.id; events.push(d); 
            });
            if(document.getElementById('view-events').classList.contains('active')) renderEvents();
        });

        // SETTINGS SNAPSHOT (UPDATED TO SUPPORT LOADING LOGO)
        db.collection("settings").doc("global").onSnapshot((doc) => { 
            if(doc.exists && doc.data().logo) { 
                defaultLogoUrl = doc.data().logo; 
                document.getElementById('loadingLogo').src = defaultLogoUrl; // Update loading screen
                if(document.getElementById('view-about').classList.contains('active')) { document.getElementById('about-logo').src = defaultLogoUrl; } 
                if(!document.getElementById('view-gamers').classList.contains('active') && !document.getElementById('view-trainee').classList.contains('active')) { document.getElementById('teamLogo').src = defaultLogoUrl; document.getElementById('teamLogo').style.display = "block"; } 
            } 
        });
        db.collection("settings").doc("gamers").onSnapshot((doc) => { if(doc.exists && doc.data().logo) { gamersLogoUrl = doc.data().logo; if(document.getElementById('view-gamers').classList.contains('active')) { document.getElementById('teamLogo').src = gamersLogoUrl; document.getElementById('teamLogo').style.display = "block"; } } });
        db.collection("settings").doc("trainee").onSnapshot((doc) => { if(doc.exists && doc.data().logo) { traineeLogoUrl = doc.data().logo; if(document.getElementById('view-trainee').classList.contains('active')) { document.getElementById('teamLogo').src = traineeLogoUrl; document.getElementById('teamLogo').style.display = "block"; } } });

        // --- PLAYLIST LOGIC ---
        function renderPlaylists() {
            renderPlaylist('coswalk', playlistCoswalk);
            renderPlaylist('coscom', playlistCoscom);
            if(playlistCoswalk.length > 0) changeVideo('coswalk', playlistCoswalk[0].id);
            if(playlistCoscom.length > 0) changeVideo('coscom', playlistCoscom[0].id);
        }

        function renderPlaylist(type, list) {
            const container = document.getElementById(`playlist-${type}`);
            container.innerHTML = "";
            list.forEach((item, index) => {
                const thumbUrl = `https://img.youtube.com/vi/${item.id}/default.jpg`;
                container.innerHTML += `
                    <div class="playlist-item" onclick="changeVideo('${type}', '${item.id}', this)">
                        <img src="${thumbUrl}" class="playlist-thumb">
                        <div class="playlist-info">
                            <strong>${item.title}</strong>
                            <span style="color:#777;">Putar Video</span>
                        </div>
                    </div>
                `;
            });
            const firstItem = container.querySelector('.playlist-item');
            if(firstItem) firstItem.classList.add('active');
        }

        function changeVideo(type, id, element) {
            const iframe = document.getElementById(`iframe-${type}`);
            iframe.src = `https://www.youtube.com/embed/${id}?autoplay=1`;
            if(element) {
                const container = document.getElementById(`playlist-${type}`);
                container.querySelectorAll('.playlist-item').forEach(el => el.classList.remove('active'));
                element.classList.add('active');
            }
        }
        renderPlaylists();

        // --- AUTH & UI LOGIC ---
        function updateAuthUI() {
            const btn = document.getElementById('authBtn'); const dropdown = document.getElementById('userDropdown'); const adminBadge = document.getElementById('adminBadge');
            if (isAdmin) { adminBadge.style.display = 'block'; document.querySelectorAll('.admin-only').forEach(b => b.style.display = 'block'); } 
            else { adminBadge.style.display = 'none'; document.querySelectorAll('.admin-only').forEach(b => b.style.display = 'none'); }

            if (currentUser) {
                const myProfile = members.find(m => m.id === currentUser.uid);
                const photoUrl = myProfile && myProfile.photo ? myProfile.photo : 'https://cdn-icons-png.flaticon.com/512/847/847969.png';
                const safeName = escapeHtml(myProfile ? myProfile.name : 'Member');
                btn.innerHTML = `<img src="${photoUrl}" class="user-avatar-mini"> ${safeName} <i class="fas fa-caret-down"></i>`;
                btn.onclick = toggleUserMenu; 
                let adminMenuHTML = isRein ? (isAdmin ? `<button class="dropdown-item active-admin" onclick="toggleAdminMode()"><i class="fas fa-toggle-on"></i> Matikan Mode Dewa</button><button class="dropdown-item gold" onclick="openModal('modalSuperAdmin')"><i class="fas fa-cogs"></i> Super Dashboard</button>` : `<button class="dropdown-item danger" onclick="toggleAdminMode()"><i class="fas fa-toggle-off"></i> Aktifkan Mode Dewa</button>`) : "";
                dropdown.innerHTML = `<button class="dropdown-item" onclick="openProfile('${currentUser.uid}')"><i class="fas fa-user"></i> Profil Saya</button><button class="dropdown-item" onclick="openModal('modalSettings')"><i class="fas fa-exchange-alt"></i> Settings (Migrasi)</button>${adminMenuHTML}<button class="dropdown-item" onclick="logout()" style="border-top:1px solid #555;"><i class="fas fa-sign-out-alt"></i> Logout</button>`;
            } else {
                btn.innerHTML = `<i class="fas fa-sign-in-alt"></i> Login`; btn.onclick = openAuthModal; dropdown.innerHTML = ""; isAdmin = false;
            }
            renderAll();
        }

        async function toggleAdminMode() {
            document.getElementById('userDropdown').classList.remove('show');
            if (isAdmin) { isAdmin = false; alert("Mode Dewa Dinonaktifkan."); updateAuthUI(); } 
            else { let pass = prompt("Masukkan Password Mode Dewa:"); if(pass) { const hash = await sha256(pass); if(hash === ADMIN_HASH) { isAdmin = true; alert("Mode Dewa AKTIF!"); updateAuthUI(); } else { alert("Password Salah!"); } } }
        }

        function toggleUserMenu() { document.getElementById('userDropdown').classList.toggle('show'); }
        window.addEventListener('click', function(e) { if (!document.getElementById('authBtn').contains(e.target) && !document.getElementById('userDropdown').contains(e.target)) { document.getElementById('userDropdown').classList.remove('show'); } });
        
        function toggleActionDropdown() { document.getElementById('actionDropdown').classList.toggle('show'); }
        window.addEventListener('click', function(e) { if (!document.getElementById('btnPencil').contains(e.target) && !document.getElementById('actionDropdown').contains(e.target)) { document.getElementById('actionDropdown').classList.remove('show'); } });

        // --- NEW: TUTORIAL LOGIC ---
        let tutStep = 0;
        function checkTutorial() {
            if(!localStorage.getItem('akang_tutorial_done')) {
                setTimeout(() => { document.getElementById('tutorialOverlay').style.display = 'flex'; }, 1000);
            }
        }
        function skipTutorial() {
            localStorage.setItem('akang_tutorial_done', 'true');
            document.getElementById('tutorialOverlay').style.display = 'none';
        }
        function nextTutorial() {
            const txt = document.getElementById('tutorialText');
            tutStep++;
            if(tutStep === 1) {
                txt.innerHTML = "Gunakan tombol <b>Login</b> di kanan atas untuk membuat akun dan mencatat prestasi cosplay-mu!";
            } else if(tutStep === 2) {
                txt.innerHTML = "Gunakan tombol <b>(+)</b> di pojok kanan bawah untuk menginput data kemenangan baru.";
            } else {
                skipTutorial();
            }
        }

        // --- NEW: LANGUAGE LOGIC ---
        const langData = {
            id: { welcome: "Selamat datang di akang cosplay, mohon menunggu sebentar...", search: "Cari data...", home: "Home" },
            en: { welcome: "Welcome to Akang Cosplay, please wait...", search: "Search data...", home: "Home" }
        };
        function setLang(l) {
            currentLang = l;
            document.querySelectorAll('.lang-btn').forEach(b => b.classList.remove('active'));
            event.target.classList.add('active');
            // Update UI Texts
            document.getElementById('loadingText').innerText = langData[l].welcome;
            document.getElementById('searchOfficial').placeholder = langData[l].search;
            document.getElementById('searchTrainee').placeholder = langData[l].search;
        }

        // --- NEW: REPERTOIRE MANUAL LOGIC ---
        let useManualChar = false;
        function toggleManualCharInput() {
            useManualChar = !useManualChar;
            const sel = document.getElementById('winCharSelect');
            const inp = document.getElementById('winCharManual');
            const hint = document.getElementById('winCharManualHint');
            const btn = document.getElementById('btnToggleManualChar');
            
            if(useManualChar) {
                sel.classList.add('hidden'); inp.classList.remove('hidden'); hint.classList.remove('hidden');
                btn.classList.add('active');
            } else {
                sel.classList.remove('hidden'); inp.classList.add('hidden'); hint.classList.add('hidden');
                btn.classList.remove('active');
            }
        }
        function populateCharDropdown(mid) {
            const m = members.find(x => x.id === mid);
            const sel = document.getElementById('winCharSelect');
            sel.innerHTML = `<option value="">-- Pilih Kostum --</option>`;
            if(m && m.repertoire) {
                m.repertoire.forEach(r => sel.innerHTML += `<option value="${r}">${r}</option>`);
            }
        }
        function checkCharSelect(el) { /* Hook if needed */ }


        function toggleManagePostsMode() {
            isManagePostMode = !isManagePostMode;
            const profileView = document.getElementById('view-profile');
            const menuContainer = document.getElementById('profileActionMenu');
            const saveContainer = document.getElementById('savePostModeBtn');
            const dropdown = document.getElementById('actionDropdown');
            dropdown.classList.remove('show'); 
            if (isManagePostMode) {
                profileView.classList.add('delete-mode-active');
                menuContainer.style.display = 'none'; 
                saveContainer.style.display = 'block'; 
            } else {
                profileView.classList.remove('delete-mode-active');
                menuContainer.style.display = 'block'; 
                saveContainer.style.display = 'none'; 
            }
        }

        function openAuthModal() { document.getElementById('modalAuth').style.display = 'flex'; switchAuthTab('login'); document.getElementById('loginError').innerText = ""; document.getElementById('regError').innerText = ""; }
        function switchAuthTab(tab) { document.querySelectorAll('.auth-tab-btn').forEach(b => b.classList.remove('active')); if(tab === 'login') { document.querySelector('.auth-tab-btn:first-child').classList.add('active'); document.getElementById('formLogin').classList.remove('hidden'); document.getElementById('formRegister').classList.add('hidden'); } else { document.querySelector('.auth-tab-btn:last-child').classList.add('active'); document.getElementById('formLogin').classList.add('hidden'); document.getElementById('formRegister').classList.remove('hidden'); } }
        
        function setLoading(btnId, isLoading, text) {
            const btn = document.getElementById(btnId);
            if(isLoading) { btn.disabled = true; btn.innerHTML = `<i class="fas fa-spinner fa-spin"></i> ${text}`; btn.style.cursor = 'wait'; } 
            else { btn.disabled = false; btn.innerHTML = text; btn.style.cursor = 'pointer'; }
        }

        function login() { 
            const email = document.getElementById('loginEmail').value; 
            const pass = document.getElementById('loginPass').value; 
            const err = document.getElementById('loginError'); 
            
            if(!email || !pass) { err.innerText = "Isi semua!"; return; }
            setLoading('btnLogin', true, 'Masuk...');

            auth.signInWithEmailAndPassword(email, pass).then(() => { 
                closeModal('modalAuth'); 
                setLoading('btnLogin', false, 'Masuk');
            }).catch((error) => { 
                err.innerText = error.message; 
                setLoading('btnLogin', false, 'Masuk');
            }); 
        }

        function logout() { auth.signOut().then(() => { switchView('official'); }); }
        
        function registerUser() { 
            const email = document.getElementById('regEmail').value; 
            const pass = document.getElementById('regPass').value; 
            const name = document.getElementById('regName').value; 
            const wa = document.getElementById('regWa').value; 
            const bio = document.getElementById('regBio').value; 
            const ig = document.getElementById('regIg').value; 
            const err = document.getElementById('regError'); 
            
            if(!email || !pass || !name || !wa) { err.innerText = "Isi semua, termasuk WhatsApp!"; return; } 
            if(pass.length < 6) { err.innerText = "Min 6 karakter"; return; } 
            
            setLoading('btnRegister', true, 'Mendaftar...');

            auth.createUserWithEmailAndPassword(email, pass).then((userCredential) => { 
                const user = userCredential.user; 
                const newMember = { 
                    id: user.uid, 
                    name: name, 
                    bio: bio, 
                    ig: ig, 
                    wa: wa,             
                    waPrivacy: 'hidden', 
                    photo: null, 
                    history: [], 
                    repertoire: [], 
                    gallery: [], 
                    status: 'trainee' 
                }; 
                db.collection("members").doc(user.uid).set(newMember).then(() => { 
                    closeModal('modalAuth'); 
                    setLoading('btnRegister', false, 'Daftar & Buat Profil');
                }).catch(e => { err.innerText = e.message; setLoading('btnRegister', false, 'Daftar & Buat Profil'); }); 
            }).catch((error) => { err.innerText = error.message; setLoading('btnRegister', false, 'Daftar & Buat Profil'); }); 
        }

        function renderMigrationList() { const container = document.getElementById('migrationList'); container.innerHTML = ""; const candidates = members.filter(m => currentUser && m.id !== currentUser.uid); if(candidates.length === 0) { container.innerHTML = "Kosong."; return; } candidates.forEach(m => { container.innerHTML += `<div style="margin-bottom:10px;"><strong>${escapeHtml(m.name)}</strong> (${m.history ? m.history.length : 0} Wins) <button onclick="executeMigration('${m.id}')">Ambil</button></div>`; }); }
        async function executeMigration(oldId) { if(!confirm("Timpa akun ini dengan data lama?")) return; const user = firebase.auth().currentUser; try { const docLama = await db.collection('members').doc(oldId.toString()).get(); const dataLama = docLama.data(); const dataBaru = { ...dataLama, id: user.uid }; await db.collection('members').doc(user.uid).set(dataBaru); await db.collection('members').doc(oldId.toString()).delete(); location.reload(); } catch (e) { alert("Gagal: " + e.message); } }
        async function sha256(message) { const msgBuffer = new TextEncoder().encode(message); const hashBuffer = await crypto.subtle.digest('SHA-256', msgBuffer); const hashArray = Array.from(new Uint8Array(hashBuffer)); return hashArray.map(b => b.toString(16).padStart(2, '0')).join(''); }
        
        function switchView(view) {
            document.querySelectorAll('.view-section').forEach(el => el.classList.remove('active'));
            document.querySelectorAll('.nav-btn').forEach(el => el.classList.remove('active'));
            document.getElementById('view-' + view).classList.add('active');
            
            const header = document.getElementById('mainHeader'); const title = document.getElementById('headerTitle'); const estText = document.getElementById('headerEst'); const logo = document.getElementById('teamLogo');
            
            // --- CLEAN ALL MODES ---
            header.classList.remove('gamers-mode'); 
            header.classList.remove('trainee-mode');
            header.classList.remove('event-mode'); // Added in v18

            document.querySelectorAll('.nav-btn').forEach(btn => btn.classList.remove('active'));

            if(view === 'gamers') {
                document.querySelector('.nav-btn-gamers').classList.add('active'); header.classList.add('gamers-mode'); title.innerText = "AKANG GAMERS"; title.classList.add('title-gamers'); estText.innerText = "EST. 2026";
                if(gamersLogoUrl) { logo.src = gamersLogoUrl; logo.style.display = "block"; } else if(defaultLogoUrl) { logo.src = defaultLogoUrl; logo.style.display = "block"; }
                renderGamers(); 
            } else if(view === 'trainee') {
                document.querySelector('.nav-btn-trainee').classList.add('active'); header.classList.add('trainee-mode'); title.innerText = "AKANG TRAINEE"; title.classList.remove('title-gamers'); estText.innerText = "FUTURE STARS";
                if(traineeLogoUrl) { logo.src = traineeLogoUrl; logo.style.display = "block"; } else if(defaultLogoUrl) { logo.src = defaultLogoUrl; logo.style.display = "block"; }
                activeFilterCategory = 'all'; document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active')); document.querySelectorAll('.filter-btn-overall').forEach(b => b.classList.add('active'));
                renderLeaderboard('trainee'); prepareHistoryData('trainee'); 
            } else if (view === 'events') {
                document.querySelector('.nav-btn-events').classList.add('active');
                
                // --- V18 FIX: PURPLE HEADER & LEAGUE SPARTAN FONT ---
                header.classList.add('event-mode'); 
                title.innerText = "AKANG EVENT"; 
                title.classList.remove('title-gamers');
                
                estText.innerText = "JADWAL DEPLOY";
                if(defaultLogoUrl) { logo.src = defaultLogoUrl; logo.style.display = "block"; }
                renderEvents();
            } else {
                title.innerText = "AKANG COSPLAY"; title.classList.remove('title-gamers'); estText.innerText = "EST. 2024"; if(defaultLogoUrl) { logo.src = defaultLogoUrl; logo.style.display = "block"; }
                if(view === 'about') document.querySelector('.nav-btn:nth-child(1)').classList.add('active');
                if(view === 'official') { document.querySelector('.nav-btn:nth-child(2)').classList.add('active'); activeFilterCategory = 'all'; document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active')); document.querySelectorAll('.filter-btn-overall').forEach(b => b.classList.add('active')); renderLeaderboard('official'); prepareHistoryData('official'); }
            }
        }

        function renderAboutTeam() {
            const setMemberData = (idPrefix, nameKey) => {
                const m = members.find(m => m.name.toLowerCase().includes(nameKey));
                if(m) {
                    if(m.photo) document.getElementById(`img-team-${idPrefix}`).src = m.photo;
                    if(m.role) document.getElementById(`role-team-${idPrefix}`).innerText = m.role;
                    const achDiv = document.getElementById(`ach-team-${idPrefix}`);
                    if(achDiv) {
                        if(m.topAchievement) {
                            achDiv.innerHTML = `<i class="fas fa-trophy"></i> ${escapeHtml(m.topAchievement)}`;
                            achDiv.style.display = 'block';
                        } else {
                            achDiv.style.display = 'none';
                        }
                    }
                }
            };
            setMemberData('rein', 'rein');
            setMemberData('nabilla', 'nabilla');
            setMemberData('ian', 'ian');
        }

        function findAndOpenProfile(keyword) { const member = members.find(m => m.name.toLowerCase().includes(keyword.toLowerCase())); if(member) openProfile(member.id); else alert("Profil tidak ditemukan."); }
        async function downloadBackupData() { const backup = { members: members, games: games, version: "1.0", date: new Date().toISOString() }; const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(backup)); const node = document.createElement('a'); node.href = dataStr; node.download = "backup_" + Date.now() + ".json"; document.body.appendChild(node); node.click(); node.remove(); }
        function restoreToFirebase() { const file = document.getElementById('restoreFile').files[0]; if(!file) return; const reader = new FileReader(); reader.onload = async (e) => { try { const data = JSON.parse(e.target.result); if(!confirm(`Restore ${data.members.length} member?`)) return; for (const m of data.members) { await db.collection("members").doc(m.id).set(m); } location.reload(); } catch(err) { alert("Gagal: " + err.message); } }; reader.readAsText(file); }
        
        async function compressAndSaveLogo(inputId, collectionId) {
            const file = document.getElementById(inputId).files[0];
            if (!file) { alert("Pilih gambar dulu!"); return; }
            
            try {
                const dataUrl = await compressImage(file, 500, 0.9); 
                await db.collection("settings").doc(collectionId).set({ logo: dataUrl });
                alert("SUKSES! Logo berhasil diganti.");
                location.reload();
            } catch (error) {
                 alert("Gagal menyimpan: " + error.message);
            }
        }

        function saveLogo() { compressAndSaveLogo('settingLogo', 'global'); }
        function saveGamersLogo() { compressAndSaveLogo('settingGamersLogo', 'gamers'); }
        function saveTraineeLogo() { compressAndSaveLogo('settingTraineeLogo', 'trainee'); }

        function renderGamers() { let rein = members.find(m => m.name.toLowerCase().includes("rein")); let nabilla = members.find(m => m.name.toLowerCase().includes("nabilla")); if(rein && rein.photo) document.getElementById('img-gamer-rein').src = rein.photo; if(nabilla && nabilla.photo) document.getElementById('img-gamer-nabilla').src = nabilla.photo; renderGames(); }
        function renderGames() { const container = document.getElementById('game-catalog-list'); container.innerHTML = ""; games.forEach(g => { let delBtn = isAdmin ? `<button class="btn-delete-game show-admin" onclick="deleteGame('${g.id}')"><i class="fas fa-trash"></i></button>` : ``; container.innerHTML += `<div class="game-card">${delBtn}<img src="${g.image}" class="game-img" alt="${escapeHtml(g.name)}"><div class="game-title">${escapeHtml(g.name)}</div></div>`; }); if(isAdmin) document.querySelectorAll('.show-admin').forEach(b => b.style.display = 'block'); }
        
        async function submitAddGame() { 
            const name = document.getElementById('addGameName').value; 
            const file = document.getElementById('addGameImage').files[0]; 
            if(!name) return; 
            
            setLoading('btnSaveGame', true, 'Menyimpan...');
            await new Promise(r => setTimeout(r, 100)); 

            try {
                let imgData = "";
                if(file) {
                    imgData = await compressImage(file, 800, 0.8); 
                }
                
                const ng = { id: Date.now().toString(), name: name, image: imgData }; 
                await db.collection("games").doc(ng.id).set(ng);
                
                closeModal('modalAddGame'); 
                setLoading('btnSaveGame', false, 'Simpan Game');
            } catch (error) {
                alert("Gagal: " + error.message);
                setLoading('btnSaveGame', false, 'Simpan Game');
            }
        }
        function deleteGame(id) { if(confirm("Hapus game?")) db.collection("games").doc(id.toString()).delete(); }
        
        function renderEvents() {
            const list = document.getElementById('events-list');
            list.innerHTML = "";
            if(events.length === 0) { list.innerHTML = "<p style='text-align:center; color:#777;'>Belum ada event terjadwal.</p>"; return; }
            
            const now = new Date();
            const upcoming = events.filter(e => new Date(e.date) >= now);
            const past = events.filter(e => new Date(e.date) < now);
            const sortedEvents = [...upcoming, ...past];

            sortedEvents.forEach(e => {
                const dateObj = new Date(e.date);
                const dateStr = dateObj.toLocaleDateString('id-ID', { weekday: 'long', day: 'numeric', month: 'long', year: 'numeric' });
                const timeStr = dateObj.toLocaleTimeString('id-ID', { hour: '2-digit', minute: '2-digit' });
                
                let prizesHTML = "";
                if(e.prizes && e.prizes.length > 0) {
                    e.prizes.forEach(p => {
                          prizesHTML += `<div class="prize-item"><span>${escapeHtml(p.name)}</span><span class="prize-amount">${escapeHtml(p.amount)}</span></div>`;
                    });
                }
                
                const delBtn = isAdmin ? `<button onclick="deleteEvent('${e.id}')" style="position:absolute; top:10px; right:10px; background:red; color:white; border:none; border-radius:5px; padding:5px 10px; cursor:pointer;"><i class="fas fa-trash"></i></button>` : '';

                list.innerHTML += `
                    <div class="event-card">
                        <div style="position:relative;">
                            <img src="${e.poster || 'https://via.placeholder.com/800x450?text=No+Poster'}" class="event-poster" onclick="openLightbox('${e.poster}')">
                            ${delBtn}
                        </div>
                        <div class="event-body">
                            <span class="event-date-badge"><i class="far fa-clock"></i> ${dateStr} - ${timeStr}</span>
                            <span class="event-type">${escapeHtml(e.type)}</span>
                            <h3 class="event-title">${escapeHtml(e.name)}</h3>
                            
                            <div class="event-detail-row"><i class="fas fa-map-marker-alt"></i> ${escapeHtml(e.location)}</div>
                            <div class="event-detail-row"><i class="fas fa-gavel"></i> Juri: ${escapeHtml(e.judges)}</div>
                            
                            ${prizesHTML ? `<div class="event-prizes"><h4 style="margin:0 0 5px 0; font-size:0.9rem; color:#aaa;">üèÜ Kategori & Hadiah</h4>${prizesHTML}</div>` : ''}
                            
                            ${e.rundown ? `<div style="margin-top:15px; padding-top:10px; border-top:1px dashed #555; font-size:0.85rem; color:#ddd; white-space: pre-wrap;"><strong>Rundown:</strong><br>${escapeHtml(e.rundown)}</div>` : ''}
                        </div>
                    </div>
                `;
            });
        }

        function addEventCategoryInput() {
            const container = document.getElementById('evtPrizesContainer');
            const id = Date.now();
            const html = `<div id="prize-${id}" style="display:flex; gap:5px; margin-bottom:5px;"><input type="text" placeholder="Kategori" class="prize-name-input"><input type="text" placeholder="Hadiah" class="prize-amount-input"><button onclick="document.getElementById('prize-${id}').remove()" style="background:red; color:white; border:none; border-radius:5px; width:30px;"><i class="fas fa-times"></i></button></div>`;
            container.insertAdjacentHTML('beforeend', html);
        }

        async function submitEvent() {
            const btn = document.getElementById('btnSaveEvent');
            setLoading('btnSaveEvent', true, 'Memproses...');
            
            await new Promise(r => setTimeout(r, 300)); 

            try {
                const name = document.getElementById('evtName').value;
                const type = document.getElementById('evtType').value;
                const date = document.getElementById('evtDate').value;
                const loc = document.getElementById('evtLoc').value;
                const judges = document.getElementById('evtJudges').value;
                const rundown = document.getElementById('evtRundown').value;
                const file = document.getElementById('evtPoster').files[0];

                if(!name || !date || !loc) { throw new Error("Nama, Tanggal, dan Lokasi wajib diisi!"); }

                // Collect Prizes
                const prizeDivs = document.querySelectorAll('#evtPrizesContainer > div');
                const prizes = [];
                prizeDivs.forEach(div => {
                    const n = div.querySelector('.prize-name-input').value;
                    const a = div.querySelector('.prize-amount-input').value;
                    if(n && a) prizes.push({name: n, amount: a});
                });

                let posterUrl = null;
                if(file) {
                    posterUrl = await compressImage(file, 1000, 0.8);
                }

                const newEvt = {
                    id: Date.now().toString(),
                    name, type, date, location: loc, judges, rundown, prizes,
                    poster: posterUrl
                };
                
                await db.collection("events").doc(newEvt.id).set(newEvt);
                
                closeModal('modalAddEvent');
                document.getElementById('evtName').value = "";
                document.getElementById('evtPrizesContainer').innerHTML = "";
                setLoading('btnSaveEvent', false, 'Publish Event');
                alert("Event Berhasil Dibuat!");

            } catch (error) {
                alert("Error: " + error.message);
                setLoading('btnSaveEvent', false, 'Publish Event');
            }
        }
        function deleteEvent(id) { if(confirm("Hapus event ini?")) db.collection("events").doc(id).delete(); }
        
        function toggleFabMenu() { document.getElementById('fabMenu').classList.toggle('show'); }
        function openBotModal() { document.getElementById('chatInput').value = ""; document.getElementById('chatArea').innerHTML = `<div class="chat-msg bot"><div class="bubble bot">Halo! Saya Akang Bot ü§ñ.<br>Mau tanya apa?</div></div>`; renderBotOptions(); openModal('modalBot'); }
        function renderBotOptions() { const opts = document.getElementById('chatOptions'); opts.innerHTML = ""; botFaqData.forEach((i, idx) => { opts.innerHTML += `<button class="bot-opt-btn" onclick="askBot(${idx})">${i.q}</button>`; }); }
        function askBot(idx) { const i = botFaqData[idx]; const c = document.getElementById('chatArea'); c.innerHTML += `<div class="chat-msg user"><div class="bubble user">${i.q}</div></div>`; setTimeout(() => { c.innerHTML += `<div class="chat-msg bot"><div class="bubble bot">${i.a}</div></div>`; c.scrollTop = c.scrollHeight; }, 600); }
        function handleChatEnter(e) { if (e.key === 'Enter') sendCustomMessage(); }
        function sendCustomMessage() { 
            const txt = document.getElementById('chatInput').value.trim(); if(!txt) return; const low = txt.toLowerCase(); const c = document.getElementById('chatArea'); c.innerHTML += `<div class="chat-msg user"><div class="bubble user">${escapeHtml(txt)}</div></div>`; document.getElementById('chatInput').value = ""; c.scrollTop = c.scrollHeight;
            setTimeout(() => {
                let r = "Maaf, coba tanya: 'cara join', 'sosmed', atau 'apa itu akang cosplay'.";
                if (low.includes('apa itu akang cosplay') || (low.includes('akang cosplay') && low.includes('adalah'))) r = "<b>Akang Cosplay</b> adalah tim cosplay sejak 14 Juni 2024. ‚ú®<br>Komunitas seru buat kompetisi & hobi jejepangan!";
                else if (low.includes('apa itu akang trainee') || (low.includes('trainee') && low.includes('adalah'))) r = "<b>Akang Trainee</b> adalah tempat latihan buat member baru sebelum jadi Official Member. üéì";
                else if (low.includes('daftar') || low.includes('join') || low.includes('gabung')) r = "Caranya:<br>1. Klik tombol <b>Login</b>.<br>2. Pilih tab <b>Daftar Member</b>.<br>3. Isi data & Daftar.<br>Selesai! üéâ";
                else if (low.includes('ig') || low.includes('sosmed')) r = "Follow IG kami: <a href='https://instagram.com/akangcosplay' class='bot-link'>@akangcosplay</a>";
                else if (low.includes('youtube') || low.includes('gamers')) r = "Nonton mabar di YT: <a href='https://youtube.com/@akanggamers1372' class='bot-link'>Akang Gamers</a> üéÆ";
                else if (low.includes('halo') || low.includes('hi')) r = "Halo juga! üëã";
                c.innerHTML += `<div class="chat-msg bot"><div class="bubble bot">${r}</div></div>`; c.scrollTop = c.scrollHeight;
            }, 700);
        }
        const botFaqData = [{q:"Apa itu Akang Cosplay?",a:"Tim cosplay & komunitas hobi sejak 2024! ‚ú®"},{q:"Cara Join?",a:"Klik Login -> Tab Daftar Member -> Isi Data. Gratis!"},{q:"Sosmed?",a:"IG: @akangcosplay, TikTok: @akangcosplay, YT: Akang Cosplay"}];

        function setHistoryFilter(cat, btn) { activeFilterCategory = cat; btn.parentElement.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active')); btn.classList.add('active'); prepareHistoryData(activeHistoryType); }
        
        // --- UPDATED: HISTORY RENDER LOGIC (STACKED AVATARS) ---
        function prepareHistoryData(type) { 
            activeHistoryType = type; 
            const listId = type === 'official' ? 'history-official-list' : 'history-trainee-list'; 
            const searchId = type === 'official' ? 'searchOfficial' : 'searchTrainee'; 
            document.getElementById(listId).innerHTML = ""; 
            currentHistoryDisplayCount = 0; 
            currentHistoryData = []; 
            const q = document.getElementById(searchId).value.toLowerCase(); 
            
            const processedWinIds = new Set();

            members.forEach(m => { 
                if ((m.status || 'official') === type && m.history) { 
                    m.history.forEach(h => { 
                        if (h.winId && processedWinIds.has(h.winId)) return;
                        if (h.winId) processedWinIds.add(h.winId);

                        currentHistoryData.push({ 
                            ...h, 
                            memberId: m.id, 
                            memberName: m.name, 
                            memberPhoto: m.photo || 'https://cdn-icons-png.flaticon.com/512/847/847969.png' 
                        }); 
                    }); 
                } 
            }); 
            
            if(q) currentHistoryData = currentHistoryData.filter(i => `${i.memberName} ${i.event} ${i.char}`.toLowerCase().includes(q)); 
            if(activeFilterCategory !== 'all') currentHistoryData = currentHistoryData.filter(h => activeFilterCategory === 'Coswalk' ? h.category === 'Coswalk' : (h.category === 'Cosplay Competition' || h.category === 'Coscom')); 
            
            currentHistoryData.sort((a, b) => new Date(b.date) - new Date(a.date)); 
            loadNextBatch(); 
        }
        
        function loadNextBatch() {
            const listId = activeHistoryType === 'official' ? 'history-official-list' : 'history-trainee-list'; const container = document.getElementById(listId);
            const batch = currentHistoryData.slice(currentHistoryDisplayCount, currentHistoryDisplayCount + HISTORY_BATCH_SIZE);
            if (batch.length === 0 && currentHistoryDisplayCount === 0) { container.innerHTML = "<p style='text-align:center;color:#777'>Data kosong.</p>"; return; }
            
            batch.forEach(i => {
                let border = (i.category === 'Cosplay Competition' || i.category === 'Coscom') ? 'feed-comp' : ''; if (activeHistoryType === 'trainee') border = 'feed-trainee';
                let rankT = i.rank === 'Best' ? escapeHtml(i.bestTitle) : 'Juara ' + escapeHtml(i.rank);
                let img = i.proof ? `<img src="${i.proof}" class="feed-img-proof" onclick="openLightbox('${i.proof}')">` : '';
                let judgesInfo = i.judges ? `<div style="font-size:0.85rem; color:var(--gold); margin-top:3px;"><i class="fas fa-gavel"></i> Juri: ${escapeHtml(i.judges)}</div>` : '';

                // NEW: STACKED AVATARS LOGIC
                let headerHtml = '';
                
                if (!i.participants || i.participants.length <= 1) {
                    // SINGLE
                    headerHtml = `
                        <div class="feed-header">
                            <img src="${i.memberPhoto}" class="feed-avatar">
                            <div>
                                <div class="feed-title" style="font-weight:bold;">${escapeHtml(i.memberName)}</div>
                                <div class="feed-meta" style="font-size:0.8rem; color:#777;">${new Date(i.date).toLocaleDateString()}</div>
                            </div>
                        </div>`;
                } else {
                    // SQUAD/DUO
                    let avatarStackHtml = `<div class="avatar-group">`;
                    let namesHtml = [];
                    
                    // Main Member
                    avatarStackHtml += `<img src="${i.memberPhoto}" title="${i.memberName}">`;
                    namesHtml.push(`<span style="font-weight:bold;">${escapeHtml(i.memberName)}</span>`);
                    
                    // Others
                    i.participants.forEach(p => {
                        if(p.id === i.memberId) return;
                        if (p.type === 'member') {
                            let memData = members.find(m => m.id === p.id);
                            let pPhoto = memData && memData.photo ? memData.photo : 'https://cdn-icons-png.flaticon.com/512/847/847969.png';
                            avatarStackHtml += `<img src="${pPhoto}" title="${p.name}">`;
                            namesHtml.push(`<a href="#" onclick="openProfile('${p.id}')" class="team-member-link">${escapeHtml(p.name)}</a>`);
                        } else {
                            namesHtml.push(`<span class="team-non-member">${escapeHtml(p.name)} (Guest)</span>`);
                        }
                    });
                    avatarStackHtml += `</div>`;
                    
                    headerHtml = `
                        <div class="feed-header">
                            ${avatarStackHtml}
                            <div style="flex:1; min-width:0;">
                                <div style="font-size:0.95rem; line-height:1.3;">${namesHtml.join(', ')}</div>
                                <div class="feed-meta" style="font-size:0.8rem; color:#777; margin-top:2px;">${new Date(i.date).toLocaleDateString()}</div>
                            </div>
                        </div>`;
                }
                
                let charText = i.participants && i.participants.length > 1 ? i.participants.map(p=>p.char).join(', ') : i.char;

                container.insertAdjacentHTML('beforeend', `
                    <div class="feed-card ${border}">
                        <div class="feed-rank">${rankT}</div>
                        ${headerHtml}
                        <div>
                            <strong>${escapeHtml(i.event)}</strong><br>
                            Char: <span style="color:${activeHistoryType==='trainee'?'var(--sky-blue)':'var(--primary)'}">${escapeHtml(charText)}</span>
                            ${judgesInfo}
                        </div>
                        ${img}
                    </div>`);
            });
            currentHistoryDisplayCount += batch.length;
        }

        const scrollObs = new IntersectionObserver((entries) => { if(entries[0].isIntersecting) loadNextBatch(); }, { threshold: 0.1 });
        scrollObs.observe(document.getElementById('scroll-trigger-official')); scrollObs.observe(document.getElementById('scroll-trigger-trainee'));

        function renderLeaderboard(type) { 
            const list = document.getElementById(type === 'official' ? 'leaderboard-official' : 'leaderboard-trainee'); 
            list.innerHTML = ""; 
            
            let fMembers = members.filter(m => (m.status || 'official') === type);
            if(fMembers.length === 0) { document.getElementById(type === 'official' ? 'empty-lb-official' : 'empty-lb-trainee').style.display = 'block'; return; } 
            document.getElementById(type === 'official' ? 'empty-lb-official' : 'empty-lb-trainee').style.display = 'none';
            fMembers.forEach(m => m.totalWins = m.history ? m.history.length : 0); fMembers.sort((a, b) => b.totalWins - a.totalWins);
            fMembers.forEach((m, i) => { 
                let color = i===0?'gold':(i===1?'silver':'#cd7f32'); if (type==='trainee') color='var(--sky-blue)';
                list.innerHTML += `<div class="leaderboard-card ${type==='trainee'?'trainee-style':''}" onclick="openProfile('${m.id}')"><div class="rank-badge" style="color:${color}">#${i+1}</div><img src="${m.photo||'https://cdn-icons-png.flaticon.com/512/847/847969.png'}" class="avatar-small"><div class="lb-info"><h3>${escapeHtml(m.name)}</h3><span>${m.repertoire?m.repertoire.length:0} Kostum</span></div><div class="lb-stats"><div>${m.totalWins}</div></div></div>`; 
            }); 
        }

        // --- PROFILE LOGIC ---
        function openProfile(id) {
            const m = members.find(x => x.id == id); if(!m) return;
            const menuBtn = document.getElementById('profileActionMenu');
            const delMemBtn = document.getElementById('btnDelMemberMenu');
            const statusBadge = document.getElementById('p-status-badge');
            
            isManagePostMode = true; toggleManagePostsMode(); 

            let isOwner = (currentUser && currentUser.uid === m.id);
            if (isOwner || isAdmin) { menuBtn.style.display = "block"; } else { menuBtn.style.display = "none"; }
            if (isAdmin) delMemBtn.style.display = "block"; else delMemBtn.style.display = "none";

            const st = m.status || 'official';
            statusBadge.innerText = st === 'official' ? "OFFICIAL MEMBER" : "AKANG TRAINEE";
            statusBadge.style.color = st === 'official' ? "var(--primary)" : "var(--sky-blue)";
            statusBadge.style.borderColor = st === 'official' ? "var(--primary)" : "var(--sky-blue)";

            document.getElementById('editId').value = m.id; document.getElementById('editName').value = m.name; document.getElementById('editBio').value = m.bio || ""; document.getElementById('editIg').value = m.ig || ""; document.getElementById('editRole').value = m.role || ""; document.getElementById('editStatus').value = st;
            
            document.getElementById('editWa').value = m.wa || "";
            document.getElementById('editWaPrivacy').value = m.waPrivacy || "hidden";

            if(isAdmin && document.getElementById('editTopAchievement')) {
                document.getElementById('editTopAchievement').value = m.topAchievement || "";
            }

            document.getElementById('p-name').innerText = m.name; document.getElementById('p-bio').innerText = m.bio || "-"; document.getElementById('p-photo').src = m.photo || 'https://cdn-icons-png.flaticon.com/512/847/847969.png';
            document.getElementById('p-stat-coswalk').innerText = m.history ? m.history.filter(h => h.category === 'Coswalk').length : 0; 
            document.getElementById('p-stat-comp').innerText = m.history ? m.history.filter(h => h.category === 'Cosplay Competition' || h.category === 'Coscom').length : 0;
            const igBadge = document.getElementById('p-ig'); if(m.ig) { igBadge.href = m.ig.startsWith('http') ? m.ig : 'https://instagram.com/' + m.ig.replace('@',''); igBadge.style.display = 'inline-flex'; } else igBadge.style.display = 'none';

            const waBtn = document.getElementById('p-wa');
            let showWa = false;
            if (m.waPrivacy === 'public') showWa = true;
            if (isAdmin || isOwner) showWa = true; 

            if (m.wa && showWa) {
                let num = m.wa.toString();
                if(num.startsWith('0')) num = '62' + num.substring(1);
                waBtn.href = `https://wa.me/${num}`;
                waBtn.style.display = 'inline-flex';
                
                if(m.waPrivacy === 'hidden' && (isAdmin || isOwner)) {
                    waBtn.innerHTML = '<i class="fas fa-lock"></i> WhatsApp (Hidden)';
                    waBtn.style.background = '#555';
                } else {
                    waBtn.innerHTML = '<i class="fab fa-whatsapp"></i> WhatsApp';
                    waBtn.style.background = '#25D366';
                }
            } else {
                waBtn.style.display = 'none';
            }

            const galGrid = document.getElementById('p-gallery-grid'); galGrid.innerHTML = "";
            if(m.gallery) m.gallery.forEach((src, i) => { 
                galGrid.innerHTML += `<div class="gallery-item"><button class="btn-del-photo" onclick="deleteGalleryPhoto('${m.id}', ${i})"><i class="fas fa-trash"></i></button><img src="${src}" class="gallery-img" onclick="openLightbox('${src}')"></div>`; 
            });

            const repDiv = document.getElementById('p-repertoire'); repDiv.innerHTML = ""; if(m.repertoire) m.repertoire.forEach(r => repDiv.innerHTML += `<span class="tag">${escapeHtml(r)}</span>`);
            
            const histDiv = document.getElementById('p-history-list'); histDiv.innerHTML = "";
            if(m.history) {
                [...m.history].sort((a,b)=>new Date(b.date)-new Date(a.date)).forEach(h => {
                    let rankT = h.rank === 'Best' ? escapeHtml(h.bestTitle) : 'Juara ' + h.rank;
                    let judgesInfo = h.judges ? `<br><small style="color:var(--gold);"><i class="fas fa-gavel"></i> ${escapeHtml(h.judges)}</small>` : '';

                    histDiv.innerHTML += `
                    <div style="background:#3d4655; padding:10px; margin-bottom:10px; border-radius:5px; border-left:3px solid ${h.category==='Coswalk'?'var(--accent-blue)':'var(--gold)'}; display:flex; justify-content:space-between; align-items:center;">
                        <div>
                            <span style="font-weight:bold">${escapeHtml(h.event)}</span><br>
                            <small>${escapeHtml(h.char)} | ${rankT}</small>
                            ${judgesInfo}
                        </div>
                        <div style="display:flex; align-items:center;">
                            <button class="btn-edit-history" onclick="openEditHistory('${m.id}', '${h.id}')"><i class="fas fa-pen"></i></button>
                            <button class="btn-del-history" onclick="deleteHistory('${m.id}', '${h.id}')"><i class="fas fa-trash"></i></button>
                        </div>
                    </div>`;
                });
            }

            const btnAddPhoto = document.querySelector('.btn-add-photo'); btnAddPhoto.style.display = isOwner ? "flex" : "none";
            switchView('profile');
        }

        function openLightbox(src) { document.getElementById('lightboxImg').src = src; document.getElementById('lightbox').style.display = 'flex'; }
        function closeLightbox() { document.getElementById('lightbox').style.display = 'none'; }
        document.getElementById('lightbox').addEventListener('click', function(e) { if(e.target === this) closeLightbox(); });

        function toggleTeammateInput() {
            const format = document.getElementById('winFormat').value;
            const section = document.getElementById('teammatesSection');
            const container = document.getElementById('teammatesContainer');
            
            if (format === 'Single') {
                section.classList.add('hidden');
                container.innerHTML = ''; 
            } else {
                section.classList.remove('hidden');
                if (container.innerHTML === '') addTeammateInput();
            }
        }

        function addTeammateInput() {
            const container = document.getElementById('teammatesContainer');
            const id = Date.now();
            let options = `<option value="">-- Pilih Member --</option>`;
            members.forEach(m => { options += `<option value="${m.id}">${escapeHtml(m.name)}</option>`; });

            const html = `
                <div id="tm-row-${id}" class="teammate-row">
                    <select class="tm-type-select" onchange="toggleTmInputType(this)" style="flex:0.4;">
                        <option value="member">Member</option>
                        <option value="guest">Non-Member</option>
                    </select>
                    <div class="tm-input-wrapper" style="flex:1;">
                        <select class="tm-member-select">${options}</select>
                        <input type="text" class="tm-guest-input hidden" placeholder="Nama Partner...">
                    </div>
                    <input type="text" class="tm-char-input" placeholder="Karakter Partner..." style="flex:0.8; margin:0;">
                    <button onclick="document.getElementById('tm-row-${id}').remove()" style="background:red; color:white; border:none; border-radius:5px; width:30px;"><i class="fas fa-times"></i></button>
                </div>`;
            container.insertAdjacentHTML('beforeend', html);
        }

        function toggleTmInputType(select) {
            const row = select.parentElement;
            const memberSelect = row.querySelector('.tm-member-select');
            const guestInput = row.querySelector('.tm-guest-input');
            if (select.value === 'member') { memberSelect.classList.remove('hidden'); guestInput.classList.add('hidden'); } 
            else { memberSelect.classList.add('hidden'); guestInput.classList.remove('hidden'); }
        }

        function openModalWin() { 
            document.getElementById('winEditId').value = ""; document.getElementById('winEvent').value = ""; document.getElementById('winDate').value = ""; document.getElementById('winJudges').value = ""; document.getElementById('winBestTitle').value = ""; document.getElementById('winMember').disabled = false; document.getElementById('btnSaveWin').innerText = "Simpan Data";

            // Reset Manual Input State
            useManualChar = false;
            document.getElementById('winCharSelect').classList.remove('hidden');
            document.getElementById('winCharManual').classList.add('hidden');
            document.getElementById('winCharManualHint').classList.add('hidden');
            document.getElementById('btnToggleManualChar').classList.remove('active');
            document.getElementById('winCharManual').value = "";

            document.getElementById('winFormat').value = "Single";
            toggleTeammateInput();

            const sel = document.getElementById('winMember'); sel.innerHTML = ""; 
            if(isAdmin) { members.forEach(m => sel.innerHTML += `<option value="${m.id}">${escapeHtml(m.name)}</option>`); } 
            else if (currentUser) { const me = members.find(m => m.id === currentUser.uid); sel.innerHTML = `<option value="${me.id}">${escapeHtml(me.name)}</option>`; } 
            else { alert("Login dulu."); return; }
            
            // Populate Rep for current selected
            populateCharDropdown(sel.value);
            // Change listener
            sel.onchange = function() { populateCharDropdown(this.value); }

            document.getElementById('divBestTitle').classList.add('hidden'); openModal('modalWin'); 
        }
        
        function openEditHistory(mid, hid) {
             const m = members.find(x => x.id == mid); const h = m.history.find(x => x.id == hid); if (!h) return;
             const sel = document.getElementById('winMember'); sel.innerHTML = ""; members.forEach(mem => sel.innerHTML += `<option value="${mem.id}">${escapeHtml(mem.name)}</option>`);
             document.getElementById('winEditId').value = hid; document.getElementById('winMember').value = mid; document.getElementById('winMember').disabled = true;
             document.getElementById('winEvent').value = h.event; document.getElementById('winCat').value = h.category; 
             
             // Populate & Set Char
             populateCharDropdown(mid);
             if(m.repertoire && m.repertoire.includes(h.char)) {
                 document.getElementById('winCharSelect').value = h.char;
                 useManualChar = false;
                 document.getElementById('winCharSelect').classList.remove('hidden');
                 document.getElementById('winCharManual').classList.add('hidden');
             } else {
                 useManualChar = true;
                 document.getElementById('winCharManual').value = h.char;
                 document.getElementById('winCharSelect').classList.add('hidden');
                 document.getElementById('winCharManual').classList.remove('hidden');
             }

             document.getElementById('winDate').value = h.date.split('T')[0]; document.getElementById('winRank').value = h.rank; document.getElementById('winJudges').value = h.judges || "";
             
             document.getElementById('teammatesSection').classList.add('hidden');
             document.getElementById('winFormat').value = 'Single';
             document.getElementById('winFormat').disabled = true; 

             if (h.rank === 'Best') { document.getElementById('divBestTitle').classList.remove('hidden'); document.getElementById('winBestTitle').value = h.bestTitle; } else { document.getElementById('divBestTitle').classList.add('hidden'); }
             document.getElementById('btnSaveWin').innerText = "Update Data"; openModal('modalWin');
        }

        function openEditModal() { const id = document.getElementById('editId').value; const m = members.find(x => x.id == id); currentTempRepertoire = m.repertoire ? [...m.repertoire] : []; renderEditRepertoire(); openModal('modalEdit'); }
        
        async function saveEditProfile() { 
            const id = document.getElementById('editId').value; const m = members.find(x => x.id == id); const file = document.getElementById('editPhoto').files[0];
            
            setLoading('btnSaveProfile', true, 'Menyimpan...');
            await new Promise(r => setTimeout(r, 100)); // UI Jeda

            try {
                let photoUrl = null;
                if(file) {
                    photoUrl = await compressImage(file, 800, 0.8); // Profil WebP
                }

                m.name = document.getElementById('editName').value; 
                m.bio = document.getElementById('editBio').value; 
                m.ig = document.getElementById('editIg').value; 
                m.role = document.getElementById('editRole').value; 
                m.wa = document.getElementById('editWa').value;
                m.waPrivacy = document.getElementById('editWaPrivacy').value;
                
                if(isAdmin) m.status = document.getElementById('editStatus').value;
                if(isAdmin) m.topAchievement = document.getElementById('editTopAchievement').value;
                if(photoUrl) m.photo = photoUrl; 
                
                m.repertoire = [...currentTempRepertoire]; 
                
                await db.collection("members").doc(id).set(m);
                
                closeModal('modalEdit'); 
                openProfile(id); 
                setLoading('btnSaveProfile', false, 'Update Profil');

            } catch (error) {
                alert("Gagal: " + error.message);
                setLoading('btnSaveProfile', false, 'Update Profil');
            }
        }

        async function submitWin() {
            const btn = document.getElementById('btnSaveWin');
            setLoading('btnSaveWin', true, 'Memproses...');
            
            await new Promise(r => setTimeout(r, 100)); // UI Jeda

            try {
                const mainId = document.getElementById('winMember').value;
                const editId = document.getElementById('winEditId').value;

                if (!mainId) throw new Error("Pilih member utama!");
                if (!isAdmin && (!currentUser || currentUser.uid !== mainId)) { throw new Error("Hanya bisa input punya sendiri!"); }
                
                const event = document.getElementById('winEvent').value;
                const cat = document.getElementById('winCat').value;
                
                // NEW: CHAR LOGIC
                let char = "";
                if(useManualChar) {
                    char = document.getElementById('winCharManual').value;
                } else {
                    char = document.getElementById('winCharSelect').value;
                }

                const rank = document.getElementById('winRank').value;
                const proof = document.getElementById('winProof').files[0];
                const format = document.getElementById('winFormat').value;
                const judges = document.getElementById('winJudges').value;
                const bestTitle = rank === 'Best' ? document.getElementById('winBestTitle').value : null;
                const dateVal = document.getElementById('winDate').value || new Date().toISOString();
                
                if(!event || !char) { throw new Error("Nama Event dan Karakter wajib diisi!"); }

                let participants = [];
                const mainMember = members.find(m => m.id === mainId);
                if (!mainMember) throw new Error("Data member Anda belum terload sempurna. Coba refresh halaman.");
                
                participants.push({ type: 'member', id: mainId, name: mainMember.name, char: char });

                if (format !== 'Single') {
                    const rows = document.querySelectorAll('.teammate-row');
                    rows.forEach(row => {
                        const type = row.querySelector('.tm-type-select').value;
                        const charInput = row.querySelector('.tm-char-input').value; 
                        
                        if (type === 'member') {
                            const mid = row.querySelector('.tm-member-select').value;
                            if (mid) {
                                const mm = members.find(m => m.id === mid);
                                if (!mm) throw new Error("Data partner belum termuat. Cek koneksi.");
                                if (!participants.find(p => p.id === mid)) {
                                    participants.push({ type: 'member', id: mid, name: mm.name, char: charInput });
                                }
                            }
                        } else {
                            const name = row.querySelector('.tm-guest-input').value;
                            if (name) { participants.push({ type: 'guest', name: name, char: charInput }); }
                        }
                    });
                }

                let proofUrl = null;
                if(proof) {
                    proofUrl = await compressImage(proof, 800, 0.7);
                }

                const uniqueWinId = editId || (Date.now() + Math.random().toString());
                const winDataTemplate = { id: uniqueWinId, winId: uniqueWinId, event, category: cat, rank, judges, bestTitle, date: dateVal, participants: participants, proof: proofUrl };
                const memberIdsToWrite = participants.filter(pt => pt.type === 'member').map(pt => pt.id);

                const snapshotPromises = memberIdsToWrite.map(id => db.collection("members").doc(id).get());
                const snapshots = await Promise.all(snapshotPromises);
                const batch = db.batch();

                snapshots.forEach((doc) => {
                    if (!doc.exists) return; 
                    const mData = doc.data(); const mRef = db.collection("members").doc(doc.id);
                    let history = mData.history || []; let repertoire = mData.repertoire || [];
                    
                    const myPartData = participants.find(p => p.id === doc.id);
                    const myChar = myPartData ? (myPartData.char || char) : char;
                    
                    const myWinData = { ...winDataTemplate, char: myChar };

                    if (editId) {
                        const idx = history.findIndex(h => h.id == editId || h.winId == editId);
                        if (idx > -1) { 
                            myWinData.proof = proofUrl || history[idx].proof; 
                            history[idx] = myWinData; 
                        }
                    } else { history.unshift(myWinData); }

                    // UPDATED LOGIC: ONLY ADD TO REPERTOIRE IF NOT MANUAL INPUT
                    if (myChar && !repertoire.includes(myChar) && !useManualChar) { repertoire.push(myChar); }
                    batch.update(mRef, { history: history, repertoire: repertoire });
                });
                
                await batch.commit();
                alert("Berhasil! Data tersimpan.");
                closeModal('modalWin');
                setLoading('btnSaveWin', false, 'Simpan Data');

            } catch (error) {
                alert("Gagal Menyimpan: " + error.message);
                setLoading('btnSaveWin', false, 'Simpan Data');
            }
        }

        async function uploadGalleryPhoto(inp) { 
            const f = inp.files[0]; if(!f) return; 
            try {
                const u = await compressImage(f, 800, 0.8);
                const id = document.getElementById('editId').value; 
                const m = members.find(x=>x.id==id); 
                if(!m.gallery) m.gallery=[]; 
                m.gallery.push(u); 
                await db.collection("members").doc(id).set(m);
                openProfile(id);
                inp.value="";
            } catch (e) { alert("Gagal upload: " + e); }
        }
        
        function deleteGalleryPhoto(mid, idx) { if(confirm("Hapus foto?")) { const m = members.find(x=>x.id==mid); m.gallery.splice(idx, 1); db.collection("members").doc(mid).set(m).then(()=>openProfile(mid)); } }
        function deleteHistory(mid, hid) { if(confirm("Hapus history?")) { const m = members.find(x=>x.id==mid); m.history = m.history.filter(h=>h.id!==hid); db.collection("members").doc(mid).set(m).then(()=>openProfile(mid)); } }
        function deleteCurrentMember() { const id = document.getElementById('editId').value; if(confirm("YAKIN HAPUS MEMBER INI? PERMANEN!")) db.collection("members").doc(id).delete().then(() => { if(currentUser.uid===id) auth.signOut(); switchView('official'); }); }
        
        function addRepertoireTag() { const v = document.getElementById('repInput').value; if(v && !currentTempRepertoire.includes(v)) { currentTempRepertoire.push(v); renderEditRepertoire(); document.getElementById('repInput').value=""; } }
        function renderEditRepertoire() { document.getElementById('editRepList').innerHTML = currentTempRepertoire.map((t,i) => `<span class="tag">${t} <i class="fas fa-times" onclick="currentTempRepertoire.splice(${i},1);renderEditRepertoire()"></i></span>`).join(''); }
        
        function toggleBestInput() { if(document.getElementById('winRank').value === 'Best') document.getElementById('divBestTitle').classList.remove('hidden'); else document.getElementById('divBestTitle').classList.add('hidden'); }
        function openModal(id) { document.getElementById(id).style.display = 'flex'; if(id==='modalSettings') renderMigrationList(); }
        function closeModal(id) { document.getElementById(id).style.display = 'none'; }
        document.addEventListener('contextmenu', e => e.preventDefault());
        function renderAll() { 
            renderAboutTeam(); 
            if(document.getElementById('view-official').classList.contains('active')) { renderLeaderboard('official'); prepareHistoryData('official'); }
            if(document.getElementById('view-trainee').classList.contains('active')) { renderLeaderboard('trainee'); prepareHistoryData('trainee'); }
            if(document.getElementById('view-profile').classList.contains('active')) openProfile(document.getElementById('editId').value); 
            if(document.getElementById('view-gamers').classList.contains('active')) renderGamers();
            if(document.getElementById('view-events').classList.contains('active')) renderEvents();
        }
        window.onclick = (e) => { if(e.target.classList.contains('modal')) e.target.style.display = 'none'; }

        async function trackVisitor() {
            if (sessionStorage.getItem('visited_this_session')) { loadVisitorStats(); return; }
            sessionStorage.setItem('visited_this_session', 'true');
            try {
                const response = await fetch('https://ipapi.co/json/'); const data = await response.json();
                const country = data.country_name || 'Unknown'; const region = data.region || 'Unknown Region'; const flag = getFlagEmoji(data.country_code) || 'üè≥Ô∏è';
                const statsRef = db.collection('analytics').doc('visitors'); const geoRef = db.collection('analytics').doc('geo_data');
                db.runTransaction(async (transaction) => {
                    const statsDoc = await transaction.get(statsRef); const geoDoc = await transaction.get(geoRef);
                    let newTotal = 1; if (statsDoc.exists) { newTotal = (statsDoc.data().total || 0) + 1; }
                    transaction.set(statsRef, { total: newTotal }, { merge: true });
                    let geoData = geoDoc.exists ? geoDoc.data() : {};
                    if (!geoData[country]) { geoData[country] = { total: 0, flag: flag, regions: {} }; }
                    geoData[country].total += 1; geoData[country].flag = flag; 
                    if (!geoData[country].regions[region]) { geoData[country].regions[region] = 0; } geoData[country].regions[region] += 1;
                    transaction.set(geoRef, geoData);
                }).then(() => { loadVisitorStats(); });
            } catch (error) { loadVisitorStats(); }
        }

        function loadVisitorStats() {
            db.collection('analytics').doc('visitors').onSnapshot(doc => { if (doc.exists) { animateValue("totalVisitorCount", 0, doc.data().total || 0, 2000); } });
            db.collection('analytics').doc('geo_data').onSnapshot(doc => { 
                const list = document.getElementById('geoList');
                if (doc.exists) { renderGeoStats(doc.data()); } else { list.innerHTML = "<small>Belum ada data.</small>"; }
            });
        }

        function renderGeoStats(data) {
            const list = document.getElementById('geoList'); list.innerHTML = "";
            const countries = Object.keys(data).map(key => ({ name: key, ...data[key] })).sort((a, b) => b.total - a.total);
            const totalVisits = countries.reduce((sum, c) => sum + c.total, 0);
            countries.forEach(c => {
                const percent = totalVisits > 0 ? (c.total / totalVisits) * 100 : 0;
                const regions = Object.keys(c.regions).map(rKey => ({ name: rKey, count: c.regions[rKey] })).sort((a, b) => b.count - a.count);
                let regionsHTML = ""; regions.forEach(r => { regionsHTML += `<div class="province-item"><span>üìç ${escapeHtml(r.name)}</span><span class="province-count">${r.count}</span></div>`; });
                list.insertAdjacentHTML('beforeend', `<div class="geo-card"><div class="geo-header" onclick="toggleGeoDetail(this)"><div class="geo-info"><span class="geo-flag">${c.flag}</span><div><div class="geo-name">${escapeHtml(c.name)}</div><div class="geo-bar-bg"><div class="geo-bar-fill" style="width:${percent}%"></div></div></div></div><div class="geo-count">${c.total}</div></div><div class="geo-details">${regionsHTML}</div></div>`);
            });
        }

        function animateValue(id, start, end, duration) { const obj = document.getElementById(id); if(!obj) return; let startTimestamp = null; const step = (timestamp) => { if (!startTimestamp) startTimestamp = timestamp; const progress = Math.min((timestamp - startTimestamp) / duration, 1); obj.innerHTML = Math.floor(progress * (end - start) + start).toLocaleString(); if (progress < 1) { window.requestAnimationFrame(step); } }; window.requestAnimationFrame(step); }
        function toggleGeoDetail(headerElement) { const detail = headerElement.nextElementSibling; detail.classList.toggle('open'); }
        function getFlagEmoji(countryCode) { if(!countryCode) return 'üè≥Ô∏è'; const codePoints = countryCode.toUpperCase().split('').map(char => 127397 + char.charCodeAt()); return String.fromCodePoint(...codePoints); }
        
        trackVisitor();
    </script>

<script>
(function(){
    const translations = {};

    // Collect elements that declare translations
    document.querySelectorAll('[data-id][data-en]').forEach(el => {
        const key = el.dataset.key || Math.random().toString(36).slice(2);
        translations[key] = {
            id: el.dataset.id,
            en: el.dataset.en
        };
        el.dataset.key = key;
    });

    function setLanguage(lang){
        document.querySelectorAll('[data-key]').forEach(el => {
            const key = el.dataset.key;
            if(translations[key] && translations[key][lang]){
                el.textContent = translations[key][lang];
            }
        });
        localStorage.setItem("akang_lang", lang);
    }

    // Try restore previous language
    const savedLang = localStorage.getItem("akang_lang") || "id";
    window.setAkangLanguage = setLanguage;

    window.addEventListener("DOMContentLoaded", () => {
        setLanguage(savedLang);

        // attach to common language buttons if exist
        const idBtn = document.querySelector('[data-lang="id"], #lang-id');
        const enBtn = document.querySelector('[data-lang="en"], #lang-en');

        if(idBtn) idBtn.addEventListener("click", () => setLanguage("id"));
        if(enBtn) enBtn.addEventListener("click", () => setLanguage("en"));
    });
})();
</script>


<script>
function applyMode(mode){

    const header = document.getElementById("mainHeader");
    const body = document.body;

    // reset modes
    header.classList.remove("gamers-mode","trainee-mode");
    body.classList.remove("mode-official","mode-trainee","mode-gamers");

    if(mode === "gamers"){
        header.classList.add("gamers-mode");
        body.classList.add("mode-gamers");
    }
    else if(mode === "trainee"){
        header.classList.add("trainee-mode");
        body.classList.add("mode-trainee");
    }
    else{
        body.classList.add("mode-official");
    }
}
</script>


<script>
document.querySelectorAll('.leaderboard-card').forEach(card => {
    card.addEventListener('mousemove', e => {
        const rect = card.getBoundingClientRect();
        const x = ((e.clientX - rect.left) / rect.width) * 100;
        const y = ((e.clientY - rect.top) / rect.height) * 100;
        card.style.setProperty('--x', x + '%');
        card.style.setProperty('--y', y + '%');
    });
});
</script>


<div id="introTutorial" style="
position:fixed;
inset:0;
background:rgba(0,0,0,0.65);
display:none;
align-items:center;
justify-content:center;
z-index:9999;
backdrop-filter:blur(6px);
">
  <div style="
  max-width:520px;" class="tutorial-card
  width:90%;
  background:#1f2430;
  border-radius:14px;
  padding:28px;
  text-align:center;
  box-shadow:0 20px 60px rgba(0,0,0,0.6);
  border:1px solid rgba(255,255,255,0.08);
  ">
    
    <h2 style="margin-bottom:10px;color:#ff4757;"><span class="tutorial-title">Selamat Datang</span></h2>

    <p style="opacity:0.85;line-height:1.6;margin-bottom:16px;">
      <span class="tutorial-body"></span>
    </p>

    <div style="text-align:left;margin:18px 0;">
      <p>üí¨ <b>Mulai Percakapan</b> ‚Äî coba chat atau DM Instagram <b>@akangcosplay</b> untuk berkenalan</p>
      <p>‚öîÔ∏è <b>Akang Trainee</b> ‚Äî belajar dan berkembang bersama</p>
      <p>üéÆ <b>Akang Gamers</b> ‚Äî ruang santai & hiburan komunitas</p>
      <p>üèÜ <b>Leaderboard</b> ‚Äî lihat perkembangan member aktif</p>
    </div>

    <p style="opacity:0.75;margin-bottom:22px;">
      Kamu bebas menjelajah dulu. Jika merasa cocok, kamu selalu bisa bergabung kapan saja.
    </p>

    <button onclick="closeIntroTutorial()" style="
      padding:10px 18px;
      border:none;
      border-radius:10px;
      background:#ff4757;
      color:white;
      font-weight:700;
      cursor:pointer;
    ">
      Mulai Jelajahi üöÄ
    </button>

  </div>
</div>

<script>
function closeIntroTutorial(){
    document.getElementById("introTutorial").style.display="none";
    
}

window.addEventListener("DOMContentLoaded",()=>{
    
    if(true){
        document.getElementById("introTutorial").style.display="flex";
    }
});
</script>


<style>
#introTutorial {
    opacity: 0;
    visibility: hidden;
    transition: opacity 0.6s ease, visibility 0.6s ease;
}

#introTutorial.show {
    opacity: 1;
    visibility: visible;
}

#introTutorial.hide {
    opacity: 0;
    visibility: hidden;
}

#introTutorial .tutorial-card {
    transform: translateY(20px);
    transition: transform 0.6s ease;
}

#introTutorial.show .tutorial-card {
    transform: translateY(0);
}


/* =========================================
   DIVISION CURSOR GLOW COLOR FIX (AUTO PATCH)
========================================= */

/* TRAINEE ‚Äî CYAN NEON */
#view-trainee .leaderboard-card::before {
    background: radial-gradient(
        circle at var(--x,50%) var(--y,50%),
        rgba(0,229,255,0.28),
        transparent 60%
    ) !important;
}

/* GAMERS ‚Äî GOLD */
#view-gamers .leaderboard-card::before {
    background: radial-gradient(
        circle at var(--x,50%) var(--y,50%),
        rgba(255,215,0,0.30),
        transparent 60%
    ) !important;
}

</style>

<script>
function closeIntroTutorial(){
    const modal = document.getElementById("introTutorial");
    modal.classList.remove("show");
    modal.classList.add("hide");

    setTimeout(()=>{
        modal.style.display="none";
    },600);

    
}

window.addEventListener("load",()=>{
    
    const modal = document.getElementById("introTutorial");

    if(!seen && modal){
        modal.style.display="flex";

        // delay appearance so it feels natural after page loads
        setTimeout(()=>{
            modal.classList.add("show");
        },800);
    }
});
</script>


<script>

const onboardingMessages = {
    first: {
        title: "Selamat Datang di Akang Cosplay üé≠",
        body: `
        Akang Cosplay adalah sebuah <b>team cosplay</b> yang berkembang bersama,
        bukan komunitas terbuka pada umumnya.
        <br><br>
        <div style="text-align:left;line-height:1.7;">
        üé≠ <b>Official Team</b> ‚Äî Rein, Nabilla, dan Ian/Kanekian<br>
        ‚öîÔ∏è <b>Akang Trainee</b> ‚Äî tempat belajar & berkembang sebelum menjadi bagian team<br>
        üéÆ <b>Akang Gamers</b> ‚Äî ruang santai dan interaksi komunitas<br>
        üèÜ <b>Leaderboard</b> ‚Äî melihat perjalanan dan progres member
        </div>
        <br>
        Kamu bebas menjelajah terlebih dahulu. Jika tertarik berkembang bersama,
        perjalanan selalu dimulai dari <b>Akang Trainee</b>.
        `
    },
    second: {
        title: "Mulai Eksplorasi üöÄ",
        body: `
        Coba buka <b>Akang Trainee</b> untuk melihat bagaimana perjalanan berkembang dimulai.
        Setiap member memiliki proses sebelum menjadi bagian dari Official Team.
        <br><br>
        Kamu juga bisa melihat aktivitas santai di <b>Akang Gamers</b>.
        `
    },
    returning: {
        title: "Selamat Datang Kembali ‚öîÔ∏è",
        body: `
        Lihat perkembangan terbaru team dan trainee,
        cek leaderboard, atau lanjutkan eksplorasimu.
        Setiap kunjungan adalah bagian dari perjalanan.
        `
    }
};


function getVisitType(){
    let visits = parseInt(localStorage.getItem("akang_visit_count") || "0");
    visits++;
    localStorage.setItem("akang_visit_count", visits);

    if(visits === 1) return "first";
    if(visits === 2) return "second";
    return "returning";
}

function showOnboarding(){
    const modal = document.getElementById("introTutorial");
    if(!modal) return;

    const visitType = getVisitType();
    const msg = onboardingMessages[visitType];

    modal.querySelector(".tutorial-title").innerText = msg.title;
    modal.querySelector(".tutorial-body").innerHTML = msg.body;

    modal.style.display = "flex";

    setTimeout(()=>{
        modal.classList.add("show");
    },600);
}

function closeIntroTutorial(){
    const modal = document.getElementById("introTutorial");
    modal.classList.remove("show");

    setTimeout(()=>{
        modal.style.display="none";
    },600);
}

window.addEventListener("load", ()=>{
    showOnboarding();
});
</script>

</body>
</html>
