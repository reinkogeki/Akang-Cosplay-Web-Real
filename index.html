<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Akang Cosplay - Official App</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <script src="https://www.gstatic.com/firebasejs/10.8.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.1/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.1/firebase-auth-compat.js"></script>

    <style>
        /* --- LOAD CUSTOM FONTS --- */
        @font-face {
            font-family: 'HardRace';
            src: url('Hard Race.otf') format('opentype');
            font-weight: normal; font-style: normal;
        }

        /* LOAD LEAGUE SPARTAN VARIABLE FONT */
        @font-face {
            font-family: 'LeagueSpartan';
            src: url('LeagueSpartan-VariableFont_wght.ttf') format('truetype');
            font-weight: 100 900; /* Mendukung range berat dari Thin sampai Black */
            font-style: normal;
        }

        /* --- CSS VARIABLES & RESET --- */
        :root {
            --primary: #ff4757;
            --secondary: #2f3542;
            --dark: #1e272e;
            --light: #f1f2f6;
            --gold: #ffa502;
            --card-bg: #353b48;
            --accent-blue: #3498db;
            --sky-blue: #48dbfb;
            --danger: #ff6b6b;
            --purple: #9b59b6;
            --green: #2ecc71;
            /* Warna Text & Glow Baru */
            --text-cosplay: #ff8686;
            --text-trainee: #ffd89d;
            --glow-trainee: #a6895e;
        }

        * { box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--dark);
            color: var(--light);
            margin: 0; padding-bottom: 80px;
        }

        /* --- HEADER --- */
        header {
            background: linear-gradient(135deg, #192a56, #273c75);
            padding: 15px 20px; text-align: center;
            border-bottom: 4px solid var(--primary);
            position: sticky; top: 0; z-index: 100;
            box-shadow: 0 4px 10px rgba(0,0,0,0.3);
            display: flex; flex-direction: column; align-items: center;
            transition: all 0.5s ease;
        }
        
        header.gamers-mode {
            background: linear-gradient(135deg, #000000, #1e272e);
            border-bottom-color: var(--gold);
        }
        
        /* Warna background header trainee */
        header.trainee-mode {
            background: #2154a1; /* Warna biru baru */
            border-bottom-color: var(--sky-blue);
        }

        .team-logo {
            width: 80px; height: 80px; object-fit: contain;
            background: rgba(255,255,255,0.1); border-radius: 50%;
            margin-bottom: 10px; border: 2px solid var(--light);
            display: none; transition: transform 0.3s;
        }

        /* --- UPDATE: STYLE KHUSUS JUDUL UTAMA (League Spartan Custom Weight) --- */
        header h1 { 
            margin: 0; 
            font-family: 'LeagueSpartan', sans-serif; /* Pakai font baru */
            
            /* Weight 750: Di antara Semibold (600) dan Extrabold (800) */
            font-variation-settings: 'wght' 750; 
            font-weight: 750; 
            
            font-size: 2.2rem; 
            text-transform: uppercase; /* Wajib Huruf Kapital Semua */
            letter-spacing: 2px; 
            
            /* Line Spacing 1.4 sesuai permintaan */
            line-height: 1.4;
            
            transition: all 0.3s ease;
            
            /* Warna: Akang Cosplay (#ff8686) & Glow Merah Asli */
            color: var(--text-cosplay);
            text-shadow: 0 0 15px rgba(255, 56, 56, 0.8);
        }

        /* --- Style khusus untuk Akang Trainee (#ffd89d & Glow #a6895e) --- */
        header.trainee-mode h1 {
            color: var(--text-trainee) !important;
            text-shadow: 0 0 20px var(--glow-trainee) !important;
        }

        .title-gamers {
            font-family: 'HardRace', sans-serif !important;
            font-size: 2rem !important; 
            color: var(--gold) !important; 
            text-shadow: 0 0 10px rgba(255, 165, 2, 0.8), 2px 2px 0px #000 !important;
            letter-spacing: 3px;
            /* Reset line height untuk font HardRace jika perlu */
            line-height: normal; 
        }

        header p { margin: 5px 0 0; opacity: 0.8; font-size: 0.8rem; transition: all 0.3s; }

        /* AUTH BUTTONS & DROPDOWN */
        .auth-container { position: absolute; top: 15px; right: 15px; }
        
        .auth-toggle {
            background: rgba(0,0,0,0.3); border: 1px solid #777; 
            color: white; cursor: pointer; font-size: 0.8rem;
            padding: 5px 12px; border-radius: 20px;
            display: flex; align-items: center; gap: 8px;
            transition: 0.3s;
        }
        .auth-toggle:hover { background: rgba(255,255,255,0.1); border-color: var(--primary); }
        
        .user-avatar-mini {
            width: 24px; height: 24px; border-radius: 50%; background: #ccc; object-fit: cover; border: 1px solid white;
        }

        .dropdown-menu {
            display: none; position: absolute; top: 40px; right: 0;
            background: var(--card-bg); border: 1px solid #555; border-radius: 8px;
            width: 240px; box-shadow: 0 5px 15px rgba(0,0,0,0.5);
            z-index: 200; overflow: hidden; animation: fadeIn 0.2s;
        }
        .dropdown-menu.show { display: block; }
        .dropdown-item {
            display: block; width: 100%; padding: 12px 15px;
            text-align: left; background: none; border: none;
            color: #ddd; cursor: pointer; font-size: 0.9rem;
            border-bottom: 1px solid #444; transition: 0.2s;
            display: flex; align-items: center; gap: 10px;
        }
        .dropdown-item:last-child { border-bottom: none; }
        .dropdown-item:hover { background: rgba(255,255,255,0.05); color: white; padding-left: 20px; }
        .dropdown-item.danger { color: var(--danger); }
        .dropdown-item.danger:hover { background: rgba(255, 0, 0, 0.1); }
        .dropdown-item.gold { color: var(--gold); }
        .dropdown-item.active-admin { background: rgba(255, 165, 2, 0.1); color: var(--gold); }

        .container { max-width: 800px; margin: 0 auto; padding: 20px; }

        /* --- NAVIGATION --- */
        .nav-tabs {
            display: flex; gap: 10px; margin-bottom: 20px;
            background: var(--card-bg); border-radius: 50px; padding: 5px;
            overflow-x: auto; 
        }
        .nav-btn {
            flex: 1; border: none; background: none; color: #aaa;
            padding: 12px 5px; cursor: pointer; font-weight: bold;
            border-radius: 50px; transition: 0.3s; font-size: 0.8rem;
            white-space: nowrap;
        }
        .nav-btn.active { background: var(--primary); color: white; box-shadow: 0 2px 5px rgba(0,0,0,0.2); }
        .nav-btn-gamers.active { background: var(--accent-blue); }
        .nav-btn-trainee.active { background: var(--sky-blue); color: #1e272e; } 

        /* --- VIEWS --- */
        .view-section { display: none; animation: fadeIn 0.4s; }
        .view-section.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* --- CARDS --- */
        .leaderboard-card, .feed-card {
            background: var(--card-bg); border-radius: 12px; position: relative;
            margin-bottom: 15px; padding: 15px; border: 1px solid #485460;
            contain: layout; 
        }
        .leaderboard-card { display: flex; align-items: center; cursor: pointer; transition: transform 0.2s; }
        .leaderboard-card:active { transform: scale(0.98); }
        
        .rank-badge { font-size: 1.5rem; font-weight: bold; width: 40px; text-align: center; margin-right: 15px; color: var(--gold); }
        .avatar-small { width: 50px; height: 50px; border-radius: 50%; object-fit: cover; margin-right: 15px; border: 2px solid var(--primary); background: #aaa; }
        .trainee-style .rank-badge { color: var(--sky-blue); }
        .trainee-style .avatar-small { border-color: var(--sky-blue); }
        
        .lb-info { flex: 1; }
        .lb-info h3 { margin: 0; font-size: 1.1rem; }
        .lb-stats div { font-weight: bold; color: var(--primary); font-size: 1.2rem; text-align: right; }

        .feed-card { border-left: 5px solid var(--accent-blue); min-height: 150px; }
        .feed-card.feed-comp { border-left-color: var(--gold); }
        .feed-card.feed-trainee { border-left-color: var(--sky-blue); }
        
        .feed-header { display: flex; align-items: center; gap: 10px; margin-bottom: 10px; }
        .feed-avatar { width: 40px; height: 40px; border-radius: 50%; object-fit: cover; }
        .feed-rank { 
            position: absolute; top: 15px; right: 15px; 
            background: rgba(0,0,0,0.3); padding: 5px 10px; border-radius: 5px;
            color: var(--gold); font-weight: bold; font-size: 0.9rem;
        }
        .feed-img-proof { 
            width: 100%; aspect-ratio: 1 / 1; object-fit: cover; 
            border-radius: 5px; margin-top: 10px; border: 1px solid #555; display: block; cursor: zoom-in; 
        }

        /* --- ABOUT US CARD --- */
        .about-team-card {
            background: var(--card-bg); border-radius: 15px; padding: 25px; margin-bottom: 20px;
            text-align: center; border: 1px solid #485460;
        }
        .team-grid {
            display: flex; gap: 15px; flex-wrap: wrap; margin-top: 20px;
            justify-content: center;
        }
        .member-card {
            flex: 1; min-width: 140px; max-width: 200px;
            background: var(--dark); border-radius: 10px; padding: 15px;
            border: 2px solid #555; transition: 0.3s;
        }
        .member-card:hover { transform: translateY(-5px); border-color: var(--primary); }
        .member-card img { width: 80px; height: 80px; border-radius: 50%; object-fit: cover; border: 2px solid white; margin-bottom: 10px; }
        .member-card h4 { margin: 0; color: var(--gold); }
        .member-card p { margin: 5px 0 0 0; font-size: 0.8rem; color: #ccc; }


        /* --- FILTER TABS --- */
        .filter-tabs {
            display: flex; gap: 10px; margin-bottom: 15px; margin-top: 5px;
            background: var(--card-bg); border-radius: 50px; padding: 5px;
            border: 1px solid #485460;
        }
        .filter-btn {
            flex: 1; border: none; background: none; color: #aaa; padding: 10px;
            cursor: pointer; font-weight: bold; border-radius: 50px; transition: 0.3s;
            font-size: 0.85rem; text-transform: uppercase;
        }
        .filter-btn.active { background: var(--primary); color: white; box-shadow: 0 2px 5px rgba(0,0,0,0.2); }
        .trainee-mode .filter-btn.active { background: var(--sky-blue); color: #1e272e; }

        /* Admin Buttons */
        .admin-controls { display: none; position: absolute; bottom: 10px; right: 10px; z-index: 10; }
        .show-admin { display: block !important; }
        .btn-mini-action { width: 30px; height: 30px; border-radius: 5px; border:none; color:white; cursor: pointer; margin-left: 5px; }

        /* --- PROFILE --- */
        .profile-header { text-align: center; background: var(--card-bg); padding: 30px; border-radius: 15px; margin-bottom: 20px; position: relative; }
        
        /* ACTION MENU (PENCIL) */
        .action-menu-container { position: absolute; top: 15px; right: 15px; z-index: 50; }
        .btn-action-trigger { background: transparent; border: 1px solid #777; color: #ddd; padding: 8px 12px; border-radius: 50%; cursor: pointer; transition: 0.2s; font-size: 1.1rem;}
        .btn-action-trigger:hover { background: rgba(255,255,255,0.1); color: white; border-color: white; }
        .btn-action-trigger.saving { background: var(--green); border-color: var(--green); color: white; animation: pulse 1s infinite; }
        
        .action-dropdown {
            display: none; position: absolute; top: 40px; right: 0;
            background: var(--card-bg); border: 1px solid #555; border-radius: 8px;
            width: 200px; box-shadow: 0 5px 15px rgba(0,0,0,0.5); overflow: hidden;
        }
        .action-dropdown.show { display: block; }

        .profile-pic { width: 120px; height: 120px; border-radius: 50%; object-fit: cover; border: 4px solid var(--primary); margin-bottom: 15px; background: #555; }
        .tag { background: #485460; padding: 5px 12px; border-radius: 15px; font-size: 0.85rem; color: white; display: inline-block; margin: 3px; }
        .social-badge { background: linear-gradient(45deg, #f09433 0%, #e6683c 25%, #dc2743 50%, #cc2366 75%, #bc1888 100%); color: white; padding: 6px 15px; border-radius: 20px; text-decoration: none; display: inline-flex; align-items: center; gap: 5px; font-size: 0.85rem; font-weight: bold; margin-bottom: 10px; transition: transform 0.2s; }
        .social-badge:hover { transform: scale(1.05); color: white; }

        /* --- GALLERY --- */
        .gallery-section { margin-bottom: 25px; }
        .gallery-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; margin-top: 15px; }
        .gallery-item { position: relative; aspect-ratio: 1 / 1; width: 100%; border-radius: 8px; overflow: hidden; border: 1px solid #485460; }
        .gallery-img { width: 100%; height: 100%; object-fit: cover; cursor: pointer; transition: transform 0.2s; }
        .gallery-img:hover { transform: scale(1.1); }
        .btn-del-photo { position: absolute; top: 0; right: 0; background: rgba(255,0,0,0.8); color: white; border: none; width: 30px; height: 30px; cursor: pointer; z-index: 10; display: none; }
        .btn-add-photo { width: 100%; background: #3d4655; color: #aaa; border: 2px dashed #57606f; padding: 10px; border-radius: 8px; cursor: pointer; font-size: 0.9rem; display: none; align-items: center; justify-content: center; gap: 8px; transition: 0.3s; }
        .btn-add-photo:hover { background: #485460; color: white; border-color: var(--accent-blue); }

        /* DELETE MODE STYLES */
        .delete-mode-active .btn-del-photo { display: flex; justify-content: center; align-items: center; animation: shake 0.5s; }
        .delete-mode-active .btn-del-history { display: block !important; }
        .btn-del-history { display: none; background: none; border: none; color: var(--danger); cursor: pointer; font-size: 1.1rem; }
        @keyframes shake { 0% { transform: rotate(0deg); } 25% { transform: rotate(5deg); } 75% { transform: rotate(-5deg); } 100% { transform: rotate(0deg); } }
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.1); } 100% { transform: scale(1); } }

        /* --- LIGHTBOX (MODAL GAMBAR) --- */
        .lightbox-modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.95); z-index: 500; justify-content: center; align-items: center; flex-direction: column; }
        .lightbox-img { max-width: 90%; max-height: 80vh; border-radius: 5px; box-shadow: 0 0 20px rgba(255,255,255,0.1); }
        .lightbox-close { position: absolute; top: 20px; right: 20px; background: rgba(255,255,255,0.2); color: white; border: none; width: 40px; height: 40px; border-radius: 50%; font-size: 1.5rem; cursor: pointer; display: flex; justify-content: center; align-items: center; }
        .lightbox-close:hover { background: var(--primary); }

        /* --- SEARCH BAR --- */
        .search-container { position: relative; margin-bottom: 5px; }
        .search-icon { position: absolute; left: 15px; top: 50%; transform: translateY(-50%); color: #aaa; font-size: 1.1rem; }
        .search-bar { width: 100%; padding: 12px 12px 12px 42px; background: var(--card-bg); border: 1px solid #555; color: white; border-radius: 25px; font-size: 0.95rem; outline: none; transition: 0.3s; margin: 0; }
        .search-bar:focus { border-color: var(--primary); box-shadow: 0 0 8px rgba(255, 71, 87, 0.4); }

        /* --- MODAL --- */
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.85); z-index: 300; justify-content: center; align-items: center; }
        .modal-content { background: var(--secondary); padding: 25px; border-radius: 15px; width: 90%; max-width: 500px; max-height: 90vh; overflow-y: auto; position: relative; }
        
        /* AUTH TABS (LOGIN/REGISTER) */
        .auth-tabs { display: flex; margin-bottom: 15px; border-bottom: 1px solid #555; }
        .auth-tab-btn { flex: 1; padding: 10px; background: none; border: none; color: #aaa; cursor: pointer; font-weight: bold; border-bottom: 2px solid transparent; }
        .auth-tab-btn.active { color: var(--primary); border-bottom-color: var(--primary); }

        /* --- CHAT BOT UI --- */
        #modalBot .modal-content { max-width: 800px; }
        .bot-layout { display: flex; gap: 15px; height: 60vh; min-height: 400px; max-height: 600px; margin-top: 10px; }
        .bot-chat-section { flex: 2; display: flex; flex-direction: column; min-width: 0; border: 1px solid #485460; border-radius: 10px; background: var(--dark); overflow: hidden;}
        .bot-menu-section { flex: 1; display: flex; flex-direction: column; overflow-y: auto; gap: 8px; padding-right: 5px;}
        .bot-menu-title { font-size: 0.9rem; color: var(--gold); margin: 0 0 10px 0; font-weight: bold; border-bottom: 1px solid #555; padding-bottom: 5px;}
        .chat-box { flex-grow: 1; overflow-y: auto; padding: 15px; display: flex; flex-direction: column; gap: 10px; }
        .chat-msg { display: flex; flex-direction: column; width: 100%; }
        .chat-msg.bot { align-items: flex-start; }
        .chat-msg.user { align-items: flex-end; }
        .bubble { max-width: 85%; padding: 10px 15px; border-radius: 15px; font-size: 0.9rem; line-height: 1.5; word-wrap: break-word; }
        .bubble.bot { background: var(--card-bg); color: white; border-bottom-left-radius: 2px; border: 1px solid #555; }
        .bubble.user { background: var(--accent-blue); color: white; border-bottom-right-radius: 2px; }
        .bot-opt-btn { background: var(--dark); border: 1px solid var(--accent-blue); color: #ddd; padding: 10px; border-radius: 10px; cursor: pointer; text-align: left; transition: 0.2s; font-size: 0.85rem; line-height: 1.3; }
        .bot-opt-btn:hover { background: var(--accent-blue); color: white; }
        .chat-input-area { display: flex; gap: 8px; padding: 10px; background: var(--card-bg); border-top: 1px solid #485460; }
        .chat-input-area input { flex-grow: 1; background: var(--dark); border: 1px solid #555; border-radius: 20px; color: white; outline: none; padding: 10px 15px; margin: 0; }
        .chat-input-area button { background: var(--accent-blue); border: none; color: white; width: 42px; height: 42px; border-radius: 50%; cursor: pointer; display: flex; justify-content: center; align-items: center; transition: 0.2s; }
        .chat-input-area button:hover { background: var(--primary); }

        /* FAB MENU */
        .fab-container { position: fixed; bottom: 25px; right: 25px; z-index: 200; display: flex; flex-direction: column; align-items: flex-end; gap: 10px; }
        .fab-menu { display: none; flex-direction: column; gap: 10px; margin-bottom: 5px; }
        .fab-menu.show { display: flex; animation: slideUp 0.3s; }
        .fab-menu button { background: var(--card-bg); color: white; border: 1px solid var(--primary); padding: 10px 15px; border-radius: 8px; cursor: pointer; box-shadow: 0 4px 10px rgba(0,0,0,0.3); font-weight: bold; text-align: right; }
        @keyframes slideUp { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .btn-fab { background: var(--primary); color: white; width: 60px; height: 60px; border-radius: 50%; border: none; font-size: 28px; box-shadow: 0 5px 15px rgba(255, 71, 87, 0.6); cursor: pointer; display: flex; justify-content: center; align-items: center; }
        
        input:not(.search-bar):not(#chatInput), select, textarea { width: 100%; padding: 12px; background: var(--dark); border: 1px solid #57606f; color: white; border-radius: 5px; margin-top: 5px; margin-bottom: 10px; }
        label { color: #ccc; font-weight: bold; }
        .btn-submit { width: 100%; background: var(--primary); color: white; padding: 12px; border: none; border-radius: 5px; font-weight: bold; cursor: pointer; margin-top: 15px; }
        .hidden { display: none; }

        /* Settings */
        .btn-settings { display: none; width: 100%; margin-top: 20px; background: #333; color: #ddd; padding: 10px; border: 1px dashed #777; cursor: pointer; }
        .btn-restore { background: #e67e22; color: white; border:none; padding: 12px; width: 100%; cursor: pointer; border-radius: 5px; font-weight: bold; margin-bottom: 10px;}
        .btn-backup { background: #3498db; color: white; border:none; padding: 12px; width: 100%; cursor: pointer; border-radius: 5px; font-weight: bold; margin-bottom: 20px; }
        .btn-inject { background: #2ecc71; color: white; border:none; padding: 15px; width: 100%; cursor: pointer; border-radius: 8px; font-weight: bold; margin-top: 10px; font-size: 1rem; }

        .bot-link { color: var(--gold); text-decoration: underline; font-weight: bold; }
        .bot-link:hover { color: var(--primary); }

        /* --- GAME CATALOG --- */
        .game-catalog-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(110px, 1fr)); gap: 15px; margin-top: 15px; }
        .game-card { position: relative; border-radius: 10px; overflow: hidden; border: 2px solid #485460; box-shadow: 0 4px 8px rgba(0,0,0,0.3); background: var(--dark); transition: transform 0.2s;}
        .game-card:hover { transform: scale(1.05); border-color: var(--accent-blue); }
        .game-img { width: 100%; aspect-ratio: 9 / 16; object-fit: cover; display: block; }
        .game-title { position: absolute; bottom: 0; left: 0; width: 100%; background: linear-gradient(transparent, rgba(0,0,0,0.95)); padding: 25px 8px 10px; text-align: center; font-size: 0.85rem; font-weight: bold; color: var(--gold); line-height: 1.2; word-wrap: break-word;}
        .btn-delete-game { position: absolute; top: 5px; right: 5px; background: rgba(255, 71, 87, 0.9); color: white; border: none; width: 25px; height: 25px; border-radius: 5px; cursor: pointer; display: none; z-index: 10; font-size: 0.8rem; }
    </style>
</head>
<body>

    <header id="mainHeader">
        <div class="auth-container">
            <button id="authBtn" class="auth-toggle" onclick="toggleUserMenu()">
                <i class="fas fa-sign-in-alt"></i> Login
            </button>
            <div id="userDropdown" class="dropdown-menu">
                </div>
        </div>
        
        <img src="" id="teamLogo" class="team-logo">
        
        <h1 id="headerTitle">Akang Cosplay</h1>
        <p id="headerEst">EST. 2024</p>
        
        <div id="adminBadge" class="admin-badge" style="display:none; margin-top:5px; background:var(--gold); color:black; font-weight:bold; padding:2px 8px; border-radius:10px;">SUPER ADMIN ACTIVE</div>
    </header>

    <div class="container">
        <div class="nav-tabs">
            <button class="nav-btn active" onclick="switchView('about')"><i class="fas fa-home"></i> Home</button>
            <button class="nav-btn" onclick="switchView('official')"><i class="fas fa-crown"></i> Member Official</button>
            <button class="nav-btn nav-btn-trainee" onclick="switchView('trainee')"><i class="fas fa-user-graduate"></i> Akang Trainee</button>
            <button class="nav-btn nav-btn-gamers" onclick="switchView('gamers')"><i class="fas fa-gamepad"></i> Gamers</button>
        </div>

        <div id="view-about" class="view-section active">
            <div class="about-team-card">
                <img src="https://cdn-icons-png.flaticon.com/512/847/847969.png" id="about-logo" style="width:100px; height:100px; border-radius:50%; margin-bottom:15px; border:2px solid var(--primary);">
                <h2 style="color:var(--gold); margin:0;">AKANG COSPLAY</h2>
                <p style="color:#aaa; font-style:italic;">"Berkarya dengan Hati, Berprestasi dengan Aksi"</p>
                <p style="margin-top:15px; font-size:0.95rem; line-height:1.6;">
                    <b>Akang Cosplay</b> adalah tim cosplay yang didirikan pada 14 Juni 2024. 
                    Berawal dari hobi, kami tumbuh menjadi komunitas yang saling mendukung dalam kompetisi, 
                    pembuatan properti, hingga event jejepangan.
                </p>
                
                <h3 style="border-top:1px solid #555; padding-top:15px; margin-top:20px; color:var(--accent-blue);">TIM INTI KAMI</h3>
                <div class="team-grid">
                    <div class="member-card" onclick="findAndOpenProfile('rein')">
                        <img src="https://cdn-icons-png.flaticon.com/512/847/847969.png" id="img-team-rein">
                        <h4>Rein</h4>
                        <p id="role-team-rein">Founder / Cosplayer</p>
                    </div>
                    <div class="member-card" onclick="findAndOpenProfile('nabilla')">
                        <img src="https://cdn-icons-png.flaticon.com/512/847/847969.png" id="img-team-nabilla">
                        <h4>Nabilla</h4>
                        <p id="role-team-nabilla">Cosplayer / Talent</p>
                    </div>
                    <div class="member-card" onclick="findAndOpenProfile('ian')">
                        <img src="https://cdn-icons-png.flaticon.com/512/847/847969.png" id="img-team-ian">
                        <h4>Ian</h4>
                        <p id="role-team-ian">Cosplayer / Maker</p>
                    </div>
                </div>
            </div>
        </div>

        <div id="view-official" class="view-section">
            <h3 style="color:var(--primary); text-align:center; border-bottom:2px solid var(--primary); padding-bottom:10px;">üèÜ KLASEMEN OFFICIAL</h3>
            <div id="leaderboard-official"></div>
            <div id="empty-lb-official" style="text-align: center; color: #777; margin-top: 20px; display: none;">Belum ada Official Member.</div>
            
            <h3 style="color:var(--gold); margin-top:40px; border-left: 4px solid var(--gold); padding-left: 10px;">üìú Riwayat Juara (Official)</h3>
            
            <div class="search-container">
                <i class="fas fa-search search-icon"></i>
                <input type="text" id="searchOfficial" class="search-bar" placeholder="Cari data official..." onkeyup="prepareHistoryData('official')">
            </div>

            <div class="filter-tabs">
                <button class="filter-btn filter-btn-overall active" onclick="setHistoryFilter('all', this)">Overall</button>
                <button class="filter-btn" onclick="setHistoryFilter('Coswalk', this)">Coswalk</button>
                <button class="filter-btn" onclick="setHistoryFilter('Coscom', this)">Coscom</button>
            </div>

            <div id="history-official-list"></div>
            <div id="scroll-trigger-official" style="height: 30px; margin-top: 10px;"></div>
        </div>

        <div id="view-trainee" class="view-section">
            <h3 style="color:var(--sky-blue); text-align:center; border-bottom:2px solid var(--sky-blue); padding-bottom:10px;"><i class="fas fa-user-graduate"></i> KLASEMEN TRAINEE</h3>
            
            <div class="feed-card feed-trainee" style="margin-bottom: 20px;">
                <h3 style="margin-top:0; color:var(--sky-blue);">Apa itu Akang Trainee?</h3>
                <p style="font-size: 0.9rem; line-height: 1.5; color: #ddd; margin-bottom: 0;">
                    Akang Trainee adalah ruang pengembangan bagi cosplayer yang ingin terus berkembang dan meningkatkan kualitas diri dalam dunia performa dan kompetisi. Di sini, kita berlatih bersama, saling memberi evaluasi, dan belajar melalui pengalaman secara bertahap.
                    <br><br>
                    Akang Trainee menjadi tempat untuk melihat sejauh mana komitmen dan konsistensi setiap individu dalam prosesnya. Bukan tentang siapa yang paling hebat, tetapi tentang siapa yang mau terus belajar dan memperbaiki diri.
                    <br><br>
                    Kami percaya bahwa performer yang baik lahir dari lingkungan yang saling mendukung dan mendorong satu sama lain untuk tumbuh.
                </p>
            </div>

            <div id="leaderboard-trainee"></div>
            <div id="empty-lb-trainee" style="text-align: center; color: #777; margin-top: 20px; display: none;">Belum ada Trainee.</div>

            <h3 style="color:var(--sky-blue); margin-top:40px; border-left: 4px solid var(--sky-blue); padding-left: 10px;">üìú Riwayat Juara (Trainee)</h3>
             
            <div class="search-container">
                <i class="fas fa-search search-icon"></i>
                <input type="text" id="searchTrainee" class="search-bar" placeholder="Cari data trainee..." onkeyup="prepareHistoryData('trainee')">
            </div>

            <div class="filter-tabs">
                <button class="filter-btn filter-btn-overall active" onclick="setHistoryFilter('all', this)">Overall</button>
                <button class="filter-btn" onclick="setHistoryFilter('Coswalk', this)">Coswalk</button>
                <button class="filter-btn" onclick="setHistoryFilter('Coscom', this)">Coscom</button>
            </div>

            <div id="history-trainee-list"></div>
            <div id="scroll-trigger-trainee" style="height: 30px; margin-top: 10px;"></div>
        </div>

        <div id="view-gamers" class="view-section">
            <div style="text-align: center; margin-bottom: 20px;">
                <h2 style="color: var(--accent-blue); margin-bottom: 5px;"><i class="fas fa-gamepad"></i> AKANG GAMERS</h2>
                <p style="color: #ccc; font-size: 0.9rem; margin-top: 0;">Divisi Livestream & Mabar Santai bareng Rein dan Nabilla! üéÆ‚ú®</p>
            </div>
            
            <div class="feed-card" style="border-left-color: var(--accent-blue);">
                <h3 style="margin-top:0;">Apa itu Akang Gamers?</h3>
                <p style="font-size: 0.9rem; line-height: 1.5; color: #ddd; margin-bottom: 0;">Akang Gamers adalah wadah seru-seruan dimana <b>Rein</b> dan <b>Nabilla</b> melakukan live streaming sambil main game dan ngobrol santai bareng para viewers. Walaupun kami cosplayer, kami juga suka mabar! Yuk gabung ke stream kami, jangan lupa bawa cemilan ya!</p>
            </div>

            <div style="display: flex; gap: 15px; margin-top: 20px; flex-wrap: wrap;">
                <div class="leaderboard-card" style="flex: 1; min-width: 250px; flex-direction: column; align-items: center; text-align: center; padding: 25px 15px;">
                    <img src="https://cdn-icons-png.flaticon.com/512/847/847969.png" id="img-gamer-rein" class="profile-pic" style="width: 90px; height: 90px; margin-bottom: 10px; border-color: var(--accent-blue);">
                    <h3 style="margin: 0; color: var(--gold);">Rein</h3>
                    <p style="font-size: 0.8rem; color: #aaa; margin: 5px 0 0 0;"><i class="fas fa-headset"></i> Streamer / Player</p>
                </div>

                <div class="leaderboard-card" style="flex: 1; min-width: 250px; flex-direction: column; align-items: center; text-align: center; padding: 25px 15px;">
                    <img src="https://cdn-icons-png.flaticon.com/512/847/847969.png" id="img-gamer-nabilla" class="profile-pic" style="width: 90px; height: 90px; margin-bottom: 10px; border-color: var(--purple);">
                    <h3 style="margin: 0; color: var(--gold);">Nabilla</h3>
                    <p style="font-size: 0.8rem; color: #aaa; margin: 5px 0 0 0;"><i class="fas fa-headset"></i> Streamer / Player</p>
                </div>
            </div>

            <div style="margin-top: 30px; background: rgba(0,0,0,0.2); border-radius: 15px; padding: 20px;">
                <h3 style="color: var(--accent-blue); text-align: center; margin-top: 0; margin-bottom: 15px; display: flex; align-items: center; justify-content: center; gap: 10px;">
                    <i class="fas fa-layer-group"></i> List Game Mabar
                </h3>
                <button id="btnAddGameBtn" class="admin-only" style="display: none; background: var(--green); color: white; border: none; padding: 10px 15px; border-radius: 8px; cursor: pointer; margin-bottom: 10px; width: 100%; font-weight: bold;" onclick="openModal('modalAddGame')"><i class="fas fa-plus"></i> Tambah Katalog Game</button>
                
                <div id="game-catalog-list" class="game-catalog-grid"></div>
            </div>
            
            <div style="text-align: center; margin-top: 25px; padding: 15px; background: rgba(0,0,0,0.2); border-radius: 15px;">
                <p style="color: var(--gold); font-weight: bold; margin-top: 0; margin-bottom: 15px;">Follow Sosmed Akang Gamers:</p>
                <div style="display: flex; gap: 10px; flex-wrap: wrap; justify-content: center;">
                    <button onclick="window.open('https://youtube.com/@akanggamers1372?si=_CfkHg0suu_eJqdq', '_blank')" style="background: #c4302b; color:white; border:none; width: auto; padding: 10px 20px; border-radius: 30px; cursor:pointer; font-weight:bold;">
                        <i class="fab fa-youtube"></i> YouTube
                    </button>
                    <button onclick="window.open('https://www.tiktok.com/@realaffiliate1372?_r=1&_t=ZS-93phwZphl7Y', '_blank')" style="background: #000000; color:white; border: 1px solid #444; width: auto; padding: 10px 20px; border-radius: 30px; cursor:pointer; font-weight:bold;">
                        <i class="fab fa-tiktok"></i> TikTok
                    </button>
                    <button onclick="window.open('https://www.instagram.com/akanggamersofc?igsh=OHBtMnBsdGh3N29z', '_blank')" style="background: linear-gradient(45deg, #f09433 0%, #e6683c 25%, #dc2743 50%, #cc2366 75%, #bc1888 100%); color:white; border:none; width: auto; padding: 10px 20px; border-radius: 30px; cursor:pointer; font-weight:bold;">
                        <i class="fab fa-instagram"></i> Instagram
                    </button>
                </div>
            </div>
        </div>

        <div id="view-profile" class="view-section">
            <button style="background:none; border:none; color:#aaa; cursor:pointer; margin-bottom:10px;" onclick="switchView('official')">
                <i class="fas fa-arrow-left"></i> Kembali
            </button>
            
            <div class="profile-header">
                <div id="profileActionMenu" class="action-menu-container" style="display:none;">
                    <button class="btn-action-trigger" onclick="toggleActionDropdown()" id="btnPencil"><i class="fas fa-pen"></i></button>
                    <div id="actionDropdown" class="action-dropdown">
                        <button class="dropdown-item" onclick="openEditModal()"><i class="fas fa-user-edit"></i> Edit Biodata</button>
                        <button class="dropdown-item" onclick="toggleManagePostsMode()"><i class="fas fa-images"></i> Atur Postingan</button>
                        <button class="dropdown-item danger admin-only" id="btnDelMemberMenu" onclick="deleteCurrentMember()"><i class="fas fa-trash"></i> Hapus Member</button>
                    </div>
                </div>

                <div id="savePostModeBtn" class="action-menu-container" style="display:none;">
                     <button class="btn-action-trigger saving" onclick="toggleManagePostsMode()"><i class="fas fa-check"></i></button>
                </div>
                
                <img src="" id="p-photo" class="profile-pic">
                <h2 id="p-name" style="color:var(--primary); margin: 10px 0 5px 0;">Nama</h2>
                
                <div id="p-status-badge" style="display:inline-block; padding:3px 10px; border-radius:10px; font-size:0.75rem; margin-bottom:10px; font-weight:bold; border:1px solid #777;">STATUS</div>
                <br>

                <a id="p-ig" href="#" target="_blank" class="social-badge" style="display:none;"><i class="fab fa-instagram"></i> Instagram</a>
                
                <p id="p-bio" style="font-style:italic; color:#ccc; margin-top: 5px;">Bio...</p>
                <div style="display: flex; justify-content: center; gap: 20px; margin-top: 15px;">
                    <div><span id="p-stat-coswalk" style="font-size: 1.5rem; font-weight:bold; color:var(--accent-blue);">0</span><br><small>Coswalk</small></div>
                    <div><span id="p-stat-comp" style="font-size: 1.5rem; font-weight:bold; color:var(--gold);">0</span><br><small>Comp</small></div>
                </div>
            </div>

            <div class="gallery-section">
                <h3 style="display:flex; justify-content:space-between; align-items:center;">
                    <span>üì∏ Galeri Kostum</span>
                    <small style="font-size:0.7em; font-weight:normal; color:#777;">(Grid 1:1)</small>
                </h3>
                
                <button class="btn-add-photo" onclick="document.getElementById('galleryInput').click()">
                    <i class="fas fa-camera"></i> Tambah Foto ke Galeri
                </button>
                <input type="file" id="galleryInput" hidden accept="image/*" onchange="uploadGalleryPhoto(this)">

                <div id="p-gallery-grid" class="gallery-grid"></div>
            </div>

            <h3>üé≠ Repertoire</h3>
            <div id="p-repertoire" style="margin-bottom: 20px;"></div>

            <h3>üìú Riwayat Juara</h3>
            <div id="p-history-list"></div>
        </div>
    </div>

    <div class="fab-container">
        <div id="fabMenu" class="fab-menu">
            <button onclick="toggleFabMenu(); openBotModal()" style="border-color: var(--accent-blue);">üí¨ Tanya Akang</button>
            <button id="fabBtnWin" class="admin-only" style="display: none;" onclick="toggleFabMenu(); openModalWin()">üèÜ Input Menang</button>
        </div>
        <button class="btn-fab" onclick="toggleFabMenu()" title="Menu"><i class="fas fa-plus"></i></button>
    </div>

    <div id="lightbox" class="lightbox-modal">
        <button class="lightbox-close" onclick="closeLightbox()">&times;</button>
        <img id="lightboxImg" class="lightbox-img" src="">
    </div>

    <div id="modalAuth" class="modal">
        <div class="modal-content">
            <div class="auth-tabs">
                <button class="auth-tab-btn active" onclick="switchAuthTab('login')">Login</button>
                <button class="auth-tab-btn" onclick="switchAuthTab('register')">Daftar Member</button>
            </div>
            <div id="formLogin">
                <label>Email</label><input type="email" id="loginEmail">
                <label>Password</label><input type="password" id="loginPass">
                <button class="btn-submit" onclick="login()">Masuk</button>
                <p id="loginError" style="color:var(--danger); font-size:0.9rem; margin-top:10px;"></p>
            </div>
            <div id="formRegister" class="hidden">
                <p style="color:#aaa; font-size:0.9rem; margin-bottom:15px;">Buat akun member baru untuk mulai mengisi portofolio coslpay-mu!</p>
                <label>Email</label><input type="email" id="regEmail">
                <label>Password (Min 6 Karakter)</label><input type="password" id="regPass">
                <hr style="border-color:#444; margin: 15px 0;">
                <label>Nama Panggung / Cosplayer</label><input type="text" id="regName">
                <label>Bio Singkat</label><textarea id="regBio" rows="2"></textarea>
                <label>Link Instagram</label><input type="text" id="regIg" placeholder="@username">
                <button class="btn-submit" style="background:var(--green);" onclick="registerUser()">Daftar & Buat Profil</button>
                <p id="regError" style="color:var(--danger); font-size:0.9rem; margin-top:10px;"></p>
            </div>
            <button style="margin-top:10px; width:100%; background:none; border:none; color:#aaa;" onclick="closeModal('modalAuth')">Batal</button>
        </div>
    </div>

    <div id="modalAddGame" class="modal">
        <div class="modal-content">
            <h3 style="color: var(--accent-blue);"><i class="fas fa-gamepad"></i> Tambah Katalog Game</h3>
            <label>Nama Game</label><input type="text" id="addGameName" placeholder="Contoh: Valorant">
            <label>Gambar Cover Game</label><input type="file" id="addGameImage" accept="image/*">
            <button class="btn-submit" onclick="submitAddGame()">Simpan Game</button>
            <button style="margin-top:10px; width:100%; background:none; border:none; color:#aaa;" onclick="closeModal('modalAddGame')">Batal</button>
        </div>
    </div>

    <div id="modalEdit" class="modal">
        <div class="modal-content">
            <h3>‚úèÔ∏è Edit Profil Saya</h3>
            <input type="hidden" id="editId">
            <label>Nama</label><input type="text" id="editName">
            <label>Jabatan / Role</label><input type="text" id="editRole" placeholder="Contoh: Founder / Cosplayer">
            <div id="adminStatusControl" class="admin-only" style="background: rgba(255, 165, 2, 0.1); padding: 10px; border-radius: 8px; margin-bottom: 10px; border: 1px solid var(--gold);">
                <label style="color: var(--gold);"><i class="fas fa-crown"></i> Status (Admin Only)</label>
                <select id="editStatus"><option value="official">Official Member</option><option value="trainee">Akang Trainee</option></select>
            </div>
            <label>Bio</label><textarea id="editBio" rows="2"></textarea>
            <label>Instagram</label><input type="text" id="editIg">
            <label>Foto Baru</label><input type="file" id="editPhoto" accept="image/*">
            <label>Tambah Kostum</label>
            <div style="display:flex; gap:5px;">
                <input type="text" id="repInput" placeholder="Nama Karakter...">
                <button onclick="addRepertoireTag()" style="width:50px; background:var(--accent-blue); border:none; color:white; border-radius:5px;">+</button>
            </div>
            <div id="editRepList" style="margin-top:10px;"></div>
            <button class="btn-submit" onclick="saveEditProfile()">Update</button>
            <button style="margin-top:10px; width:100%; background:none; border:none; color:#aaa;" onclick="closeModal('modalEdit')">Batal</button>
        </div>
    </div>

    <div id="modalSettings" class="modal">
        <div class="modal-content">
            <h3>‚öôÔ∏è Settings</h3>
            <div style="background: #2c3e50; padding: 15px; border-radius: 8px; margin-bottom: 20px; border: 1px solid #3498db;">
                <h4 style="margin-top:0; color:#3498db;">üõ†Ô∏è Migrasi Data (Darurat)</h4>
                <div id="migrationList"></div>
            </div>
            <button style="margin-top:10px; width:100%; background:none; border:none; color:#aaa;" onclick="closeModal('modalSettings')">Tutup</button>
        </div>
    </div>

    <div id="modalSuperAdmin" class="modal">
        <div class="modal-content">
            <h3 style="color:var(--gold);"><i class="fas fa-lock"></i> Mode Dewa</h3>
            
            <div style="margin-bottom:20px; border-bottom:1px solid #555; padding-bottom:15px;">
                 <label style="color:var(--accent-blue);">Backup Data</label>
                 <button class="btn-backup" onclick="downloadBackupData()">‚¨áÔ∏è Download Backup</button>
            </div>

            <label>Logo Default (Cosplay)</label>
            <input type="file" id="settingLogo" accept="image/*">
            <button onclick="saveLogo()" style="background:#555; color:white; border:none; padding:8px; width:100%; margin-bottom:15px; border-radius: 5px;">Simpan Default</button>
            
            <label style="color: var(--accent-blue)">Logo "Akang Gamers"</label>
            <input type="file" id="settingGamersLogo" accept="image/*">
            <button onclick="saveGamersLogo()" style="background:#555; color:white; border:none; padding:8px; width:100%; margin-bottom:15px; border-radius: 5px;">Simpan Gamers</button>

             <label style="color: var(--sky-blue)">Logo "Akang Trainee"</label>
            <input type="file" id="settingTraineeLogo" accept="image/*">
            <button onclick="saveTraineeLogo()" style="background:#555; color:white; border:none; padding:8px; width:100%; margin-bottom:15px; border-radius: 5px;">Simpan Trainee</button>

            <div style="background: rgba(230, 126, 34, 0.1); border: 1px solid #e67e22; padding: 15px; border-radius: 8px; margin-top: 20px;">
                <label style="color:var(--gold);">üî• Restore Data</label>
                <input type="file" id="restoreFile" accept=".json" style="margin-bottom: 10px;">
                <button class="btn-restore" onclick="restoreToFirebase()">‚¨ÜÔ∏è Upload JSON</button>
            </div>
            
            <button style="margin-top:10px; width:100%; background:none; border:none; color:#aaa;" onclick="closeModal('modalSuperAdmin')">Tutup</button>
        </div>
    </div>

    <div id="modalWin" class="modal">
        <div class="modal-content">
            <h3>üèÜ Input Kemenangan</h3>
            <label>Siapa yang menang?</label><select id="winMember"></select>
            <label>Nama Event</label><input type="text" id="winEvent">
            <label>Kategori</label>
            <select id="winCat"><option value="Coswalk">Coswalk</option><option value="Cosplay Competition">Cosplay Competition</option></select>
            <label>Karakter</label><input type="text" id="winChar">
            <label>Tanggal Event</label><input type="date" id="winDate">
            <label>Juara Ke-</label>
            <select id="winRank" onchange="toggleBestInput()"><option value="1">Juara 1</option><option value="2">Juara 2</option><option value="3">Juara 3</option><option value="Best">Best / Fav</option></select>
            <div id="divBestTitle" class="hidden"><label style="color:var(--gold);">Detail Best</label><input type="text" id="winBestTitle"></div>
            <label>Nama Juri</label><input type="text" id="winJudges">
            <label>Bukti Foto</label><input type="file" id="winProof" accept="image/*">
            <button class="btn-submit" onclick="submitWin()">Simpan Data</button>
            <button style="margin-top:10px; width:100%; background:none; border:none; color:#aaa;" onclick="closeModal('modalWin')">Batal</button>
        </div>
    </div>

    <div id="modalBot" class="modal">
        <div class="modal-content" style="padding: 15px; display: flex; flex-direction: column;">
            <h3 style="margin-top:0; margin-bottom: 5px; color:var(--accent-blue); display:flex; justify-content:space-between; flex-shrink: 0;">
                <span>ü§ñ Akang Bot</span>
                <i class="fas fa-times" style="cursor:pointer; color:#777;" onclick="closeModal('modalBot')"></i>
            </h3>
            <div class="bot-layout">
                <div class="bot-menu-section" id="chatOptions"></div>
                <div class="bot-chat-section">
                    <div id="chatArea" class="chat-box"></div>
                    <div class="chat-input-area">
                        <input type="text" id="chatInput" placeholder="Ketik pertanyaan (cth: 'cara join?')..." onkeypress="handleChatEnter(event)">
                        <button onclick="sendCustomMessage()"><i class="fas fa-paper-plane"></i></button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let defaultLogoUrl = ""; let gamersLogoUrl = ""; let traineeLogoUrl = "";
        
        const firebaseConfig = {
            apiKey: "AIzaSyDTzkh9BbSf1qpCiCDru3JibPi-G8nokfQ", 
            authDomain: "website-akang-cosplay.firebaseapp.com",
            projectId: "website-akang-cosplay",
            storageBucket: "website-akang-cosplay.firebasestorage.app",
            messagingSenderId: "557981115525",
            appId: "1:557981115525:web:114b2422264d816a71f5ec",
            measurementId: "G-NFGQPP01VE"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const auth = firebase.auth();

        let members = []; let games = []; let currentTempRepertoire = [];
        let isRein = false; let isAdmin = false; let currentUser = null; 
        let isManagePostMode = false; // State untuk Mode Hapus Postingan
        const ADMIN_HASH = "240be518fabd2724ddb6f04eeb1da5967448d7e831c08c8fa822809f74c720a9"; 
        
        let currentHistoryData = []; let currentHistoryDisplayCount = 0; const HISTORY_BATCH_SIZE = 5; 
        let activeHistoryType = ''; let activeFilterCategory = 'all';

        function escapeHtml(text) { if (!text) return ""; if (typeof text !== "string") return text; return text.replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;").replace(/"/g, "&quot;").replace(/'/g, "&#039;"); }

        auth.onAuthStateChanged((user) => {
            currentUser = user;
            if(currentUser && currentUser.email === "reinkogeki@gmail.com") { isRein = true; } else { isRein = false; isAdmin = false; }
            updateAuthUI();
        });

        let debounceTimer;
        db.collection("members").onSnapshot((snapshot) => {
            clearTimeout(debounceTimer);
            debounceTimer = setTimeout(() => { members = []; snapshot.forEach((doc) => { members.push(doc.data()); }); renderAll(); }, 500);
        });

        db.collection("games").onSnapshot((snapshot) => { games = []; snapshot.forEach((doc) => { games.push(doc.data()); }); if(document.getElementById('view-gamers').classList.contains('active')) renderGames(); });
        
        db.collection("settings").doc("global").onSnapshot((doc) => { if(doc.exists && doc.data().logo) { defaultLogoUrl = doc.data().logo; if(document.getElementById('view-about').classList.contains('active')) { document.getElementById('about-logo').src = defaultLogoUrl; } if(!document.getElementById('view-gamers').classList.contains('active') && !document.getElementById('view-trainee').classList.contains('active')) { document.getElementById('teamLogo').src = defaultLogoUrl; document.getElementById('teamLogo').style.display = "block"; } } });
        db.collection("settings").doc("gamers").onSnapshot((doc) => { if(doc.exists && doc.data().logo) { gamersLogoUrl = doc.data().logo; if(document.getElementById('view-gamers').classList.contains('active')) { document.getElementById('teamLogo').src = gamersLogoUrl; document.getElementById('teamLogo').style.display = "block"; } } });
        db.collection("settings").doc("trainee").onSnapshot((doc) => { if(doc.exists && doc.data().logo) { traineeLogoUrl = doc.data().logo; if(document.getElementById('view-trainee').classList.contains('active')) { document.getElementById('teamLogo').src = traineeLogoUrl; document.getElementById('teamLogo').style.display = "block"; } } });

        function updateAuthUI() {
            const btn = document.getElementById('authBtn'); const dropdown = document.getElementById('userDropdown'); const adminBadge = document.getElementById('adminBadge');
            if (isAdmin) { adminBadge.style.display = 'block'; document.querySelectorAll('.admin-only').forEach(b => b.style.display = 'block'); } 
            else { adminBadge.style.display = 'none'; document.querySelectorAll('.admin-only').forEach(b => b.style.display = 'none'); }

            if (currentUser) {
                const myProfile = members.find(m => m.id === currentUser.uid);
                const photoUrl = myProfile && myProfile.photo ? myProfile.photo : 'https://cdn-icons-png.flaticon.com/512/847/847969.png';
                const safeName = escapeHtml(myProfile ? myProfile.name : 'Member');
                btn.innerHTML = `<img src="${photoUrl}" class="user-avatar-mini"> ${safeName} <i class="fas fa-caret-down"></i>`;
                btn.onclick = toggleUserMenu; 
                let adminMenuHTML = isRein ? (isAdmin ? `<button class="dropdown-item active-admin" onclick="toggleAdminMode()"><i class="fas fa-toggle-on"></i> Matikan Mode Dewa</button><button class="dropdown-item gold" onclick="openModal('modalSuperAdmin')"><i class="fas fa-cogs"></i> Super Dashboard</button>` : `<button class="dropdown-item danger" onclick="toggleAdminMode()"><i class="fas fa-toggle-off"></i> Aktifkan Mode Dewa</button>`) : "";
                dropdown.innerHTML = `<button class="dropdown-item" onclick="openProfile('${currentUser.uid}')"><i class="fas fa-user"></i> Profil Saya</button><button class="dropdown-item" onclick="openModal('modalSettings')"><i class="fas fa-exchange-alt"></i> Settings (Migrasi)</button>${adminMenuHTML}<button class="dropdown-item" onclick="logout()" style="border-top:1px solid #555;"><i class="fas fa-sign-out-alt"></i> Logout</button>`;
            } else {
                btn.innerHTML = `<i class="fas fa-sign-in-alt"></i> Login`; btn.onclick = openAuthModal; dropdown.innerHTML = ""; isAdmin = false;
            }
            renderAll();
        }

        async function toggleAdminMode() {
            document.getElementById('userDropdown').classList.remove('show');
            if (isAdmin) { isAdmin = false; alert("Mode Dewa Dinonaktifkan."); updateAuthUI(); } 
            else { let pass = prompt("Masukkan Password Mode Dewa:"); if(pass) { const hash = await sha256(pass); if(hash === ADMIN_HASH) { isAdmin = true; alert("Mode Dewa AKTIF!"); updateAuthUI(); } else { alert("Password Salah!"); } } }
        }

        function toggleUserMenu() { document.getElementById('userDropdown').classList.toggle('show'); }
        window.addEventListener('click', function(e) { if (!document.getElementById('authBtn').contains(e.target) && !document.getElementById('userDropdown').contains(e.target)) { document.getElementById('userDropdown').classList.remove('show'); } });
        
        // ACTION MENU (PENCIL) LOGIC
        function toggleActionDropdown() { document.getElementById('actionDropdown').classList.toggle('show'); }
        window.addEventListener('click', function(e) { if (!document.getElementById('btnPencil').contains(e.target) && !document.getElementById('actionDropdown').contains(e.target)) { document.getElementById('actionDropdown').classList.remove('show'); } });

        // TOGGLE MANAGE POSTS MODE (Hapus/Edit Mode)
        function toggleManagePostsMode() {
            isManagePostMode = !isManagePostMode;
            const profileView = document.getElementById('view-profile');
            const menuContainer = document.getElementById('profileActionMenu');
            const saveContainer = document.getElementById('savePostModeBtn');
            const dropdown = document.getElementById('actionDropdown');

            dropdown.classList.remove('show'); // Tutup dropdown

            if (isManagePostMode) {
                // MASUK MODE EDIT
                profileView.classList.add('delete-mode-active');
                menuContainer.style.display = 'none'; // Sembunyikan pensil
                saveContainer.style.display = 'block'; // Munculkan tombol Check/Save
            } else {
                // KELUAR MODE EDIT
                profileView.classList.remove('delete-mode-active');
                menuContainer.style.display = 'block'; // Munculkan pensil
                saveContainer.style.display = 'none'; // Sembunyikan tombol Check/Save
            }
        }

        function openAuthModal() { document.getElementById('modalAuth').style.display = 'flex'; switchAuthTab('login'); document.getElementById('loginError').innerText = ""; document.getElementById('regError').innerText = ""; }
        function switchAuthTab(tab) { document.querySelectorAll('.auth-tab-btn').forEach(b => b.classList.remove('active')); if(tab === 'login') { document.querySelector('.auth-tab-btn:first-child').classList.add('active'); document.getElementById('formLogin').classList.remove('hidden'); document.getElementById('formRegister').classList.add('hidden'); } else { document.querySelector('.auth-tab-btn:last-child').classList.add('active'); document.getElementById('formLogin').classList.add('hidden'); document.getElementById('formRegister').classList.remove('hidden'); } }
        function login() { const email = document.getElementById('loginEmail').value; const pass = document.getElementById('loginPass').value; const err = document.getElementById('loginError'); if(!email || !pass) { err.innerText = "Isi semua!"; return; } auth.signInWithEmailAndPassword(email, pass).then(() => { closeModal('modalAuth'); }).catch((error) => { err.innerText = error.message; }); }
        function logout() { auth.signOut().then(() => { switchView('official'); }); }
        function registerUser() { const email = document.getElementById('regEmail').value; const pass = document.getElementById('regPass').value; const name = document.getElementById('regName').value; const bio = document.getElementById('regBio').value; const ig = document.getElementById('regIg').value; const err = document.getElementById('regError'); if(!email || !pass || !name) { err.innerText = "Isi semua!"; return; } if(pass.length < 6) { err.innerText = "Min 6 karakter"; return; } auth.createUserWithEmailAndPassword(email, pass).then((userCredential) => { const user = userCredential.user; const newMember = { id: user.uid, name: name, bio: bio, ig: ig, photo: null, history: [], repertoire: [], gallery: [], status: 'trainee' }; db.collection("members").doc(user.uid).set(newMember).then(() => { closeModal('modalAuth'); }).catch(e => { err.innerText = e.message; }); }).catch((error) => { err.innerText = error.message; }); }

        function renderMigrationList() { const container = document.getElementById('migrationList'); container.innerHTML = ""; const candidates = members.filter(m => currentUser && m.id !== currentUser.uid); if(candidates.length === 0) { container.innerHTML = "Kosong."; return; } candidates.forEach(m => { container.innerHTML += `<div style="margin-bottom:10px;"><strong>${escapeHtml(m.name)}</strong> (${m.history ? m.history.length : 0} Wins) <button onclick="executeMigration('${m.id}')">Ambil</button></div>`; }); }
        async function executeMigration(oldId) { if(!confirm("Timpa akun ini dengan data lama?")) return; const user = firebase.auth().currentUser; try { const docLama = await db.collection('members').doc(oldId.toString()).get(); const dataLama = docLama.data(); const dataBaru = { ...dataLama, id: user.uid }; await db.collection('members').doc(user.uid).set(dataBaru); await db.collection('members').doc(oldId.toString()).delete(); location.reload(); } catch (e) { alert("Gagal: " + e.message); } }
        async function sha256(message) { const msgBuffer = new TextEncoder().encode(message); const hashBuffer = await crypto.subtle.digest('SHA-256', msgBuffer); const hashArray = Array.from(new Uint8Array(hashBuffer)); return hashArray.map(b => b.toString(16).padStart(2, '0')).join(''); }
        
        function switchView(view) {
            document.querySelectorAll('.view-section').forEach(el => el.classList.remove('active'));
            document.querySelectorAll('.nav-btn').forEach(el => el.classList.remove('active'));
            document.getElementById('view-' + view).classList.add('active');
            
            const header = document.getElementById('mainHeader'); const title = document.getElementById('headerTitle'); const estText = document.getElementById('headerEst'); const logo = document.getElementById('teamLogo');
            header.classList.remove('gamers-mode'); header.classList.remove('trainee-mode');

            if(view === 'gamers') {
                document.querySelector('.nav-btn-gamers').classList.add('active'); header.classList.add('gamers-mode'); title.innerText = "AKANG GAMERS"; title.classList.add('title-gamers'); estText.innerText = "EST. 2026";
                if(gamersLogoUrl) { logo.src = gamersLogoUrl; logo.style.display = "block"; } else if(defaultLogoUrl) { logo.src = defaultLogoUrl; logo.style.display = "block"; }
                renderGamers(); 
            } else if(view === 'trainee') {
                document.querySelector('.nav-btn-trainee').classList.add('active'); header.classList.add('trainee-mode'); title.innerText = "AKANG TRAINEE"; title.classList.remove('title-gamers'); estText.innerText = "FUTURE STARS";
                if(traineeLogoUrl) { logo.src = traineeLogoUrl; logo.style.display = "block"; } else if(defaultLogoUrl) { logo.src = defaultLogoUrl; logo.style.display = "block"; }
                activeFilterCategory = 'all'; document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active')); document.querySelectorAll('.filter-btn-overall').forEach(b => b.classList.add('active'));
                renderLeaderboard('trainee'); prepareHistoryData('trainee'); 
            } else {
                title.innerText = "AKANG COSPLAY"; title.classList.remove('title-gamers'); estText.innerText = "EST. 2024"; if(defaultLogoUrl) { logo.src = defaultLogoUrl; logo.style.display = "block"; }
                const btns = document.querySelectorAll('.nav-btn'); if(view === 'about') btns[0].classList.add('active');
                if(view === 'official') { btns[1].classList.add('active'); activeFilterCategory = 'all'; document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active')); document.querySelectorAll('.filter-btn-overall').forEach(b => b.classList.add('active')); renderLeaderboard('official'); prepareHistoryData('official'); }
            }
        }

        // --- FUNGSI RENDER TIM INTI (FIXED) ---
        function renderAboutTeam() {
            // Cari data REIN
            const rein = members.find(m => m.name.toLowerCase().includes("rein"));
            if(rein) {
                if(rein.photo) document.getElementById('img-team-rein').src = rein.photo;
                if(rein.role) document.getElementById('role-team-rein').innerText = rein.role;
            }

            // Cari data NABILLA
            const nabilla = members.find(m => m.name.toLowerCase().includes("nabilla"));
            if(nabilla) {
                if(nabilla.photo) document.getElementById('img-team-nabilla').src = nabilla.photo;
                if(nabilla.role) document.getElementById('role-team-nabilla').innerText = nabilla.role;
            }

            // Cari data IAN
            const ian = members.find(m => m.name.toLowerCase().includes("ian"));
            if(ian) {
                if(ian.photo) document.getElementById('img-team-ian').src = ian.photo;
                if(ian.role) document.getElementById('role-team-ian').innerText = ian.role;
            }
        }

        function findAndOpenProfile(keyword) { const member = members.find(m => m.name.toLowerCase().includes(keyword.toLowerCase())); if(member) openProfile(member.id); else alert("Profil tidak ditemukan."); }
        async function downloadBackupData() { const backup = { members: members, games: games, version: "1.0", date: new Date().toISOString() }; const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(backup)); const node = document.createElement('a'); node.href = dataStr; node.download = "backup_" + Date.now() + ".json"; document.body.appendChild(node); node.click(); node.remove(); }
        function restoreToFirebase() { const file = document.getElementById('restoreFile').files[0]; if(!file) return; const reader = new FileReader(); reader.onload = async (e) => { try { const data = JSON.parse(e.target.result); if(!confirm(`Restore ${data.members.length} member?`)) return; for (const m of data.members) { await db.collection("members").doc(m.id).set(m); } location.reload(); } catch(err) { alert("Gagal: " + err.message); } }; reader.readAsText(file); }
        
        function saveLogo() { const file = document.getElementById('settingLogo').files[0]; if(file) { const reader = new FileReader(); reader.onload = function(e) { db.collection("settings").doc("global").set({ logo: e.target.result }).then(() => alert("Saved!")); }; reader.readAsDataURL(file); } }
        function saveGamersLogo() { const file = document.getElementById('settingGamersLogo').files[0]; if(file) { const reader = new FileReader(); reader.onload = function(e) { db.collection("settings").doc("gamers").set({ logo: e.target.result }).then(() => alert("Saved!")); }; reader.readAsDataURL(file); } }
        function saveTraineeLogo() { const file = document.getElementById('settingTraineeLogo').files[0]; if(file) { const reader = new FileReader(); reader.onload = function(e) { db.collection("settings").doc("trainee").set({ logo: e.target.result }).then(() => alert("Saved!")); }; reader.readAsDataURL(file); } }

        function renderGamers() { let rein = members.find(m => m.name.toLowerCase().includes("rein")); let nabilla = members.find(m => m.name.toLowerCase().includes("nabilla")); if(rein && rein.photo) document.getElementById('img-gamer-rein').src = rein.photo; if(nabilla && nabilla.photo) document.getElementById('img-gamer-nabilla').src = nabilla.photo; renderGames(); }
        function renderGames() { const container = document.getElementById('game-catalog-list'); container.innerHTML = ""; games.forEach(g => { let delBtn = isAdmin ? `<button class="btn-delete-game show-admin" onclick="deleteGame(${g.id})"><i class="fas fa-trash"></i></button>` : ``; container.innerHTML += `<div class="game-card">${delBtn}<img src="${g.image}" class="game-img" alt="${escapeHtml(g.name)}"><div class="game-title">${escapeHtml(g.name)}</div></div>`; }); if(isAdmin) document.querySelectorAll('.show-admin').forEach(b => b.style.display = 'block'); }
        function submitAddGame() { const name = document.getElementById('addGameName').value; const file = document.getElementById('addGameImage').files[0]; if(!name) return; const save = (img) => { const ng = { id: Date.now(), name: name, image: img || "" }; db.collection("games").doc(ng.id.toString()).set(ng).then(() => { closeModal('modalAddGame'); }); }; if(file) { const r = new FileReader(); r.onload = (e) => save(e.target.result); r.readAsDataURL(file); } else save(null); }
        function deleteGame(id) { if(confirm("Hapus game?")) db.collection("games").doc(id.toString()).delete(); }
        
        function toggleFabMenu() { document.getElementById('fabMenu').classList.toggle('show'); }
        function openBotModal() { document.getElementById('chatInput').value = ""; document.getElementById('chatArea').innerHTML = `<div class="chat-msg bot"><div class="bubble bot">Halo! Saya Akang Bot ü§ñ.<br>Mau tanya apa?</div></div>`; renderBotOptions(); openModal('modalBot'); }
        function renderBotOptions() { const opts = document.getElementById('chatOptions'); opts.innerHTML = ""; botFaqData.forEach((i, idx) => { opts.innerHTML += `<button class="bot-opt-btn" onclick="askBot(${idx})">${i.q}</button>`; }); }
        function askBot(idx) { const i = botFaqData[idx]; const c = document.getElementById('chatArea'); c.innerHTML += `<div class="chat-msg user"><div class="bubble user">${i.q}</div></div>`; setTimeout(() => { c.innerHTML += `<div class="chat-msg bot"><div class="bubble bot">${i.a}</div></div>`; c.scrollTop = c.scrollHeight; }, 600); }
        function handleChatEnter(e) { if (e.key === 'Enter') sendCustomMessage(); }
        function sendCustomMessage() { 
            const txt = document.getElementById('chatInput').value.trim(); if(!txt) return; const low = txt.toLowerCase(); const c = document.getElementById('chatArea'); c.innerHTML += `<div class="chat-msg user"><div class="bubble user">${escapeHtml(txt)}</div></div>`; document.getElementById('chatInput').value = ""; c.scrollTop = c.scrollHeight;
            setTimeout(() => {
                let r = "Maaf, coba tanya: 'cara join', 'sosmed', atau 'apa itu akang cosplay'.";
                if (low.includes('apa itu akang cosplay') || (low.includes('akang cosplay') && low.includes('adalah'))) r = "<b>Akang Cosplay</b> adalah tim cosplay sejak 14 Juni 2024. ‚ú®<br>Komunitas seru buat kompetisi & hobi jejepangan!";
                else if (low.includes('apa itu akang trainee') || (low.includes('trainee') && low.includes('adalah'))) r = "<b>Akang Trainee</b> adalah tempat latihan buat member baru sebelum jadi Official Member. üéì";
                else if (low.includes('daftar') || low.includes('join') || low.includes('gabung')) r = "Caranya:<br>1. Klik tombol <b>Login</b>.<br>2. Pilih tab <b>Daftar Member</b>.<br>3. Isi data & Daftar.<br>Selesai! üéâ";
                else if (low.includes('ig') || low.includes('sosmed')) r = "Follow IG kami: <a href='https://instagram.com/akangcosplay' class='bot-link'>@akangcosplay</a>";
                else if (low.includes('youtube') || low.includes('gamers')) r = "Nonton mabar di YT: <a href='https://youtube.com/@akanggamers1372' class='bot-link'>Akang Gamers</a> üéÆ";
                else if (low.includes('halo') || low.includes('hi')) r = "Halo juga! üëã";
                c.innerHTML += `<div class="chat-msg bot"><div class="bubble bot">${r}</div></div>`; c.scrollTop = c.scrollHeight;
            }, 700);
        }
        const botFaqData = [{q:"Apa itu Akang Cosplay?",a:"Tim cosplay & komunitas hobi sejak 2024! ‚ú®"},{q:"Cara Join?",a:"Klik Login -> Tab Daftar Member -> Isi Data. Gratis!"},{q:"Sosmed?",a:"IG: @akangcosplay, TikTok: @akangcosplay, YT: Akang Cosplay"}];

        function setHistoryFilter(cat, btn) { activeFilterCategory = cat; btn.parentElement.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active')); btn.classList.add('active'); prepareHistoryData(activeHistoryType); }
        function prepareHistoryData(type) { activeHistoryType = type; const listId = type === 'official' ? 'history-official-list' : 'history-trainee-list'; const searchId = type === 'official' ? 'searchOfficial' : 'searchTrainee'; document.getElementById(listId).innerHTML = ""; currentHistoryDisplayCount = 0; currentHistoryData = []; const q = document.getElementById(searchId).value.toLowerCase(); members.forEach(m => { if ((m.status || 'official') === type && m.history) { m.history.forEach(h => { currentHistoryData.push({ ...h, memberId: m.id, memberName: m.name, memberPhoto: m.photo || 'https://cdn-icons-png.flaticon.com/512/847/847969.png' }); }); } }); if(q) currentHistoryData = currentHistoryData.filter(i => `${i.memberName} ${i.event} ${i.char}`.toLowerCase().includes(q)); if(activeFilterCategory !== 'all') currentHistoryData = currentHistoryData.filter(h => activeFilterCategory === 'Coswalk' ? h.category === 'Coswalk' : (h.category === 'Cosplay Competition' || h.category === 'Coscom')); currentHistoryData.sort((a, b) => new Date(b.date) - new Date(a.date)); loadNextBatch(); }
        function loadNextBatch() {
            const listId = activeHistoryType === 'official' ? 'history-official-list' : 'history-trainee-list'; const container = document.getElementById(listId);
            const batch = currentHistoryData.slice(currentHistoryDisplayCount, currentHistoryDisplayCount + HISTORY_BATCH_SIZE);
            if (batch.length === 0 && currentHistoryDisplayCount === 0) { container.innerHTML = "<p style='text-align:center;color:#777'>Data kosong.</p>"; return; }
            batch.forEach(i => {
                let border = (i.category === 'Cosplay Competition' || i.category === 'Coscom') ? 'feed-comp' : ''; if (activeHistoryType === 'trainee') border = 'feed-trainee';
                let rankT = i.rank === 'Best' ? escapeHtml(i.bestTitle) : 'Juara ' + escapeHtml(i.rank);
                let img = i.proof ? `<img src="${i.proof}" class="feed-img-proof" onclick="openLightbox('${i.proof}')">` : '';
                // CLEAN FEED: No delete/edit buttons here
                container.insertAdjacentHTML('beforeend', `<div class="feed-card ${border}"><div class="feed-rank">${rankT}</div><div class="feed-header"><img src="${i.memberPhoto}" class="feed-avatar"><div><div class="feed-title">${escapeHtml(i.memberName)}</div><div class="feed-meta">${new Date(i.date).toLocaleDateString()}</div></div></div><div><strong>${escapeHtml(i.event)}</strong><br>Char: <span style="color:${activeHistoryType==='trainee'?'var(--sky-blue)':'var(--primary)'}">${escapeHtml(i.char)}</span></div>${img}</div>`);
            });
            currentHistoryDisplayCount += batch.length;
        }

        const scrollObs = new IntersectionObserver((entries) => { if(entries[0].isIntersecting) loadNextBatch(); }, { threshold: 0.1 });
        scrollObs.observe(document.getElementById('scroll-trigger-official')); scrollObs.observe(document.getElementById('scroll-trigger-trainee'));

        function renderLeaderboard(type) { 
            const list = document.getElementById(type === 'official' ? 'leaderboard-official' : 'leaderboard-trainee'); list.innerHTML = ""; 
            let fMembers = members.filter(m => (m.status || 'official') === type);
            if(fMembers.length === 0) { document.getElementById(type === 'official' ? 'empty-lb-official' : 'empty-lb-trainee').style.display = 'block'; return; } 
            document.getElementById(type === 'official' ? 'empty-lb-official' : 'empty-lb-trainee').style.display = 'none';
            fMembers.forEach(m => m.totalWins = m.history ? m.history.length : 0); fMembers.sort((a, b) => b.totalWins - a.totalWins);
            fMembers.forEach((m, i) => { 
                let color = i===0?'gold':(i===1?'silver':'#cd7f32'); if (type==='trainee') color='var(--sky-blue)';
                list.innerHTML += `<div class="leaderboard-card ${type==='trainee'?'trainee-style':''}" onclick="openProfile('${m.id}')"><div class="rank-badge" style="color:${color}">#${i+1}</div><img src="${m.photo||'https://cdn-icons-png.flaticon.com/512/847/847969.png'}" class="avatar-small"><div class="lb-info"><h3>${escapeHtml(m.name)}</h3><span>${m.repertoire?m.repertoire.length:0} Kostum</span></div><div class="lb-stats"><div>${m.totalWins}</div></div></div>`; 
            }); 
        }

        // --- PROFILE LOGIC & ACTION MENU ---
        function openProfile(id) {
            const m = members.find(x => x.id == id); if(!m) return;
            const menuBtn = document.getElementById('profileActionMenu');
            const delMemBtn = document.getElementById('btnDelMemberMenu');
            const statusBadge = document.getElementById('p-status-badge');
            
            // RESET DELETE MODE SAAT BUKA PROFIL BARU
            isManagePostMode = true; toggleManagePostsMode(); // Force reset to normal mode

            let isOwner = (currentUser && currentUser.uid === m.id);
            // SHOW ACTION MENU (PENCIL) IF OWNER OR ADMIN
            if (isOwner || isAdmin) {
                menuBtn.style.display = "block";
            } else {
                menuBtn.style.display = "none";
            }

            // DELETE MEMBER BUTTON VISIBILITY (ADMIN ONLY)
            if (isAdmin) delMemBtn.style.display = "block"; else delMemBtn.style.display = "none";

            const st = m.status || 'official';
            statusBadge.innerText = st === 'official' ? "OFFICIAL MEMBER" : "AKANG TRAINEE";
            statusBadge.style.color = st === 'official' ? "var(--primary)" : "var(--sky-blue)";
            statusBadge.style.borderColor = st === 'official' ? "var(--primary)" : "var(--sky-blue)";

            document.getElementById('editId').value = m.id; document.getElementById('editName').value = m.name; document.getElementById('editBio').value = m.bio || ""; document.getElementById('editIg').value = m.ig || ""; document.getElementById('editRole').value = m.role || ""; document.getElementById('editStatus').value = st;
            
            document.getElementById('p-name').innerText = m.name; document.getElementById('p-bio').innerText = m.bio || "-"; document.getElementById('p-photo').src = m.photo || 'https://cdn-icons-png.flaticon.com/512/847/847969.png';
            document.getElementById('p-stat-coswalk').innerText = m.history ? m.history.filter(h => h.category === 'Coswalk').length : 0; 
            document.getElementById('p-stat-comp').innerText = m.history ? m.history.filter(h => h.category === 'Cosplay Competition' || h.category === 'Coscom').length : 0;
            const igBadge = document.getElementById('p-ig'); if(m.ig) { igBadge.href = m.ig.startsWith('http') ? m.ig : 'https://instagram.com/' + m.ig.replace('@',''); igBadge.style.display = 'inline-flex'; } else igBadge.style.display = 'none';

            const galGrid = document.getElementById('p-gallery-grid'); galGrid.innerHTML = "";
            if(m.gallery) m.gallery.forEach((src, i) => { 
                // DELETE BUTTON (Trash) - hidden by default via CSS, shown in Delete Mode
                galGrid.innerHTML += `<div class="gallery-item"><button class="btn-del-photo" onclick="deleteGalleryPhoto('${m.id}', ${i})"><i class="fas fa-trash"></i></button><img src="${src}" class="gallery-img" onclick="openLightbox('${src}')"></div>`; 
            });

            const repDiv = document.getElementById('p-repertoire'); repDiv.innerHTML = ""; if(m.repertoire) m.repertoire.forEach(r => repDiv.innerHTML += `<span class="tag">${escapeHtml(r)}</span>`);
            
            const histDiv = document.getElementById('p-history-list'); histDiv.innerHTML = "";
            if(m.history) {
                [...m.history].sort((a,b)=>new Date(b.date)-new Date(a.date)).forEach(h => {
                    let rankT = h.rank === 'Best' ? escapeHtml(h.bestTitle) : 'Juara ' + h.rank;
                    // DELETE BUTTON (Trash) for History - Only visible in Delete Mode
                    histDiv.innerHTML += `<div style="background:#3d4655; padding:10px; margin-bottom:10px; border-radius:5px; border-left:3px solid ${h.category==='Coswalk'?'var(--accent-blue)':'var(--gold)'}; display:flex; justify-content:space-between; align-items:center;"><div><span style="font-weight:bold">${escapeHtml(h.event)}</span><br><small>${escapeHtml(h.char)} | ${rankT}</small></div><button class="btn-del-history" onclick="deleteHistory('${m.id}', '${h.id}')"><i class="fas fa-trash"></i></button></div>`;
                });
            }

            const btnAddPhoto = document.querySelector('.btn-add-photo'); btnAddPhoto.style.display = isOwner ? "flex" : "none";
            switchView('profile');
        }

        // --- LIGHTBOX FUNCTIONS ---
        function openLightbox(src) { document.getElementById('lightboxImg').src = src; document.getElementById('lightbox').style.display = 'flex'; }
        function closeLightbox() { document.getElementById('lightbox').style.display = 'none'; }
        document.getElementById('lightbox').addEventListener('click', function(e) { if(e.target === this) closeLightbox(); });

        function openModalWin() { 
            const sel = document.getElementById('winMember'); sel.innerHTML = ""; 
            if(isAdmin) { members.forEach(m => sel.innerHTML += `<option value="${m.id}">${escapeHtml(m.name)}</option>`); } 
            else if (currentUser) { const me = members.find(m => m.id === currentUser.uid); sel.innerHTML = `<option value="${me.id}">${escapeHtml(me.name)}</option>`; } 
            else { alert("Login dulu."); return; }
            document.getElementById('divBestTitle').classList.add('hidden'); openModal('modalWin'); 
        }

        function openEditModal() { const id = document.getElementById('editId').value; const m = members.find(x => x.id == id); currentTempRepertoire = m.repertoire ? [...m.repertoire] : []; renderEditRepertoire(); openModal('modalEdit'); }
        function saveEditProfile() { 
            const id = document.getElementById('editId').value; const m = members.find(x => x.id == id); const file = document.getElementById('editPhoto').files[0];
            const finalize = (p) => { 
                m.name = document.getElementById('editName').value; m.bio = document.getElementById('editBio').value; m.ig = document.getElementById('editIg').value; m.role = document.getElementById('editRole').value; 
                if(isAdmin) m.status = document.getElementById('editStatus').value;
                if(p) m.photo = p; m.repertoire = [...currentTempRepertoire]; db.collection("members").doc(id).set(m).then(() => { closeModal('modalEdit'); openProfile(id); });
            };
            if(file) { const r = new FileReader(); r.onload = (e) => finalize(e.target.result); r.readAsDataURL(file); } else finalize(null);
        }

        function submitWin() {
            const id = document.getElementById('winMember').value; 
            // SECURITY CHECK: Only Admin or Self
            if (!isAdmin && (!currentUser || currentUser.uid !== id)) { alert("Hanya bisa input punya sendiri!"); return; }
            
            const event = document.getElementById('winEvent').value; const cat = document.getElementById('winCat').value; const char = document.getElementById('winChar').value; const rank = document.getElementById('winRank').value; const proof = document.getElementById('winProof').files[0];
            if(!event || !char) { alert("Lengkapi data!"); return; }
            const save = (p) => { const m = members.find(x=>x.id==id); if(!m.history) m.history=[]; m.history.unshift({id: Date.now()+Math.random().toString(), event, category: cat, char, rank, judges: document.getElementById('winJudges').value, bestTitle: (rank==='Best'?document.getElementById('winBestTitle').value:null), proof: p, date: document.getElementById('winDate').value||new Date().toISOString() }); if(!m.repertoire) m.repertoire=[]; if(!m.repertoire.includes(char)) m.repertoire.push(char); db.collection("members").doc(id).set(m).then(() => closeModal('modalWin')); };
            if(proof) { const r = new FileReader(); r.onload = (e) => { const i = new Image(); i.src = e.target.result; i.onload = () => { const c = document.createElement('canvas'); const x = c.getContext('2d'); const M = 500; let w=i.width,h=i.height; if(w>h){if(w>M){h*=M/w;w=M}}else{if(h>M){w*=M/h;h=M}} c.width=w; c.height=h; x.drawImage(i,0,0,w,h); save(c.toDataURL('image/jpeg',0.6)); } }; r.readAsDataURL(proof); } else save(null);
        }

        function uploadGalleryPhoto(inp) { const f = inp.files[0]; if(!f) return; const r = new FileReader(); r.onload = (e) => { const i = new Image(); i.src = e.target.result; i.onload = () => { const c = document.createElement('canvas'); const x = c.getContext('2d'); const M = 500; let w=i.width,h=i.height; if(w>h){if(w>M){h*=M/w;w=M}}else{if(h>M){w*=M/h;h=M}} c.width=w; c.height=h; x.drawImage(i,0,0,w,h); const u = c.toDataURL('image/jpeg',0.6); const id = document.getElementById('editId').value; const m = members.find(x=>x.id==id); if(!m.gallery) m.gallery=[]; m.gallery.push(u); db.collection("members").doc(id).set(m).then(()=>openProfile(id)); } }; r.readAsDataURL(f); inp.value=""; }
        function deleteGalleryPhoto(mid, idx) { if(confirm("Hapus foto?")) { const m = members.find(x=>x.id==mid); m.gallery.splice(idx, 1); db.collection("members").doc(mid).set(m).then(()=>openProfile(mid)); } }
        function deleteHistory(mid, hid) { if(confirm("Hapus history?")) { const m = members.find(x=>x.id==mid); m.history = m.history.filter(h=>h.id!==hid); db.collection("members").doc(mid).set(m).then(()=>openProfile(mid)); } }
        function deleteCurrentMember() { const id = document.getElementById('editId').value; if(confirm("YAKIN HAPUS MEMBER INI? PERMANEN!")) db.collection("members").doc(id).delete().then(() => { if(currentUser.uid===id) auth.signOut(); switchView('official'); }); }
        
        function addRepertoireTag() { const v = document.getElementById('repInput').value; if(v && !currentTempRepertoire.includes(v)) { currentTempRepertoire.push(v); renderEditRepertoire(); document.getElementById('repInput').value=""; } }
        function renderEditRepertoire() { document.getElementById('editRepList').innerHTML = currentTempRepertoire.map((t,i) => `<span class="tag">${t} <i class="fas fa-times" onclick="currentTempRepertoire.splice(${i},1);renderEditRepertoire()"></i></span>`).join(''); }
        
        function toggleBestInput() { if(document.getElementById('winRank').value === 'Best') document.getElementById('divBestTitle').classList.remove('hidden'); else document.getElementById('divBestTitle').classList.add('hidden'); }
        function openModal(id) { document.getElementById(id).style.display = 'flex'; if(id==='modalSettings') renderMigrationList(); }
        function closeModal(id) { document.getElementById(id).style.display = 'none'; }
        document.addEventListener('contextmenu', e => e.preventDefault());
        function renderAll() { 
            renderAboutTeam(); // UPDATE FOTO TEAM di HOME
            if(document.getElementById('view-official').classList.contains('active')) { renderLeaderboard('official'); prepareHistoryData('official'); }
            if(document.getElementById('view-trainee').classList.contains('active')) { renderLeaderboard('trainee'); prepareHistoryData('trainee'); }
            if(document.getElementById('view-profile').classList.contains('active')) openProfile(document.getElementById('editId').value); 
            if(document.getElementById('view-gamers').classList.contains('active')) renderGamers(); 
        }
        window.onclick = (e) => { if(e.target.classList.contains('modal')) e.target.style.display = 'none'; }
    </script>
</body>
</html>
